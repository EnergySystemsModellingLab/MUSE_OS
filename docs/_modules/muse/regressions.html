
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>muse.regressions &#8212; MUSE Documentation 0.8 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MUSE Documentation 0.8 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">muse.regressions</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for muse.regressions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions and functors to compute macro-drivers.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">xarray</span> <span class="kn">import</span> <span class="n">DataArray</span><span class="p">,</span> <span class="n">Dataset</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;factory&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Exponential&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ExponentialAdj&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Logistic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Loglog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LogisticSigmoid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Linear&quot;</span><span class="p">,</span>
    <span class="s2">&quot;endogenous_demand&quot;</span><span class="p">,</span>
    <span class="s2">&quot;register_regression&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">REGRESSION_FUNCTOR_CREATOR</span> <span class="o">=</span> <span class="p">{}</span>
<span class="sd">&quot;&quot;&quot;Dictionary of factory functions for creating regression functors.&quot;&quot;&quot;</span>

<span class="n">REGRESSION_FUNCTOR_NAMES</span> <span class="o">=</span> <span class="p">{}</span>
<span class="sd">&quot;&quot;&quot;Dictionary of alternative names for a given functor.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">Regression</span><span class="p">(</span><span class="n">Callable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Regression functors predicting demand from macro quantities.</span>

<span class="sd">    All regression functors are derived from this object.</span>

<span class="sd">    Examples:</span>

<span class="sd">    Creating a regression function can be done via it&#39;s constructor, or</span>
<span class="sd">    through a input csv file. This file is a</span>

<span class="sd">        &gt;&gt;&gt; from muse.regressions import Exponential</span>
<span class="sd">        &gt;&gt;&gt; from muse.defaults import DATA_DIRECTORY</span>
<span class="sd">        &gt;&gt;&gt; path_to_regression_params = DATA_DIRECTORY / &quot;regressionparamaters.csv&quot;</span>
<span class="sd">        &gt;&gt;&gt; if path_to_regression_params.exists():</span>
<span class="sd">        ...     expo = Exponential.factory(path_to_regression_params)</span>

<span class="sd">    The regression function itself takes either two `xarray.DataArray` or a</span>
<span class="sd">    `xarray.Dataset` as input. In any case, it is given the gpd and</span>
<span class="sd">    population. These can be read from standard MUSE csv files:</span>

<span class="sd">        &gt;&gt;&gt; from muse.readers import read_macro_drivers</span>
<span class="sd">        &gt;&gt;&gt; from muse.defaults import DATA_DIRECTORY</span>
<span class="sd">        &gt;&gt;&gt; path_to_macrodrivers = DATA_DIRECTORY / &quot;Macrodrivers.csv&quot;</span>
<span class="sd">        &gt;&gt;&gt; if path_to_macrodrivers.exists():</span>
<span class="sd">        ...     macrodrivers = read_macro_drivers(path_to_macrodrivers)</span>
<span class="sd">        ...     demand = expo(macrodrivers, year=2010, forecast=5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__mappings__</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="sd">&quot;&quot;&quot; Maps from input names to coefficient names</span>

<span class="sd">    Maps the coefficients names in the class to their names in the input data</span>
<span class="sd">    tables. This class attribute must be overriden.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__regression__</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; Name of the regression function.</span>

<span class="sd">    This class attribute must be overriden.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">:</span> <span class="n">Text</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">base_year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2010</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="sd">&quot;&quot;&quot;Interpolation method when interpolating years&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_year</span> <span class="o">=</span> <span class="n">base_year</span>
        <span class="sd">&quot;&quot;&quot;Reference year for the start of the simulation.&quot;&quot;&quot;</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mappings__</span><span class="p">}</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mappings__</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Coefficients of the regression function.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gdp_or_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span>
        <span class="n">population</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataArray</span><span class="p">],</span>
        <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">forecast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">filters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Regression&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Regression over part of the data only.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">base_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_year</span><span class="p">,</span>
            <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="o">.</span><span class="n">data_vars</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_to_dataset</span><span class="p">(</span>
        <span class="n">first</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span> <span class="n">population</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataArray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">first</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">)</span> <span class="k">else</span> <span class="n">Dataset</span><span class="p">({</span><span class="s2">&quot;gdp&quot;</span><span class="p">:</span> <span class="n">first</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">population</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">population</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_split_kwargs</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">]:</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">filters</span><span class="p">,</span> <span class="n">attrs</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">factory</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">regression_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="n">Text</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="n">base_year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2010</span><span class="p">,</span>
        <span class="o">**</span><span class="n">filters</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Regression</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Creates a regression function from standard muse input.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">muse.readers</span> <span class="kn">import</span> <span class="n">read_regression_parameters</span>

        <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__mappings__</span>
        <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__regression__</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regression_data</span><span class="p">,</span> <span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="n">regression_data</span> <span class="o">=</span> <span class="n">read_regression_parameters</span><span class="p">(</span><span class="n">regression_data</span><span class="p">)</span>

        <span class="c1"># Get the parameters of interest with a &#39;simple&#39; name</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">regression_data</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__mappings__</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">coeffs</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">base_year</span><span class="o">=</span><span class="n">base_year</span><span class="p">,</span> <span class="o">**</span><span class="n">filters</span><span class="p">)</span>


<div class="viewcode-block" id="factory"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.factory">[docs]</a><span class="k">def</span> <span class="nf">factory</span><span class="p">(</span>
    <span class="n">regression_parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span>
    <span class="n">sector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Text</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Regression</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Creates regression functor from standard MUSE data for given sector.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">muse.readers</span> <span class="kn">import</span> <span class="n">read_regression_parameters</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regression_parameters</span><span class="p">,</span> <span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
        <span class="n">regression_parameters</span> <span class="o">=</span> <span class="n">read_regression_parameters</span><span class="p">(</span><span class="n">regression_parameters</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">regression_parameters</span> <span class="o">=</span> <span class="n">regression_parameters</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">sector</span><span class="o">=</span><span class="n">sector</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">regression_parameters</span><span class="o">.</span><span class="n">function_type</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">REGRESSION_FUNCTOR_CREATOR</span><span class="p">[</span><span class="n">value</span><span class="p">](</span><span class="n">group</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">regression_parameters</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;function_type&quot;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">regressions</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">xarray</span> <span class="kn">import</span> <span class="n">align</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">align</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">join</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">right</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">regressions</span>

    <span class="k">if</span> <span class="n">regression_parameters</span><span class="o">.</span><span class="n">function_type</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="p">():</span>
        <span class="n">functype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">regression_parameters</span><span class="o">.</span><span class="n">function_type</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">functype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">regression_parameters</span><span class="o">.</span><span class="n">function_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">regfactory</span> <span class="o">=</span> <span class="n">REGRESSION_FUNCTOR_CREATOR</span><span class="p">[</span><span class="n">functype</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">regfactory</span><span class="p">(</span><span class="n">regression_parameters</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_snake_case</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">sub</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="s2">&quot;(.)([A-Z][a-z]+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1_\2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sub</span><span class="p">(</span><span class="s2">&quot;([a-z0-9])([A-Z])&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1_\2&quot;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_kebab_case</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">sub</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="s2">&quot;(.)([A-Z][a-z]+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1-\2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sub</span><span class="p">(</span><span class="s2">&quot;([a-z0-9])([A-Z])&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1-\2&quot;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<div class="viewcode-block" id="register_regression"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.register_regression">[docs]</a><span class="k">def</span> <span class="nf">register_regression</span><span class="p">(</span>
    <span class="n">Functor</span><span class="p">:</span> <span class="n">Regression</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Text</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Regression</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Registers a functor with MUSE regressions.</span>

<span class="sd">    Regression functors are registered with MUSE so that the functors can be</span>
<span class="sd">    called easily on created.</span>

<span class="sd">    functor name that the functor is registered with defaults to the snake_case</span>
<span class="sd">    version of the functor name.  However, it can also be specified explicitly</span>
<span class="sd">    as a *keyword* argument. In any case, it must be unique amongst all</span>
<span class="sd">    registered regression functor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
    <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
    <span class="kn">from</span> <span class="nn">muse.registration</span> <span class="kn">import</span> <span class="n">name_variations</span>

    <span class="c1"># allows specifyng the registered name as a keyword argument</span>
    <span class="k">if</span> <span class="n">Functor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">register_regression</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="n">file_or_dataset</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_or_dataset</span><span class="p">,</span> <span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="n">Text</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Creating regression functor </span><span class="si">{}</span><span class="s2"> from data in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_kebab_case</span><span class="p">(</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Functor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span>
                <span class="n">file_or_dataset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Creating regression functor </span><span class="si">{}</span><span class="s2"> from dataset&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_kebab_case</span><span class="p">(</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Functor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Functor</span><span class="p">,</span> <span class="s2">&quot;factory&quot;</span><span class="p">,</span> <span class="n">Functor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">file_or_dataset</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="n">_snake_case</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">{</span><span class="n">Functor</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">}</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">REGRESSION_FUNCTOR_NAMES</span><span class="p">[</span><span class="n">Functor</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">name_variations</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">REGRESSION_FUNCTOR_CREATOR</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;A regression with the name </span><span class="si">%s</span><span class="s2"> already exists&quot;</span> <span class="o">%</span> <span class="n">n</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">REGRESSION_FUNCTOR_CREATOR</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">factory</span>
        <span class="n">REGRESSION_FUNCTOR_NAMES</span><span class="p">[</span><span class="n">Functor</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Functor</span></div>


<span class="k">def</span> <span class="nf">regression_functor</span><span class="p">(</span>
    <span class="n">mappings</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Text</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Text</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Regression</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Creates a macro-driver functor from a function.</span>

<span class="sd">    The functions are transformed into classes inheriting from Regression.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        mappings: a dictionary mapping from the functions expected coefficients</span>
<span class="sd">            (e.g. a, b, c) to the name in the input csv data tables (.e.g.</span>
<span class="sd">            constant, GDPexp, GDPscale).</span>
<span class="sd">        name: name by which the function is refered to in the input data table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;The function will be turned into a class. &quot;</span>
                <span class="s2">&quot;It&#39;s name should be capitalized.&quot;</span>
            <span class="p">)</span>

        <span class="n">name_</span> <span class="o">=</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">classname</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="s2">&quot;Calling </span><span class="si">{}</span><span class="s2"> regression function&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_kebab_case</span><span class="p">(</span><span class="n">classname</span><span class="p">))</span>

        <span class="c1"># the main function will transform the input so &#39;func&#39; can deal with it</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">gdp_or_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span>
            <span class="n">population</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">forecast</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndarray</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_dataset</span><span class="p">(</span><span class="n">gdp_or_dataset</span><span class="p">,</span> <span class="n">population</span><span class="p">)</span>
            <span class="n">filters</span><span class="p">,</span> <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_kwargs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">years</span> <span class="o">=</span> <span class="n">year</span>
            <span class="k">if</span> <span class="n">forecast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;year&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                <span class="n">years</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">year</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="p">(</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">forecast</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span>
                    <span class="n">forecast</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;forecast&quot;</span><span class="p">:</span> <span class="n">forecast</span><span class="p">},</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;forecast&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">forecast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">years</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">years</span> <span class="o">=</span> <span class="n">years</span> <span class="o">+</span> <span class="n">forecast</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">years</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                    <span class="n">year</span><span class="o">=</span><span class="n">years</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
                    <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
            <span class="c1"># for the duration of the call, change coeffs to allow for</span>
            <span class="c1"># selections</span>
            <span class="n">old_coeffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">forecast</span><span class="o">=</span><span class="n">forecast</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="n">old_coeffs</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        This function accepts extra keyword arguments to filter over the</span>
<span class="s2">        dimensions of the input data-array.</span>

<span class="s2">        Furthermore, the gdp and population can be passed as a single argument</span>

<span class="s2">        if the first argument (not including self) is a dataset, then it is</span>
<span class="s2">        expected it should hold both the gdp and population. If population is</span>
<span class="s2">        also given, it will override population in the dataset argument.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="fm">__call__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="fm">__call__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">msg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="fm">__call__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;Regression function: </span><span class="si">{}</span><span class="se">\n\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name_</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Regression function: </span><span class="si">{name}</span><span class="s2"></span>

<span class="s2">        This functor is a regression function registered with MUSE as &#39;</span><span class="si">{name}</span><span class="s2">&#39;.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name_</span>
        <span class="p">)</span>

        <span class="n">Self</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span>
            <span class="n">classname</span><span class="p">,</span>
            <span class="p">(</span><span class="n">Regression</span><span class="p">,),</span>
            <span class="p">{</span>
                <span class="s2">&quot;__regression__&quot;</span><span class="p">:</span> <span class="n">name_</span><span class="p">,</span>
                <span class="s2">&quot;__mappings__&quot;</span><span class="p">:</span> <span class="n">mappings</span><span class="p">,</span>
                <span class="s2">&quot;__call__&quot;</span><span class="p">:</span> <span class="fm">__call__</span><span class="p">,</span>
                <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">func</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
                <span class="s2">&quot;__doc__&quot;</span><span class="p">:</span> <span class="n">doc</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Self</span>

    <span class="k">return</span> <span class="n">decorator</span>


<div class="viewcode-block" id="Exponential"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.Exponential">[docs]</a><span class="nd">@register_regression</span>
<span class="nd">@regression_functor</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPexp&quot;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">Exponential</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">gdp</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span>

    <span class="n">factor</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">population</span>
    <span class="k">return</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">population</span> <span class="o">/</span> <span class="n">gdp</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExponentialAdj"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.ExponentialAdj">[docs]</a><span class="nd">@register_regression</span>
<span class="nd">@regression_functor</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPexp&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="s2">&quot;ConstantAdjDem&quot;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">ExponentialAdj</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">gdp</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">forecast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">power</span>

    <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_year</span>

    <span class="n">factor</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">population</span>
    <span class="n">unadjusted</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">population</span> <span class="o">/</span> <span class="n">gdp</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span><span class="n">year</span> <span class="o">+</span> <span class="n">forecast</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_year</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unadjusted</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span></div>


<div class="viewcode-block" id="Logistic"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.Logistic">[docs]</a><span class="nd">@register_regression</span>
<span class="nd">@regression_functor</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPscale&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPexp&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="s2">&quot;timeEff&quot;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">Logistic</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">gdp</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span> <span class="n">forecast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; (1 + t * f^n) / (1 + f^n) * a * pop / (1 + b * e^(gpd * c / pop))</span>

<span class="sd">    With f the number of forecast years.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="n">power</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">w</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">population</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">factor</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">gdp</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">population</span><span class="p">))</span></div>


<div class="viewcode-block" id="Loglog"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.Loglog">[docs]</a><span class="nd">@register_regression</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;log-log&quot;</span><span class="p">)</span>
<span class="nd">@regression_functor</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPexp&quot;</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">Loglog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdp</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; 1e6 * e^a * population * (gpd/population)^b &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">power</span><span class="p">,</span> <span class="n">exp</span>

    <span class="n">factor</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">population</span>
    <span class="k">return</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">power</span><span class="p">(</span><span class="n">gdp</span> <span class="o">/</span> <span class="n">population</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogisticSigmoid"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.LogisticSigmoid">[docs]</a><span class="nd">@register_regression</span>
<span class="nd">@regression_functor</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;b0&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPscaleLess&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPscaleGreater&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPexp&quot;</span><span class="p">}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">LogisticSigmoid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">gdp</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">DataArray</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; 1e6 * (a * pop + gdp * c / sqrt(1 + (gdp * scale / pop)^2) &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">power</span>

    <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_year</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b0</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2015</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b1</span>
    <span class="k">elif</span> <span class="n">year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;year&quot;</span> <span class="ow">in</span> <span class="n">gdp</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
        <span class="c1"># fmt: disable</span>
        <span class="n">years</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">year</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">DataArray</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">year</span><span class="p">},</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># fmt: enable</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b0</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">years</span> <span class="o">&lt;</span> <span class="mi">2015</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">gdp</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">/</span> <span class="n">population</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="p">(</span><span class="n">population</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">gdp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span></div>


<div class="viewcode-block" id="Linear"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.Linear">[docs]</a><span class="nd">@register_regression</span>
<span class="k">class</span> <span class="nc">Linear</span><span class="p">(</span><span class="n">Regression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; a * population + b * (gdp - gdp[2010]/population[2010] * population)&quot;&quot;&quot;</span>

    <span class="n">__mappings__</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;b0&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPscaleLess&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">:</span> <span class="s2">&quot;GDPscaleGreater&quot;</span><span class="p">}</span>

    <span class="n">__regression__</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
    <span class="n">__scaleyear__</span> <span class="o">=</span> <span class="mi">2015</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gdp_or_dataset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span>
        <span class="n">population</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">forecast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>

        <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calling linear regression function&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_dataset</span><span class="p">(</span><span class="n">gdp_or_dataset</span><span class="p">,</span> <span class="n">population</span><span class="p">)</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_kwargs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">coeffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">filters</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="n">forecast</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaleyear__</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">b0</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">b1</span>
        <span class="k">elif</span> <span class="n">year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;year&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="c1"># fmt: disable</span>
            <span class="n">years</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">year</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">DataArray</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">year</span><span class="p">},</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># fmt: enable</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">years</span> <span class="o">+</span> <span class="n">forecast</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaleyear__</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">b0</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">b0</span>
        <span class="n">data_baseyear</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_year</span><span class="p">)</span>
        <span class="n">gdpcap_offset</span> <span class="o">=</span> <span class="n">data_baseyear</span><span class="o">.</span><span class="n">gdp</span> <span class="o">/</span> <span class="n">data_baseyear</span><span class="o">.</span><span class="n">population</span>

        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;year&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">gdp</span> <span class="o">-</span> <span class="n">gdpcap_offset</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="endogenous_demand"><a class="viewcode-back" href="../../source/muse.html#muse.regressions.endogenous_demand">[docs]</a><span class="k">def</span> <span class="nf">endogenous_demand</span><span class="p">(</span>
    <span class="n">regression_parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span>
    <span class="n">drivers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">],</span>
    <span class="n">sector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Endogenous demand based on macro drivers and regression parameters.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">muse.readers</span> <span class="kn">import</span> <span class="n">read_macro_drivers</span>

    <span class="n">regression</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="n">regression_parameters</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="n">sector</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drivers</span><span class="p">,</span> <span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
        <span class="n">drivers</span> <span class="o">=</span> <span class="n">read_macro_drivers</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">regression</span><span class="p">(</span><span class="n">drivers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MUSE Documentation 0.8 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">muse.regressions</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Sustainable Gas Institute.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
  </body>
</html>