
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>muse package &#8212; MUSE Documentation 0.8 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MUSE Documentation 0.8 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">muse package</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="muse-package">
<h1>muse package<a class="headerlink" href="#muse-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="muse.agents.html">muse.agents package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="muse.agents.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.agents.html#module-muse.agents.agent">muse.agents.agent module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.agents.html#module-muse.agents.factories">muse.agents.factories module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.agents.html#module-muse.agents">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="muse.outputs.html">muse.outputs package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="muse.outputs.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.outputs.html#module-muse.outputs.mca">muse.outputs.mca module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.outputs.html#module-muse.outputs.sector">muse.outputs.sector module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.outputs.html#module-muse.outputs.sinks">muse.outputs.sinks module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.outputs.html#module-muse.outputs">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="muse.readers.html">muse.readers package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="muse.readers.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.readers.html#module-muse.readers.csv">muse.readers.csv module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.readers.html#module-muse.readers.toml">muse.readers.toml module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.readers.html#module-muse.readers">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="muse.sectors.html">muse.sectors package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#module-muse.sectors.abstract">muse.sectors.abstract module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#module-muse.sectors.legacy_sector">muse.sectors.legacy_sector module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#module-muse.sectors.preset_sector">muse.sectors.preset_sector module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#module-muse.sectors.register">muse.sectors.register module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#module-muse.sectors.sector">muse.sectors.sector module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#module-muse.sectors.subsector">muse.sectors.subsector module</a></li>
<li class="toctree-l2"><a class="reference internal" href="muse.sectors.html#module-muse.sectors">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-muse.carbon_budget">
<span id="muse-carbon-budget-module"></span><h2>muse.carbon_budget module<a class="headerlink" href="#module-muse.carbon_budget" title="Permalink to this headline">¶</a></h2>
<dl class="py data">
<dt id="muse.carbon_budget.CARBON_BUDGET_FITTERS">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">CARBON_BUDGET_FITTERS</code><em class="property">: MutableMapping<span class="p">[</span>str<span class="p">, </span>Callable<span class="p">[</span><span class="p">[</span>numpy.ndarray<span class="p">, </span>numpy.ndarray<span class="p">, </span>int<span class="p">]</span><span class="p">, </span>float<span class="p">]</span><span class="p">]</span></em><em class="property"> = {'Exponential': &lt;function exponential&gt;, 'Linear': &lt;function linear&gt;, 'exponential': &lt;function exponential&gt;, 'linear': &lt;function linear&gt;}</em><a class="headerlink" href="#muse.carbon_budget.CARBON_BUDGET_FITTERS" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of carbon budget fitters.</p>
</dd></dl>

<dl class="py data">
<dt id="muse.carbon_budget.CARBON_BUDGET_FITTERS_SIGNATURE">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">CARBON_BUDGET_FITTERS_SIGNATURE</code><a class="headerlink" href="#muse.carbon_budget.CARBON_BUDGET_FITTERS_SIGNATURE" title="Permalink to this definition">¶</a></dt>
<dd><p>carbon budget fitters signature.</p>
<p>alias of Callable[[numpy.ndarray, numpy.ndarray, int], float]</p>
</dd></dl>

<dl class="py data">
<dt id="muse.carbon_budget.CARBON_BUDGET_METHODS">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">CARBON_BUDGET_METHODS</code><a class="headerlink" href="#muse.carbon_budget.CARBON_BUDGET_METHODS" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of carbon budget methods checks.</p>
</dd></dl>

<dl class="py data">
<dt id="muse.carbon_budget.CARBON_BUDGET_METHODS_SIGNATURE">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">CARBON_BUDGET_METHODS_SIGNATURE</code><a class="headerlink" href="#muse.carbon_budget.CARBON_BUDGET_METHODS_SIGNATURE" title="Permalink to this definition">¶</a></dt>
<dd><p>carbon budget fitters signature.</p>
<p>alias of Callable[[xarray.core.dataset.Dataset, list, Callable, xarray.core.dataarray.DataArray, xarray.core.dataarray.DataArray], float]</p>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.create_sample">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">create_sample</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">carbon_price</span></em>, <em class="sig-param"><span class="n">current_emissions</span></em>, <em class="sig-param"><span class="n">budget</span></em>, <em class="sig-param"><span class="n">size</span><span class="o">=</span><span class="default_value">4</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/carbon_budget.html#create_sample"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.create_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates a sample of carbon prices to estimate the adjusted carbon
price.</p>
<p>For each of these prices, the equilibrium loop will be run, obtaining a new value
for the emissions. Out of those price-emissions pairs, the final carbon price will
be estimated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>carbon_price</strong> – Current carbon price</p></li>
<li><p><strong>current_emissions</strong> – Current emissions</p></li>
<li><p><strong>budget</strong> – Carbon budget</p></li>
<li><p><strong>size</strong> – Number of points in the sample</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An array with the sample prices.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.exp_guess_and_weights">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">exp_guess_and_weights</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">emissions</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">budget</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span> &#x2192; tuple<a class="reference internal" href="../_modules/muse/carbon_budget.html#exp_guess_and_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.exp_guess_and_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimates initial values for the exponential fitting algorithm and the
weights.</p>
<p>The points closest to the budget are used to estimate the initial guess. They also
have the highest weight.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prices</strong> – An array with the sample carbon prices</p></li>
<li><p><strong>emissions</strong> – An array with the corresponding emissions</p></li>
<li><p><strong>budget</strong> – The carbon budget for the time period</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The initial guess and weights</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.exponential">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">exponential</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">emissions</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">budget</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/muse/carbon_budget.html#exponential"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.exponential" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits the prices-emissions pairs to an exponential function.</p>
<p>Once that is done, an optimal carbon price is estimated</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prices</strong> – An array with the sample carbon prices</p></li>
<li><p><strong>emissions</strong> – An array with the corresponding emissions</p></li>
<li><p><strong>budget</strong> – The carbon budget for the time period</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The optimal carbon price.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.exponential_fun">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">exponential_fun</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">a</span></em>, <em class="sig-param"><span class="n">b</span></em>, <em class="sig-param"><span class="n">c</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/carbon_budget.html#exponential_fun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.exponential_fun" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.fitting">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">fitting</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">sectors</span><span class="p">:</span> <span class="n">list</span></em>, <em class="sig-param"><span class="n">equilibrium</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>Sequence<span class="p">[</span><a class="reference internal" href="muse.sectors.html#muse.sectors.abstract.AbstractSector" title="muse.sectors.abstract.AbstractSector">muse.sectors.abstract.AbstractSector</a><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference internal" href="#muse.mca.FindEquilibriumResults" title="muse.mca.FindEquilibriumResults">muse.mca.FindEquilibriumResults</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">carbon_budget</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">carbon_price</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">commodities</span><span class="p">:</span> <span class="n">list</span></em>, <em class="sig-param"><span class="n">sample_size</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">4</span></em>, <em class="sig-param"><span class="n">refine_price</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">price_too_high_threshold</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">10</span></em>, <em class="sig-param"><span class="n">fitter</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'slinear'</span></em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/muse/carbon_budget.html#fitting"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.fitting" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.linear">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">linear</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">emissions</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">budget</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/muse/carbon_budget.html#linear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.linear" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits the prices-emissions pairs to a linear function.</p>
<p>Once that is done, an optimal carbon price is estimated</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prices</strong> – An array with the sample carbon prices</p></li>
<li><p><strong>emissions</strong> – An array with the corresponding emissions</p></li>
<li><p><strong>budget</strong> – The carbon budget for the time period</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The optimal carbon price.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.linear_fun">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">linear_fun</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">a</span></em>, <em class="sig-param"><span class="n">b</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/carbon_budget.html#linear_fun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.linear_fun" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.linear_guess_and_weights">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">linear_guess_and_weights</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">emissions</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">budget</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span> &#x2192; tuple<a class="reference internal" href="../_modules/muse/carbon_budget.html#linear_guess_and_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.linear_guess_and_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimates initial values for the linear fitting algorithm and the
weights.</p>
<p>The points closest to the budget are used to estimate the initial guess. They also
have the highest weight.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The initial guess and weights</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.refine_new_price">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">refine_new_price</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">historic_price</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">carbon_budget</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">sample</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">price</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">commodities</span><span class="p">:</span> <span class="n">list</span></em>, <em class="sig-param"><span class="n">price_too_high_threshold</span><span class="p">:</span> <span class="n">float</span></em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/muse/carbon_budget.html#refine_new_price"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.refine_new_price" title="Permalink to this definition">¶</a></dt>
<dd><p>Refine the value of the carbon price to ensure it is not too high or low.
:param market: Market, with the prices, supply, consumption and demand.
:param historic_price: DataArray with the historic carbon prices.
:param carbon_budget: DataArray with the carbon budget.
:param sample: Sample carbon price points.
:param price: Current carbon price, to be refined.
:param commodities: List of carbon-related commodities.
:param price_too_high_threshold: Threshold to decide what is a price too high.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A refined carbon price.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.register_carbon_budget_fitter">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">register_carbon_budget_fitter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>numpy.ndarray<span class="p">, </span>numpy.ndarray<span class="p">, </span>int<span class="p">]</span><span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/carbon_budget.html#register_carbon_budget_fitter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.register_carbon_budget_fitter" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a carbon budget function.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.register_carbon_budget_method">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">register_carbon_budget_method</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>list<span class="p">, </span>Callable<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/carbon_budget.html#register_carbon_budget_method"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.register_carbon_budget_method" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a carbon budget function.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.carbon_budget.update_carbon_budget">
<code class="sig-prename descclassname">muse.carbon_budget.</code><code class="sig-name descname">update_carbon_budget</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">carbon_budget</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span>float<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">emissions</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">year_idx</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">over</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">under</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/muse/carbon_budget.html#update_carbon_budget"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.carbon_budget.update_carbon_budget" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjust the carbon budget in the far future if emissions too high or low.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>An adjusted threshold for the far future year</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-muse.commodities">
<span id="muse-commodities-module"></span><h2>muse.commodities module<a class="headerlink" href="#module-muse.commodities" title="Permalink to this headline">¶</a></h2>
<p>Methods and types around commodities.</p>
<dl class="py class">
<dt id="muse.commodities.CommodityUsage">
<em class="property">class </em><code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">CommodityUsage</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/commodities.html#CommodityUsage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.CommodityUsage" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntFlag</span></code></p>
<p>Flags to specify the different kinds of commodities.</p>
<p>For details on how <code class="docutils literal notranslate"><span class="pre">enum</span></code>’s work, see <a class="reference external" href="https://docs.python.org/3/library/enum.html#intflag">python’s documentation</a>. In practice,
<a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommodityUsage</span></code></a> centralizes in one place the different kinds of
commodities that are meaningfull to the generalized sector, e.g. commodities that
are consumed by the sector, and commodities that produced by the sectors, as well
commodities that are, somehow, <em>environmental</em>.</p>
<p>With the exception of <code class="docutils literal notranslate"><span class="pre">CommodityUsage.OTHER</span></code>, flags can be combined in any
fashion. <code class="docutils literal notranslate"><span class="pre">CommodityUsage.PRODUCT</span> <span class="pre">|</span> <span class="pre">CommodityUsage.CONSUMABLE</span></code> is a commodity that
is both consumed and produced by a sector. <code class="docutils literal notranslate"><span class="pre">CommodityUsage.ENVIRONMENTAL</span> <span class="pre">|</span>
<span class="pre">CommodityUsage.ENERGY</span> <span class="pre">|</span> <span class="pre">CommodityUsage.CONSUMABLE</span></code> is an environmental energy
commodity consumed by the sector.</p>
<p><code class="docutils literal notranslate"><span class="pre">CommodityUsage.OTHER</span></code> is an alias for <em>no</em> flag. It is meant for commodities
that should be ignored by the sector.</p>
<dl class="py attribute">
<dt id="muse.commodities.CommodityUsage.CONSUMABLE">
<code class="sig-name descname">CONSUMABLE</code><em class="property"> = 1</em><a class="headerlink" href="#muse.commodities.CommodityUsage.CONSUMABLE" title="Permalink to this definition">¶</a></dt>
<dd><p>Commodity which can be consumed by the sector.</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.commodities.CommodityUsage.ENERGY">
<code class="sig-name descname">ENERGY</code><em class="property"> = 8</em><a class="headerlink" href="#muse.commodities.CommodityUsage.ENERGY" title="Permalink to this definition">¶</a></dt>
<dd><p>Commodity which is a fuel for this or another sector.</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.commodities.CommodityUsage.ENVIRONMENTAL">
<code class="sig-name descname">ENVIRONMENTAL</code><em class="property"> = 4</em><a class="headerlink" href="#muse.commodities.CommodityUsage.ENVIRONMENTAL" title="Permalink to this definition">¶</a></dt>
<dd><p>Commodity which is a pollutant.</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.commodities.CommodityUsage.OTHER">
<code class="sig-name descname">OTHER</code><em class="property"> = 0</em><a class="headerlink" href="#muse.commodities.CommodityUsage.OTHER" title="Permalink to this definition">¶</a></dt>
<dd><p>Not relevant for current sector.</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.commodities.CommodityUsage.PRODUCT">
<code class="sig-name descname">PRODUCT</code><em class="property"> = 2</em><a class="headerlink" href="#muse.commodities.CommodityUsage.PRODUCT" title="Permalink to this definition">¶</a></dt>
<dd><p>Commodity which can be produced by the sector.</p>
</dd></dl>

<dl class="py method">
<dt id="muse.commodities.CommodityUsage.from_technologies">
<em class="property">static </em><code class="sig-name descname">from_technologies</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/commodities.html#CommodityUsage.from_technologies"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.CommodityUsage.from_technologies" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="muse.commodities.check_usage">
<code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">check_usage</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">flag</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">match</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'all'</span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/muse/commodities.html#check_usage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.check_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Match usage flags with input data array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – sequence for which to match flags elementwise.</p></li>
<li><p><strong>flag</strong> – flag or combination of flags to match. The input can be a string, such as
“product | environmental”, or a CommodityUsage instance.
Defaults to “other”.</p></li>
<li><p><strong>match</strong> – one of:
- “all”: should all flag match. Default.
- “any”, should match at least one flags.
- “exact”, should match each flag and nothing else.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.commodities</span> <span class="kn">import</span> <span class="n">CommodityUsage</span><span class="p">,</span> <span class="n">check_usage</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
</pre></div>
</div>
<p>Matching “all”:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, True, True, False]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, False, True, True]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">data</span><span class="p">,</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, False, True, False]</span>
</pre></div>
</div>
<p>Matching “any”:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, True, True, False]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, False, True, True]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;environmental | product&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, True, True, True]</span>
</pre></div>
</div>
<p>Matching “exact”:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;PRODUCT&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, True, False, False]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, False, False, True]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;ENVIRONMENTAL | PRODUCT&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, False, True, False]</span>
</pre></div>
</div>
<p>Finally, checking no flags has been set can be done with:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[True, False, False, False]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[True, False, False, False]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.commodities.is_consumable">
<code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">is_consumable</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/muse/commodities.html#is_consumable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.is_consumable" title="Permalink to this definition">¶</a></dt>
<dd><p>Any consumable.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.commodities</span> <span class="kn">import</span> <span class="n">CommodityUsage</span><span class="p">,</span> <span class="n">is_consumable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_consumable</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[True, False, False, True, False]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.commodities.is_enduse">
<code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">is_enduse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/muse/commodities.html#is_enduse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.is_enduse" title="Permalink to this definition">¶</a></dt>
<dd><p>Non-environmental product.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.commodities</span> <span class="kn">import</span> <span class="n">CommodityUsage</span><span class="p">,</span> <span class="n">is_enduse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_enduse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, True, False, True, False]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.commodities.is_fuel">
<code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">is_fuel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/muse/commodities.html#is_fuel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.is_fuel" title="Permalink to this definition">¶</a></dt>
<dd><p>Any consumable energy.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.commodities</span> <span class="kn">import</span> <span class="n">CommodityUsage</span><span class="p">,</span> <span class="n">is_fuel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span>
<span class="gp">... </span>        <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span>
<span class="gp">... </span>        <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_fuel</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, False, False, True, True, True, False]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.commodities.is_material">
<code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">is_material</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/muse/commodities.html#is_material"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.is_material" title="Permalink to this definition">¶</a></dt>
<dd><p>Any non-energy non-environmental consumable.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.commodities</span> <span class="kn">import</span> <span class="n">CommodityUsage</span><span class="p">,</span> <span class="n">is_material</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENERGY</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span>
<span class="gp">... </span>        <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_material</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[True, False, False, False, False, False, True]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.commodities.is_other">
<code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">is_other</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/muse/commodities.html#is_other"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.is_other" title="Permalink to this definition">¶</a></dt>
<dd><p>No flags are set.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.commodities</span> <span class="kn">import</span> <span class="n">CommodityUsage</span><span class="p">,</span> <span class="n">is_other</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_other</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[True, False, False]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.commodities.is_pollutant">
<code class="sig-prename descclassname">muse.commodities.</code><code class="sig-name descname">is_pollutant</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="#muse.commodities.CommodityUsage" title="muse.commodities.CommodityUsage">muse.commodities.CommodityUsage</a><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/muse/commodities.html#is_pollutant"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.commodities.is_pollutant" title="Permalink to this definition">¶</a></dt>
<dd><p>Environmental product.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.commodities</span> <span class="kn">import</span> <span class="n">CommodityUsage</span><span class="p">,</span> <span class="n">is_pollutant</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">CONSUMABLE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">ENVIRONMENTAL</span> <span class="o">|</span> <span class="n">CommodityUsage</span><span class="o">.</span><span class="n">PRODUCT</span><span class="p">,</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_pollutant</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[False, False, False, False, True]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-muse.conftest">
<span id="muse-conftest-module"></span><h2>muse.conftest module<a class="headerlink" href="#module-muse.conftest" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="muse.conftest.add_np">
<code class="sig-prename descclassname">muse.conftest.</code><code class="sig-name descname">add_np</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doctest_namespace</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/conftest.html#add_np"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.conftest.add_np" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-muse.constraints">
<span id="muse-constraints-module"></span><h2>muse.constraints module<a class="headerlink" href="#module-muse.constraints" title="Permalink to this headline">¶</a></h2>
<p>Investment constraints.</p>
<p>Constraints on investements ensure that investements match some given criteria. For
instance, the constraints could ensure that only so much of a new asset can be built
every year.</p>
<p>Functions to compute constraints should be registered via the decorator
<a class="reference internal" href="#muse.constraints.register_constraints" title="muse.constraints.register_constraints"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_constraints()</span></code></a>. This registration step makes it
possible for constraints to be declared in the TOML file.</p>
<p>Generally, LP solvers accept linear constraint defined as:</p>
<div class="math notranslate nohighlight">
\[A x \leq b\]</div>
<p>with <span class="math notranslate nohighlight">\(A\)</span> a matrix, <span class="math notranslate nohighlight">\(x\)</span> the decision variables, and <span class="math notranslate nohighlight">\(b\)</span> a vector.
However, these quantities are dimensionless. They do no have timeslices, assets, or
replacement technologies, or any other dimensions that users have set-up in their model.
The crux is to translates from MUSE’s data-structures to a consistent dimensionless
format.</p>
<p>In MUSE, users can register constraints functions that return fully dimensional
quantities. The matrix operator is split over the capacity decision variables and the
production decision variables:</p>
<div class="math notranslate nohighlight">
\[A_c .* x_c + A_p .* x_p \leq b\]</div>
<p>The operator <span class="math notranslate nohighlight">\(.*\)</span> means the standard elementwise multiplication of xarray,
including automatic broadcasting (adding missing dimensions by repeating the smaller
matrix along the missing dimension).  Constraint functions return the three quantities
<span class="math notranslate nohighlight">\(A_c\)</span>, <span class="math notranslate nohighlight">\(A_p\)</span>, and <span class="math notranslate nohighlight">\(b\)</span>. These three quantities will often not have the
same dimension. E.g. one might include timeslices where another might not. The
transformation from <span class="math notranslate nohighlight">\(A_c\)</span>, <span class="math notranslate nohighlight">\(A_p\)</span>, <span class="math notranslate nohighlight">\(b\)</span> to <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span>
happens as described below.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(b\)</span> remains the same. It defines the rows of <span class="math notranslate nohighlight">\(A\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(x_c\)</span> and <span class="math notranslate nohighlight">\(x_p\)</span> are concatenated one on top of the other and define the
columns of <span class="math notranslate nohighlight">\(A\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(A\)</span> is split into a left submatrix for capacities and a right submatrix for
production, following the concatenation of <span class="math notranslate nohighlight">\(x_c\)</span> and <span class="math notranslate nohighlight">\(x_p\)</span></p></li>
<li><p>Any dimension in <span class="math notranslate nohighlight">\(A_c .* x_c\)</span> (<span class="math notranslate nohighlight">\(A_p .* x_p\)</span>) that is also in <span class="math notranslate nohighlight">\(b\)</span>
defines diagonal entries into the left (right) submatrix of <span class="math notranslate nohighlight">\(A\)</span>.</p></li>
<li><p>Any dimension in <span class="math notranslate nohighlight">\(A_c .* x_c\)</span> (<span class="math notranslate nohighlight">\(A_p .* x_b\)</span>) and missing from
<span class="math notranslate nohighlight">\(b\)</span> is reduce by summation over a row in the left (right) submatrix of
<span class="math notranslate nohighlight">\(A\)</span>. In other words, those dimension do become part of a standard tensor
reduction or matrix multiplication.</p></li>
</ul>
<p>There are two additional rules. However, they are likely to be the result of an
inefficient defininition of <span class="math notranslate nohighlight">\(A_c\)</span>, <span class="math notranslate nohighlight">\(A_p\)</span> and <span class="math notranslate nohighlight">\(b\)</span>.</p>
<ul class="simple">
<li><p>Any dimension in <span class="math notranslate nohighlight">\(A_c\)</span> (<span class="math notranslate nohighlight">\(A_b\)</span>) that is neither in <span class="math notranslate nohighlight">\(b\)</span> nor in
<span class="math notranslate nohighlight">\(x_c\)</span> (<span class="math notranslate nohighlight">\(x_p\)</span>) is reduced by summation before consideration for the
elementwise multiplication. For instance, if <span class="math notranslate nohighlight">\(d\)</span> is such a dimension, present
only in <span class="math notranslate nohighlight">\(A_c\)</span>, then the problem becomes <span class="math notranslate nohighlight">\((\sum_d A_c) .* x_c + A_p .* x_p
\leq b\)</span>.</p></li>
<li><p>Any dimension missing from <span class="math notranslate nohighlight">\(A_c .* x_c\)</span> (<span class="math notranslate nohighlight">\(A_p .* x_p\)</span>) and present in
<span class="math notranslate nohighlight">\(b\)</span> is added by repeating the resulting row in <span class="math notranslate nohighlight">\(A\)</span>.</p></li>
</ul>
<p>Constraints are registered using the decorator
<a class="reference internal" href="#muse.constraints.register_constraints" title="muse.constraints.register_constraints"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_constraints()</span></code></a>. The decorated functions must follow
the following signature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_constraints</span>
<span class="k">def</span> <span class="nf">constraints</span><span class="p">(</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">assets</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">market</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">technologies</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Constraint</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="simple">
<dt>demand:</dt><dd><p>The demand for the sectors products. In practice it is a demand share obtained in
<a class="reference internal" href="#module-muse.demand_share" title="muse.demand_share"><code class="xref py py-mod docutils literal notranslate"><span class="pre">demand_share</span></code></a>. It is a data-array with dimensions including <cite>asset</cite>,
<cite>commodity</cite>, <cite>timeslice</cite>.</p>
</dd>
<dt>assets:</dt><dd><p>The capacity of the assets owned by the agent.</p>
</dd>
<dt>search_space:</dt><dd><p>A matrix <cite>asset</cite> vs <cite>replacement</cite> technology defining which replacement technologies
will be considered for each existing asset.</p>
</dd>
<dt>market:</dt><dd><p>The market as obtained from the MCA.</p>
</dd>
<dt>technologies:</dt><dd><p>Technodata characterizing the competing technologies.</p>
</dd>
<dt>year:</dt><dd><p>current year.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>:</dt><dd><p>Any other parameter.</p>
</dd>
</dl>
<dl class="py data">
<dt id="muse.constraints.CAPACITY_DIMS">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">CAPACITY_DIMS</code><em class="property"> = ('asset', 'replacement', 'region')</em><a class="headerlink" href="#muse.constraints.CAPACITY_DIMS" title="Permalink to this definition">¶</a></dt>
<dd><p>Default dimensions for capacity decision variables.</p>
</dd></dl>

<dl class="py data">
<dt id="muse.constraints.CONSTRAINTS">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">CONSTRAINTS</code><em class="property">: MutableMapping<span class="p">[</span>Text<span class="p">, </span>CONSTRAINT_SIGNATURE<span class="p">]</span></em><em class="property"> = {'Demand': &lt;function demand&gt;, 'MaxCapacityExpansion': &lt;function max_capacity_expansion&gt;, 'MaxProduction': &lt;function max_production&gt;, 'MinimumService': &lt;function minimum_service&gt;, 'SearchSpace': &lt;function search_space&gt;, 'demand': &lt;function demand&gt;, 'max-capacity-expansion': &lt;function max_capacity_expansion&gt;, 'max-production': &lt;function max_production&gt;, 'maxCapacityExpansion': &lt;function max_capacity_expansion&gt;, 'maxProduction': &lt;function max_production&gt;, 'max_capacity_expansion': &lt;function max_capacity_expansion&gt;, 'max_production': &lt;function max_production&gt;, 'maxcapacityexpansion': &lt;function max_capacity_expansion&gt;, 'maxproduction': &lt;function max_production&gt;, 'minimum-service': &lt;function minimum_service&gt;, 'minimumService': &lt;function minimum_service&gt;, 'minimum_service': &lt;function minimum_service&gt;, 'minimumservice': &lt;function minimum_service&gt;, 'search-space': &lt;function search_space&gt;, 'searchSpace': &lt;function search_space&gt;, 'search_space': &lt;function search_space&gt;, 'searchspace': &lt;function search_space&gt;}</em><a class="headerlink" href="#muse.constraints.CONSTRAINTS" title="Permalink to this definition">¶</a></dt>
<dd><p>Registry of constraint functions.</p>
</dd></dl>

<dl class="py data">
<dt id="muse.constraints.CONSTRAINT_SIGNATURE">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">CONSTRAINT_SIGNATURE</code><a class="headerlink" href="#muse.constraints.CONSTRAINT_SIGNATURE" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic signature for functions producing constraints.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A constraint can return <cite>None</cite>, in which case it is ignored. This makes it simple to
add constraints that are only used if some condition is met, e.g. minimum service
conditions are defined in the technodata.</p>
</div>
<p>alias of Callable[[xarray.core.dataarray.DataArray, xarray.core.dataset.Dataset, xarray.core.dataarray.DataArray, xarray.core.dataset.Dataset, xarray.core.dataset.Dataset, Any], Optional[xarray.core.dataset.Dataset]]</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.Constraint">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">Constraint</code><a class="headerlink" href="#muse.constraints.Constraint" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">xarray.core.dataset.Dataset</span></code></p>
</dd></dl>

<dl class="py class">
<dt id="muse.constraints.ConstraintKind">
<em class="property">class </em><code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">ConstraintKind</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/constraints.html#ConstraintKind"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.ConstraintKind" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></p>
<p>An enumeration.</p>
<dl class="py attribute">
<dt id="muse.constraints.ConstraintKind.EQUALITY">
<code class="sig-name descname">EQUALITY</code><a class="headerlink" href="#muse.constraints.ConstraintKind.EQUALITY" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ConstraintKind.LOWER_BOUND">
<code class="sig-name descname">LOWER_BOUND</code><a class="headerlink" href="#muse.constraints.ConstraintKind.LOWER_BOUND" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ConstraintKind.UPPER_BOUND">
<code class="sig-name descname">UPPER_BOUND</code><a class="headerlink" href="#muse.constraints.ConstraintKind.UPPER_BOUND" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py data">
<dt id="muse.constraints.PRODUCT_DIMS">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">PRODUCT_DIMS</code><a class="headerlink" href="#muse.constraints.PRODUCT_DIMS" title="Permalink to this definition">¶</a></dt>
<dd><p>Default dimensions for product decision variables.</p>
</dd></dl>

<dl class="py class">
<dt id="muse.constraints.ScipyAdapter">
<em class="property">class </em><code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">ScipyAdapter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">c</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">to_muse</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>numpy.ndarray<span class="p">]</span><span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">bounds</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>Optional<span class="p">[</span>float<span class="p">]</span><span class="p">, </span>Optional<span class="p">[</span>float<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">0, inf</span></em>, <em class="sig-param"><span class="n">A_ub</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>numpy.ndarray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b_ub</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>numpy.ndarray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">A_eq</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>numpy.ndarray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b_eq</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>numpy.ndarray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/constraints.html#ScipyAdapter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.ScipyAdapter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Creates the input for the scipy solvers.</p>
<p class="rubric">Example</p>
<p>Lets give a fist simple example. The constraint
<a class="reference internal" href="#muse.constraints.max_capacity_expansion" title="muse.constraints.max_capacity_expansion"><code class="xref py py-func docutils literal notranslate"><span class="pre">max_capacity_expansion()</span></code></a> limits how much each
capacity can be expanded in a given year.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse</span> <span class="kn">import</span> <span class="n">examples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.quantities</span> <span class="kn">import</span> <span class="n">maximum_production</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.timeslices</span> <span class="kn">import</span> <span class="n">convert_timeslice</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse</span> <span class="kn">import</span> <span class="n">constraints</span> <span class="k">as</span> <span class="n">cs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">sector</span><span class="p">(</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">market</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">residential_market</span><span class="p">(</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">search</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">search_space</span><span class="p">(</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assets</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">assets</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">agents</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;retrofit&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">market_demand</span> <span class="o">=</span>  <span class="mf">0.8</span> <span class="o">*</span> <span class="n">maximum_production</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">res</span><span class="o">.</span><span class="n">technologies</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2025</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">convert_timeslice</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">assets</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2025</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;technology&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;asset&quot;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">market</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">technology</span><span class="o">=</span><span class="s2">&quot;asset&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">costs</span> <span class="o">=</span> <span class="n">search</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">constraint</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">max_capacity_expansion</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">market_demand</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">technologies</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>The constraint acts over capacity decision variables only:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">constraint</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p>It is an upper bound for a straightforward sum over the capacities for a given
technology. The matrix operator is simply the identity:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">constraint</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p>And the upperbound is exanded over the replacement technologies,
but not over the assets. Hence the assets will be summed over in the final
constraint:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">500.0</span><span class="p">,</span> <span class="mf">55.0</span><span class="p">,</span> <span class="mf">55.0</span><span class="p">,</span> <span class="mf">500.0</span> <span class="p">]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;replacement&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">constraint</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">cs</span><span class="o">.</span><span class="n">ConstraintKind</span><span class="o">.</span><span class="n">UPPER_BOUND</span>
</pre></div>
</div>
<p>As shown above, it does not bind the production decision variables. Hence,
production is zero. The matrix operator for the capacity is simply the identity.
Hence it can be inputed as the dimensionless scalar 1. The upper bound is simply
the maximum for replacement technology (and region, if that particular dimension
exists in the problem).</p>
<p>The lp problem then becomes:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">technologies</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">technologies</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">market</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inputs</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">ScipyAdapter</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">technologies</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">market</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,</span> <span class="n">constraint</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>The decision variables are always constrained between zero and infinity:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">bounds</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</pre></div>
</div>
<p>The problem is an upper-bound one. There are no equality constraints:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">A_eq</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">b_eq</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<p>The upper bound matrix and vector, and the costs are consistent in their
dimensions:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">b_ub</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">A_ub</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">b_ub</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">inputs</span><span class="o">.</span><span class="n">A_ub</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">inputs</span><span class="o">.</span><span class="n">A_ub</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<p>In practice, <a class="reference internal" href="#muse.constraints.lp_costs" title="muse.constraints.lp_costs"><code class="xref py py-func docutils literal notranslate"><span class="pre">lp_costs()</span></code></a> helps us define the decision
variables (and <code class="docutils literal notranslate"><span class="pre">c</span></code>). We can verify that the sizes are consistent:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lpcosts</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">lp_costs</span><span class="p">(</span><span class="n">technologies</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">market</span><span class="o">.</span><span class="n">timeslice</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">capsize</span> <span class="o">=</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">size</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prodsize</span> <span class="o">=</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">size</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">capsize</span> <span class="o">+</span> <span class="n">prodsize</span>
</pre></div>
</div>
<p>The upper bound itself is over each replacement technology:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">b_ub</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">replacement</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
<p>The production decision variables are not involved:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">A_ub</span><span class="p">[:,</span> <span class="n">capsize</span><span class="p">:]</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The matrix for the capacity decision variables is a sum over assets for a given
replacement technology. Hence, each row is constituted of zeros and ones and
sums to the number of assets:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">inputs</span><span class="o">.</span><span class="n">A_ub</span><span class="p">[:,</span> <span class="p">:</span><span class="n">capsize</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">lpcosts</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">A_ub</span><span class="p">[:,</span> <span class="p">:</span><span class="n">capsize</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">==</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">}</span>
</pre></div>
</div>
<dl class="py attribute">
<dt id="muse.constraints.ScipyAdapter.A_eq">
<code class="sig-name descname">A_eq</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.A_eq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ScipyAdapter.A_ub">
<code class="sig-name descname">A_ub</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.A_ub" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ScipyAdapter.b_eq">
<code class="sig-name descname">b_eq</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.b_eq" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ScipyAdapter.b_ub">
<code class="sig-name descname">b_ub</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.b_ub" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ScipyAdapter.bounds">
<code class="sig-name descname">bounds</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.bounds" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ScipyAdapter.c">
<code class="sig-name descname">c</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.c" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="muse.constraints.ScipyAdapter.factory">
<em class="property">classmethod </em><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">costs</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">timeslices</span><span class="p">:</span> <span class="n">pandas.core.indexes.base.Index</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">constraints</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#muse.constraints.ScipyAdapter" title="muse.constraints.ScipyAdapter">muse.constraints.ScipyAdapter</a><a class="reference internal" href="../_modules/muse/constraints.html#ScipyAdapter.factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.ScipyAdapter.factory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="muse.constraints.ScipyAdapter.kwargs">
<em class="property">property </em><code class="sig-name descname">kwargs</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.kwargs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="muse.constraints.ScipyAdapter.to_muse">
<code class="sig-name descname">to_muse</code><a class="headerlink" href="#muse.constraints.ScipyAdapter.to_muse" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="muse.constraints.demand">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">demand</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">forecast</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">5</span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/constraints.html#demand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.demand" title="Permalink to this definition">¶</a></dt>
<dd><p>Constraints production to meet demand.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.factory">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">, </span>Sequence<span class="p">[</span>str<span class="p">]</span><span class="p">, </span>Sequence<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/constraints.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a list of constraints from standard settings.</p>
<p>The standard settings can be a string naming the constraint, a dictionary including
at least “name”, or a list of strings and dictionaries.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.lp_constraint">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">lp_constraint</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">constraint</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">lpcosts</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/constraints.html#lp_constraint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.lp_constraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms the constraint to LP data.</p>
<p>The goal is to create from <code class="docutils literal notranslate"><span class="pre">lpcosts.capacity</span></code>, <code class="docutils literal notranslate"><span class="pre">constraint.capacity</span></code>, and
<code class="docutils literal notranslate"><span class="pre">constraint.b</span></code> a 2d-matrix <code class="docutils literal notranslate"><span class="pre">constraint</span></code> vs <code class="docutils literal notranslate"><span class="pre">decision</span> <span class="pre">variables</span></code>.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>The dimensions of <code class="docutils literal notranslate"><span class="pre">constraint.b</span></code> are the constraint dimensions. They are</dt><dd><p>renamed <code class="docutils literal notranslate"><span class="pre">&quot;c(xxx)&quot;</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The dimensions of <code class="docutils literal notranslate"><span class="pre">lpcosts</span></code> are the decision-variable dimensions. They are</dt><dd><p>renamed <code class="docutils literal notranslate"><span class="pre">&quot;d(xxx)&quot;</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">set(b.dims).intersection(lpcosts.xxx.dims)</span></code> are diagonal</dt><dd><p>in constraint dimensions and decision variables dimension, with <code class="docutils literal notranslate"><span class="pre">xxx</span></code> the
capacity or the production</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">set(constraint.xxx.dims)</span> <span class="pre">-</span> <span class="pre">set(lpcosts.xxx.dims)</span> <span class="pre">-</span> <span class="pre">set(b.dims)</span></code> are reduced by</dt><dd><p>summation, with <code class="docutils literal notranslate"><span class="pre">xxx</span></code> the capacity or the production</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">set(lpcosts.xxx.dims)</span> <span class="pre">-</span> <span class="pre">set(constraint.xxx.dims)</span> <span class="pre">-</span> <span class="pre">set(b.dims)</span></code> are added for</dt><dd><p>expansion, with <code class="docutils literal notranslate"><span class="pre">xxx</span></code> the capacity or the production</p>
</dd>
</dl>
</li>
</ol>
<p>See <a class="reference internal" href="#muse.constraints.lp_constraint_matrix" title="muse.constraints.lp_constraint_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">muse.constraints.lp_constraint_matrix()</span></code></a> for a more detailed explanation
of the transformations applied here.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.lp_constraint_matrix">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">lp_constraint_matrix</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">b</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">constraint</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">lpcosts</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/constraints.html#lp_constraint_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.lp_constraint_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms one constraint block into an lp matrix.</p>
<p>The goal is to create from <code class="docutils literal notranslate"><span class="pre">lpcosts</span></code>, <code class="docutils literal notranslate"><span class="pre">constraint</span></code>, and <code class="docutils literal notranslate"><span class="pre">b</span></code> a 2d-matrix of
constraints vs decision variables.</p>
<blockquote>
<div><ol class="arabic simple">
<li><dl class="simple">
<dt>The dimensions of <code class="docutils literal notranslate"><span class="pre">b</span></code> are the constraint dimensions. They are renamed</dt><dd><p><code class="docutils literal notranslate"><span class="pre">&quot;c(xxx)&quot;</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The dimensions of <code class="docutils literal notranslate"><span class="pre">lpcosts</span></code> are the decision-variable dimensions. They are</dt><dd><p>renamed <code class="docutils literal notranslate"><span class="pre">&quot;d(xxx)&quot;</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">set(b.dims).intersection(lpcosts.dims)</span></code> are diagonal</dt><dd><p>in constraint dimensions and decision variables dimension</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">set(constraint.dims)</span> <span class="pre">-</span> <span class="pre">set(lpcosts.dims)</span> <span class="pre">-</span> <span class="pre">set(b.dims)</span></code> are reduced by</dt><dd><p>summation</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">set(lpcosts.dims)</span> <span class="pre">-</span> <span class="pre">set(constraint.dims)</span> <span class="pre">-</span> <span class="pre">set(b.dims)</span></code> are added for</dt><dd><p>expansion</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">set(b.dims)</span> <span class="pre">-</span> <span class="pre">set(constraint.dims)</span> <span class="pre">-</span> <span class="pre">set(lpcosts.dims)</span></code> are added for</dt><dd><p>expansion. Such dimensions only make sense if they consist of one point.</p>
</dd>
</dl>
</li>
</ol>
<p>The result is the constraint matrix, expanded, reduced and diagonalized for the
conditions above.</p>
<p>Example:</p>
<blockquote>
<div><p>Lets first setup a constraint and a cost matrix:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse</span> <span class="kn">import</span> <span class="n">examples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse</span> <span class="kn">import</span> <span class="n">constraints</span> <span class="k">as</span> <span class="n">cs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">sector</span><span class="p">(</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">technologies</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">technologies</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">market</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">residential_market</span><span class="p">(</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">search</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">search_space</span><span class="p">(</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assets</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">assets</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">agents</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;retrofit&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">demand</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># not used in max production</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">constraint</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">max_production</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">technologies</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lpcosts</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">lp_costs</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">(</span>
<span class="gp">... </span>        <span class="n">technologies</span>
<span class="gp">... </span>        <span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">market</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">assets</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">costs</span><span class="o">=</span><span class="n">search</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">timeslices</span><span class="o">=</span><span class="n">market</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>For a simple example, we can first check the case where b is scalar. The result
ought to be a single row of a matrix, or a vector with only decision variables:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">lp_constraint_matrix</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">constraint</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">capacity</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;d(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">lp_constraint_matrix</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">constraint</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;d(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>As expected, the capacity vector is 1, whereas the production vector is -1.
These are the values the <a class="reference internal" href="#muse.constraints.max_production" title="muse.constraints.max_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">max_production()</span></code></a> is set up
to create.</p>
<p>Now, let’s check the case where <code class="docutils literal notranslate"><span class="pre">b</span></code> is the one from the
<a class="reference internal" href="#muse.constraints.max_production" title="muse.constraints.max_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">max_production()</span></code></a> constraint. In that case, all the
dimensions should end up as constraint dimensions: the production for each
timeslice, region, asset, and replacement technology should not outstrip the
capacity assigned for the asset and replacement technology.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">lp_constraint_matrix</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">constraint</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">constraint</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">capacity</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decision_dims</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;d(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">constraint_dims</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="sa">f</span><span class="s2">&quot;c(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="n">decision_dims</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">constraint_dims</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#muse.constraints.max_production" title="muse.constraints.max_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">max_production()</span></code></a> constraint on the production
side is the identy matrix with a factor <span class="math notranslate nohighlight">\(-1\)</span>. We can easily check this
by stacking the decision and constraint dimensions in the result:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">lp_constraint_matrix</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">constraint</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">constraint</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decision_dims</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;d(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="n">decision_dims</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">constraint_dims</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stacked</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">decision_dims</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">constraint_dims</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">stacked</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">stacked</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">stacked</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">stacked</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.lp_costs">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">lp_costs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">costs</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">timeslices</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/constraints.html#lp_costs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.lp_costs" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates costs for solving with scipy’s LP solver.</p>
<p class="rubric">Example</p>
<p>We can now construct example inputs to the funtion from the sample model. The
costs will be a matrix where each assets has a candidate replacement technology.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse</span> <span class="kn">import</span> <span class="n">examples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">technologies</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">technodata</span><span class="p">(</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">search_space</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">search_space</span><span class="p">(</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timeslices</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">sector</span><span class="p">(</span><span class="s2">&quot;residential&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">timeslices</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">costs</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">search_space</span>
<span class="gp">... </span>    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">search_space</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">search_space</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>The function returns the LP vector split along capacity and production
variables.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.constraints</span> <span class="kn">import</span> <span class="n">lp_costs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lpcosts</span> <span class="o">=</span> <span class="n">lp_costs</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">technologies</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="s2">&quot;R1&quot;</span><span class="p">),</span> <span class="n">costs</span><span class="p">,</span> <span class="n">timeslices</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s2">&quot;capacity&quot;</span> <span class="ow">in</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">data_vars</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s2">&quot;production&quot;</span> <span class="ow">in</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">data_vars</span>
</pre></div>
</div>
<p>The capacity costs correspond exactly to the input costs:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">costs</span> <span class="o">==</span> <span class="n">lpcosts</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>The production is zero in this context. It does not enter the cost function of
the LP problem:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">(</span><span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>They should correspond to a data-array with dimensions <code class="docutils literal notranslate"><span class="pre">(asset,</span> <span class="pre">replacement)</span></code>
(and possibly <code class="docutils literal notranslate"><span class="pre">region</span></code> as well).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lpcosts</span><span class="o">.</span><span class="n">capacity</span><span class="o">.</span><span class="n">dims</span>
<span class="go">(&#39;asset&#39;, &#39;replacement&#39;)</span>
</pre></div>
</div>
<p>The production costs are zero by default. However, the production expands over
not only the dimensions of the capacity, but also the <code class="docutils literal notranslate"><span class="pre">timeslice</span></code> during
which production occurs and the <code class="docutils literal notranslate"><span class="pre">commodity</span></code> produced.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lpcosts</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">dims</span>
<span class="go">(&#39;timeslice&#39;, &#39;asset&#39;, &#39;replacement&#39;, &#39;commodity&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.max_capacity_expansion">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">max_capacity_expansion</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">forecast</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/constraints.html#max_capacity_expansion"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.max_capacity_expansion" title="Permalink to this definition">¶</a></dt>
<dd><p>Max-capacity addition, max-capacity growth, and capacity limits constraints.</p>
<p>Limits by how much the capacity of each technology owned by an agent can grow in
a given year. This is a constraint on the agent’s ability to invest in a
technology.</p>
<p>Let <span class="math notranslate nohighlight">\(L_t^r(y)\)</span> be the total capacity limit for a given year, technology,
and region. <span class="math notranslate nohighlight">\(G_t^r(y)\)</span> is the maximum growth. And <span class="math notranslate nohighlight">\(W_t^r(y)\)</span> is
the maximum additional capacity. <span class="math notranslate nohighlight">\(y=y_0\)</span> is the current year and
<span class="math notranslate nohighlight">\(y=y_1\)</span> is the year marking the end of the investment period.</p>
<p>Let <span class="math notranslate nohighlight">\(\mathcal{A}^{i, r}_{t, \iota}(y)\)</span> be the current assets, before
invesment, and let <span class="math notranslate nohighlight">\(\Delta\mathcal{A}^{i,r}_t\)</span> be the future investements.
The the constraint on agent <span class="math notranslate nohighlight">\(i\)</span> are given as:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}L_t^r(y_0) - \sum_\iota \mathcal{A}^{i, r}_{t, \iota}(y_1)
    \geq \Delta\mathcal{A}^{i,r}_t\\(y_1 - y_0 + 1) G_t^r(y_0) \sum_\iota \mathcal{A}^{i, r}_{t, \iota}(y_0)
    - \sum_\iota \mathcal{A}^{i, r}_{t, \iota}(y_1)
    \geq \Delta\mathcal{A}^{i,r}_t\\(y_1 - y_0)W_t^r(y_0) \geq  \Delta\mathcal{A}^{i,r}_t\end{aligned}\end{align} \]</div>
<p>The three constraints are combined into a single one which is returned as the
maximum capacity expansion, <span class="math notranslate nohighlight">\(\Gamma_t^{r, i}\)</span>. The maximum capacity
expansion cannot impose negative investments:
Maximum capacity addition:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\Gamma_t^{r, i} \geq 0\]</div>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.max_production">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">max_production</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/constraints.html#max_production"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.max_production" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs constraint between capacity and maximum production.</p>
<p>Constrains the production decision variable by the maximum production for a given
capacity.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.merge_lp">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">merge_lp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">costs</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">constraints</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>List<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">]</span><a class="reference internal" href="../_modules/muse/constraints.html#merge_lp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.merge_lp" title="Permalink to this definition">¶</a></dt>
<dd><p>Unify coordinate systems of costs and constraints.</p>
<p>In practice, this function brings costs and constraints into a single xr.Dataset and
then splits things up again. This ensures the dimensions are not only compatible,
but also such that that their order in memory is the same.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.minimum_service">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">minimum_service</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span><a class="reference internal" href="../_modules/muse/constraints.html#minimum_service"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.minimum_service" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs constraint between capacity and minimum service.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.register_constraints">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">register_constraints</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>Any<span class="p">]</span><span class="p">, </span>Optional<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>Any<span class="p">]</span><span class="p">, </span>Optional<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">]</span><a class="reference internal" href="../_modules/muse/constraints.html#register_constraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.register_constraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a constraint with MUSE.</p>
<p>See <a class="reference internal" href="#module-muse.constraints" title="muse.constraints"><code class="xref py py-mod docutils literal notranslate"><span class="pre">muse.constraints</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.constraints.search_space">
<code class="sig-prename descclassname">muse.constraints.</code><code class="sig-name descname">search_space</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">forecast</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">5</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span><a class="reference internal" href="../_modules/muse/constraints.html#search_space"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.constraints.search_space" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes disabled technologies.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.decisions">
<span id="muse-decisions-module"></span><h2>muse.decisions module<a class="headerlink" href="#module-muse.decisions" title="Permalink to this headline">¶</a></h2>
<p>Decision methods combining several objectives into ones.</p>
<p>Decisions methods create a single scalar from multiple objectives. To be available from
the input, functions implementing decision methods should follow a specific signature:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_decision</span>
<span class="k">def</span> <span class="nf">weighted_sum</span><span class="p">(</span><span class="n">objectives</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="field-list">
<dt class="field-odd">param objectives</dt>
<dd class="field-odd"><p>An dataset where each array is a separate objective</p>
</dd>
<dt class="field-even">param parameters</dt>
<dd class="field-even"><p>parameters, such as weigths, whether to minimize or maximize, the names
of objectives to consider, etc.</p>
</dd>
<dt class="field-odd">param kwargs</dt>
<dd class="field-odd"><p>Extra input parameters. These parameters are expected to be set from the
input file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The standard <a class="reference internal" href="../inputs/agents.html#inputs-agents"><span class="std std-ref">agent csv file</span></a> does not allow to set
these parameters.</p>
</div>
</dd>
<dt class="field-even">returns</dt>
<dd class="field-even"><p>A data array with ranked replacement technologies.</p>
</dd>
</dl>
<dl class="py function">
<dt id="muse.decisions.epsilon_constraints">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">epsilon_constraints</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">parameters</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">, </span>float<span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">mask</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Any<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/decisions.html#epsilon_constraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.epsilon_constraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Minimizes first objective subject to constraints on other objectives.</p>
<p>The parameters are a sequence of tuples <cite>(name, minimize, epsilon)</cite>, where
<cite>name</cite> is the name of the objective, <cite>minimze</cite> is <cite>True</cite> if minimizing and
false if maximizing that objective, and <cite>epsilon</cite> is the constraint. The
first objective is the one that will be minimized according to:</p>
<p>Given objectives <span class="math notranslate nohighlight">\(O^{(i)}_t\)</span>, with <span class="math notranslate nohighlight">\(i \in [|1, N|]\)</span> and <span class="math notranslate nohighlight">\(t\)</span> the
replacement technologies, this function computes the ranking with respect to
<span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[\mathrm{ranking}_{O^{(i)}_t &lt; \epsilon_i} O^{(0)}_t\]</div>
<p>The first tuple can be restricted to <cite>(name, minimize)</cite>, since <cite>epsilon</cite> is ignored.</p>
<p>The result is the matrix <span class="math notranslate nohighlight">\(O^{(0)}\)</span> modified such minimizing over the
replacement dimension value would take into account the constraints and the
optimization direction (minimize or maximize). In other words, calling
<cite>result.rank(‘replacement’)</cite> will yield the expected result.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.factory">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'mean'</span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/decisions.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a decision method based on the input settings.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.lexical_comparison">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">lexical_comparison</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">parameters</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">, </span>float<span class="p">]</span><span class="p">]</span><span class="p">, </span>Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>float<span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/decisions.html#lexical_comparison"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.lexical_comparison" title="Permalink to this definition">¶</a></dt>
<dd><p>Lexical comparison over the objectives.</p>
<p>Lexical comparison operates by binning the objectives into bins of width
w_i = min_j(p_i o_i^j). Once binned, dimensions other than <cite>asset</cite> and
<cite>technology</cite> are reduced by taking the max, e.g. the largest constraint.
Finally, the objectives are ranked lexographically, in the order given by the
parameters.</p>
<p>The result is an array of tuples which can subsquently be compared
lexicographically.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.mean">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">mean</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/decisions.html#mean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.mean" title="Permalink to this definition">¶</a></dt>
<dd><p>Mean over objectives.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.register_decision">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">register_decision</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">, </span>float<span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/decisions.html#register_decision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.register_decision" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as a decision.</p>
<p>Registers a function as a decision so that it can be applied easily when aggregating
different objectives together.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.retro_epsilon_constraints">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">retro_epsilon_constraints</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">parameters</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">, </span>float<span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/decisions.html#retro_epsilon_constraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.retro_epsilon_constraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Epsilon constraints where the current tech is included.</p>
<p>Modifies the parameters to the function such that the existing technologies are
always competitive.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.retro_lexical_comparison">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">retro_lexical_comparison</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">parameters</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">, </span>float<span class="p">]</span><span class="p">]</span><span class="p">, </span>Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>float<span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/decisions.html#retro_lexical_comparison"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.retro_lexical_comparison" title="Permalink to this definition">¶</a></dt>
<dd><p>Lexical comparison over the objectives.</p>
<p>Lexical comparison operates by binning the objectives into bins of width
w_i = p_i o_i, where i are the current assets. Once binned, dimensions other
than <cite>asset</cite> and <cite>replacement</cite> are reduced by taking the max, e.g. the
largest constraint.  Finally, the objectives are ranked lexographically, in
the order given by the parameters.</p>
<p>The result is an array of tuples which can subsquently be compared
lexicographically.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.single_objective">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">single_objective</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">parameters</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">]</span><span class="p">, </span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">, </span>float<span class="p">]</span><span class="p">, </span>Sequence<span class="p">[</span>Tuple<span class="p">[</span>str<span class="p">, </span>bool<span class="p">, </span>float<span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/decisions.html#single_objective"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.single_objective" title="Permalink to this definition">¶</a></dt>
<dd><p>Single objective decision method.</p>
<p>It only decides on minimization vs maximization and multiplies by a given factor.
The input parameters can take the following forms:</p>
<ul class="simple">
<li><p>Standard sequence <cite>[(objective, direction, factor)]</cite>, in which case it must have
only one element.</p></li>
<li><p>A single string: defaults to standard sequence <cite>[(string, 1, 1)]</cite></p></li>
<li><p>A tuple (string, bool): defaults to standard sequence
<cite>[(string, direction, 1)]</cite></p></li>
<li><p>A tuple (string, bool, factor): defaults to standard sequence
<cite>[(string, direction, factor)]</cite></p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="muse.decisions.weighted_sum">
<code class="sig-prename descclassname">muse.decisions.</code><code class="sig-name descname">weighted_sum</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">parameters</span><span class="p">:</span> <span class="n">Mapping<span class="p">[</span>str<span class="p">, </span>float<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/decisions.html#weighted_sum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decisions.weighted_sum" title="Permalink to this definition">¶</a></dt>
<dd><p>Weighted sum over normalized objectives.</p>
<p>The objectives are each normalized to [0, 1] over the <cite>replacement</cite>
dimension. Furthermore, the dimensions other than <cite>asset</cite> and <cite>replacement</cite>
are reduced by taking the mean.</p>
<p>More specifically, the objective function is:</p>
<div class="math notranslate nohighlight">
\[\sum_m c_m \frac{A_m - \min(A_m)}{\max(A_m) - \min(A_m)}\]</div>
<p>where sum runs over the different objectives, c_m is a scalar coefficient,
A_m is a matrix with dimensions (existing tech, replacemnt tech). <cite>max(A)</cite>
and <cite>min(A)</cite> return the largest and smallest component of the input matrix.
If c_m is positive, then that particular objective is minimized, whereas if
it is negative, that particular objective is maximized.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.decorators">
<span id="muse-decorators-module"></span><h2>muse.decorators module<a class="headerlink" href="#module-muse.decorators" title="Permalink to this headline">¶</a></h2>
<dl class="py data">
<dt id="muse.decorators.SETTINGS_CHECKS">
<code class="sig-prename descclassname">muse.decorators.</code><code class="sig-name descname">SETTINGS_CHECKS</code><em class="property">: Mapping[str, Callable[[dict], None]]</em><em class="property"> = {'check_budget_parameters': &lt;function check_budget_parameters&gt;, 'check_foresight': &lt;function check_foresight&gt;, 'check_global_data_files': &lt;function check_global_data_files&gt;, 'check_interpolation_mode': &lt;function check_interpolation_mode&gt;, 'check_iteration_control': &lt;function check_iteration_control&gt;, 'check_log_level': &lt;function check_log_level&gt;, 'check_sectors_files': &lt;function check_sectors_files&gt;, 'check_time_slices': &lt;function check_time_slices&gt;}</em><a class="headerlink" href="#muse.decorators.SETTINGS_CHECKS" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of settings checks.</p>
</dd></dl>

<dl class="py data">
<dt id="muse.decorators.SETTINGS_CHECKS_SIGNATURE">
<code class="sig-prename descclassname">muse.decorators.</code><code class="sig-name descname">SETTINGS_CHECKS_SIGNATURE</code><a class="headerlink" href="#muse.decorators.SETTINGS_CHECKS_SIGNATURE" title="Permalink to this definition">¶</a></dt>
<dd><p>settings checks signature.</p>
<p>alias of Callable[[dict], None]</p>
</dd></dl>

<dl class="py function">
<dt id="muse.decorators.register_settings_check">
<code class="sig-prename descclassname">muse.decorators.</code><code class="sig-name descname">register_settings_check</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable[[dict], None]</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/decorators.html#register_settings_check"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.decorators.register_settings_check" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as a settings check.</p>
<p>Registers a function as a settings check so that it can be applied easily
when validating the MUSE input settings.</p>
<p>There is no restriction on the function name, although is should be
in lower_snake_case, as it is a python function.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.defaults">
<span id="muse-defaults-module"></span><h2>muse.defaults module<a class="headerlink" href="#module-muse.defaults" title="Permalink to this headline">¶</a></h2>
<p>Default global values used in keyword arguments.</p>
<dl class="py data">
<dt id="muse.defaults.DATA_DIRECTORY">
<code class="sig-prename descclassname">muse.defaults.</code><code class="sig-name descname">DATA_DIRECTORY</code><em class="property"> = PosixPath('/Users/alexkell/Documents/SGI/2-documentation/StarMuse/src/muse/data')</em><a class="headerlink" href="#muse.defaults.DATA_DIRECTORY" title="Permalink to this definition">¶</a></dt>
<dd><p>Standard data directory.</p>
</dd></dl>

<dl class="py data">
<dt id="muse.defaults.DEFAULT_OUTPUT_DIRECTORY">
<code class="sig-prename descclassname">muse.defaults.</code><code class="sig-name descname">DEFAULT_OUTPUT_DIRECTORY</code><em class="property"> = PosixPath('Results')</em><a class="headerlink" href="#muse.defaults.DEFAULT_OUTPUT_DIRECTORY" title="Permalink to this definition">¶</a></dt>
<dd><p>Default root directory with sector data</p>
</dd></dl>

<dl class="py data">
<dt id="muse.defaults.DEFAULT_SETTINGS_DIRECTORY">
<code class="sig-prename descclassname">muse.defaults.</code><code class="sig-name descname">DEFAULT_SETTINGS_DIRECTORY</code><em class="property"> = PosixPath('/Users/alexkell/Documents/SGI/2-documentation/StarMuse/docs')</em><a class="headerlink" href="#muse.defaults.DEFAULT_SETTINGS_DIRECTORY" title="Permalink to this definition">¶</a></dt>
<dd><p>Directory where to look for <cite>settings.toml</cite>.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.demand_matching">
<span id="muse-demand-matching-module"></span><h2>muse.demand_matching module<a class="headerlink" href="#module-muse.demand_matching" title="Permalink to this headline">¶</a></h2>
<p>Collection of demand-matching algorithms.</p>
<p>At it’s simplest, the demand matching algorithm solves the following problem,</p>
<ul class="simple">
<li><p>given a demand for a commodity <span class="math notranslate nohighlight">\(D_d\)</span>, with <span class="math notranslate nohighlight">\(d\in\mathcal{D}\)</span></p></li>
<li><p>given processes to supply these commodities, with an associated cost per process,
<span class="math notranslate nohighlight">\(C_{d, i}\)</span>, with <span class="math notranslate nohighlight">\(i\in\mathcal{I}\)</span></p></li>
</ul>
<p>Match demand and supply while minimizing the associated cost.</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\min_{X} \sum_{d, i} C_{d,i} X_{d, i}\\X_{d, i} \geq 0\\\sum_o X_o \geq D_d\end{aligned}\end{align} \]</div>
<p>The basic algorithm proceeds as follows:</p>
<ol class="arabic">
<li><p>sort all costs <span class="math notranslate nohighlight">\(C_{d, i}\)</span> accross both <span class="math notranslate nohighlight">\(d\)</span> and <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p>for each cost <span class="math notranslate nohighlight">\(c_0\)</span> in order:</p>
<blockquote>
<div><ol class="arabic">
<li><p>find the set of indices <span class="math notranslate nohighlight">\(\mathcal{C}\subseteq\mathcal{D}\cup\mathcal{I}\)</span>
for which</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\forall (d, i) \in \mathcal{C}\quad C_{d, i} == c_0\]</div>
</div></blockquote>
</li>
<li><p>determine the partial result for the current cost</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\forall (d, i) \in \mathcal{C}\quad X_{d, i} = \frac{D_d}{|i\in\mathcal{C}|}\]</div>
<p>Where <span class="math notranslate nohighlight">\(|i\in\mathcal{C}|\)</span> indicates the number of indices <span class="math notranslate nohighlight">\(i\)</span> in
<span class="math notranslate nohighlight">\(\mathcal{C}\)</span>.</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
</ol>
<p>However, in practice, the problem to solve often contains constraints, e.g. a constraint
on production <span class="math notranslate nohighlight">\(\sum_d X_{d, i} \leq M_i\)</span>. The algorithms in this module try and
solve these constrained problems one way or another.</p>
<dl class="py function">
<dt id="muse.demand_matching.demand_matching">
<code class="sig-prename descclassname">muse.demand_matching.</code><code class="sig-name descname">demand_matching</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">cost</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">constraints</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">protected_dims</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Set<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/demand_matching.html#demand_matching"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.demand_matching.demand_matching" title="Permalink to this definition">¶</a></dt>
<dd><p>Demand matching over heterogenous dimensions.</p>
<p>This algorithm enables demand matching while enforcing constraints on how much an
asset can produce. Any set of dimensions can be matched. The algorithm is general
with respect to the dimensions in demand and cost. It also enforces constraints over
sets of indices.</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\min_{X} \sum_{d, i} C_{d, i} X_{d, i}\\X_{d, i} \geq 0\\\sum_i X_{d, i} \geq D_d\\M_{(d, i) \in \mathcal{R}^{(\alpha)}}^{(\alpha)}
    \geq \sum_{(d, i)\notin\mathcal{R}^{(\alpha)}} X_{d, i}\end{aligned}\end{align} \]</div>
<p>Where <span class="math notranslate nohighlight">\(\alpha\)</span> is an index running over constraints,
<span class="math notranslate nohighlight">\(\mathcal{R}^{(\alpha)}\subseteq\mathcal{D}\cup\mathcal{I}\)</span> is a subset of
indices.</p>
<p>The algorithm proceeds as described in <a class="reference internal" href="#module-muse.demand_matching" title="muse.demand_matching"><code class="xref py py-mod docutils literal notranslate"><span class="pre">muse.demand_matching</span></code></a>.
However, an extra step is added to ensure that the solutions falls within the
convex-hull formed by the constraints. This projects the current solution onto the
constraint. Hence, the solution will depend on the order in which the constraints
are given.</p>
<ol class="arabic">
<li><p>sort all costs <span class="math notranslate nohighlight">\(C_{d, m}\)</span> accross both <span class="math notranslate nohighlight">\(d\)</span> and <span class="math notranslate nohighlight">\(m\)</span></p></li>
<li><p>for each cost <span class="math notranslate nohighlight">\(c_0\)</span> in order:</p>
<blockquote>
<div><ol class="arabic">
<li><p>find the set of indices <span class="math notranslate nohighlight">\(\mathcal{C}\)</span></p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\mathcal{C}\subseteq\mathcal{D}\cup\mathcal{I}\\\forall (d, i) \in \mathcal{C}\quad C_{d, i} == c_0\end{aligned}\end{align} \]</div>
</div></blockquote>
</li>
<li><p>determine an interim partial result for the current cost</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\forall (d, i) \in \mathcal{C}\quad
\delta X_{d, i} = \frac{1}{|i\in\mathcal{C}|}\left(
    D_d - \sum_{j \in \mathcal{I}} X_{d, j}\right)\]</div>
<p>Where <span class="math notranslate nohighlight">\(|i\in\mathcal{C}|\)</span> indicates the number of <span class="math notranslate nohighlight">\(i\)</span> indices in
<span class="math notranslate nohighlight">\(\mathcal{C}\)</span>. The expression in the parenthesis is the currently
unserviced demand.</p>
</div></blockquote>
</li>
<li><p>Loop over each constraint <span class="math notranslate nohighlight">\(\alpha\)</span>. Below we drop the index
<span class="math notranslate nohighlight">\(\alpha\)</span> over constraints for simplicity.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Determine the excess over the constraint:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[E_{(d, i) \in \mathcal{R}} = \max\left\{
    0,
    \sum_{(d, i)\notin\mathcal{R}}\left(
        X_{d, i} + \delta X_{d, i}
    \right) - M_{(d, i) \in \mathcal{R}}
\right\}\]</div>
</div></blockquote>
</li>
<li><p>Correct <span class="math notranslate nohighlight">\(\delta X\)</span> as follows:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\forall (d, i) \in \mathcal{C}\cap\mathcal{R}\quad
\delta X\prime_{d, i} =
    E_{(d, i)}
    \frac{\delta X_{(d, i)}}{
        \sum_{(e, j)\in \mathcal{C}\cap\mathcal{R}} \delta X_{(e,j)}
    }\\
\forall (d, i) \notin \mathcal{R}, (d, i)\in\mathcal{C} \quad
\delta X\prime_{d, i} = 0\end{aligned}\end{align} \]</div>
</div></blockquote>
</li>
<li><p>Set <span class="math notranslate nohighlight">\(\delta X = \max(0, \delta X - \delta X\prime)\)</span></p></li>
</ol>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
</ol>
<p>A more complex problem would see independant dimensions for each quantity. In that,
case we can reduce to the original problem as shown here</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}C_{d, i, c} = \min_cC\prime_{d, i, c}\\D_d = \sum_{d\prime} D\prime_{d, d\prime}\\M_r = \sum_m M\prime_{r, m}\\X_{d, d\prime, i, m, c} =
    \left(C\prime_{d, i, c} == C_{d, i}\right)
    \frac{M\prime_{r, m}}{M_r} \frac{D\prime_{d, d\prime}}{D_d} X_{d, i}\end{aligned}\end{align} \]</div>
<p>A dimension could be shared by all quantities, in which case each point along that
dimension is treated as independant.</p>
<p>Similarly, if a dimension is shared only by the demand and a constraint but not by
the cost, then the problem can be reduced a set of problems independant along that
direction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>demand</strong> – Demand to match with production. It should have the same physical units
as <cite>max_production</cite>.</p></li>
<li><p><strong>cost</strong> – Cost to minimize while fulfiling the demand.</p></li>
<li><p><strong>*constraints</strong> – each item is a seperate constraint <span class="math notranslate nohighlight">\(M_r\)</span>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An array with the joint dimensionality of <cite>max_production</cite>, <cite>cost</cite>, and
<cite>demand</cite>, containing the supply that fulfills the demand. The units of this
supply are the same as <cite>demand</cite> and <cite>max_production</cite>.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-muse.demand_share">
<span id="muse-demand-share-module"></span><h2>muse.demand_share module<a class="headerlink" href="#module-muse.demand_share" title="Permalink to this headline">¶</a></h2>
<p>Demand share computations.</p>
<p>The demand share splits a demand amongst agents. It is used within a sector to assign
part of the input MCA demand to each agent.</p>
<p>Demand shares functions should be registered via the decorator <cite>register_demand_share</cite>.</p>
<p>Demand share functions are not expected to modify any of their arguments. They
should all have the following signature:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_demand_share</span>
<span class="k">def</span> <span class="nf">demand_share</span><span class="p">(</span>
    <span class="n">agents</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AbstractAgent</span><span class="p">],</span>
    <span class="n">market</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">technologies</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">param agents</dt>
<dd class="field-odd"><p>a sequence of  agent relevant to the demand share procedure. The agent can
be queried for parameters specific to the demand share procedure. For instance,
:py:func`new_and_retro` will query the agents for the assets they own, the
region they are contained with, their category (new or retrofit), etc…</p>
</dd>
<dt class="field-even">param market</dt>
<dd class="field-even"><p>Market variables, including prices, consumption and supply.</p>
</dd>
<dt class="field-odd">param technologies</dt>
<dd class="field-odd"><p>a dataset containing all constant data characterizing the
technologies.</p>
</dd>
<dt class="field-even">param kwargs</dt>
<dd class="field-even"><p>Any number of keyword arguments that can parametrize how the demand is
shared. These keyword arguments can be modified from the TOML file.</p>
</dd>
<dt class="field-odd">returns</dt>
<dd class="field-odd"><p>The unmet consumption. Unless indicated, all agents will compete for a the full
demand. However, if there exists a coordinate “agent” of dimension “asset” giving
the <a class="reference internal" href="muse.agents.html#muse.agents.agent.AbstractAgent.uuid" title="muse.agents.agent.AbstractAgent.uuid"><code class="xref py py-attr docutils literal notranslate"><span class="pre">uuid</span></code></a> of the agent, then agents will
only service that par of the demand.</p>
</dd>
</dl>
<dl class="py data">
<dt id="muse.demand_share.DEMAND_SHARE_SIGNATURE">
<code class="sig-prename descclassname">muse.demand_share.</code><code class="sig-name descname">DEMAND_SHARE_SIGNATURE</code><a class="headerlink" href="#muse.demand_share.DEMAND_SHARE_SIGNATURE" title="Permalink to this definition">¶</a></dt>
<dd><p>Demand share signature.</p>
<p>alias of Callable[[Sequence[muse.agents.agent.AbstractAgent], xarray.core.dataset.Dataset, xarray.core.dataset.Dataset, Any], xarray.core.dataarray.DataArray]</p>
</dd></dl>

<dl class="py function">
<dt id="muse.demand_share.factory">
<code class="sig-prename descclassname">muse.demand_share.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">[</span>str<span class="p">, </span>Any<span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.AbstractAgent" title="muse.agents.agent.AbstractAgent">muse.agents.agent.AbstractAgent</a><span class="p">]</span><span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>Any<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><a class="reference internal" href="../_modules/muse/demand_share.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.demand_share.factory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="muse.demand_share.new_and_retro">
<code class="sig-prename descclassname">muse.demand_share.</code><code class="sig-name descname">new_and_retro</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agents</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.AbstractAgent" title="muse.agents.agent.AbstractAgent">muse.agents.agent.AbstractAgent</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">production</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">, </span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'maximum_production'</span></em>, <em class="sig-param"><span class="n">current_year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">forecast</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">5</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/demand_share.html#new_and_retro"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.demand_share.new_and_retro" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits demand across new and retro agents.</p>
<p>The input demand is split amongst both <em>new</em> and <em>retro</em> agents. <em>New</em> agents get a
share of the increase in demand for the forecast year, whereas <em>retrofi</em> agents are
assigned a share of the demand that occurs from decommissioned assets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>agents</strong> – a list of all agents. This list should mainly be used to determine the
type of an agent and the assets it owns. The agents will not be modified in
any way.</p></li>
<li><p><strong>market</strong> – the market for which to satisfy the demand. It should contain at-least
<code class="docutils literal notranslate"><span class="pre">consumption</span></code> and <code class="docutils literal notranslate"><span class="pre">supply</span></code>. It may contain <code class="docutils literal notranslate"><span class="pre">prices</span></code> if that is of use
to the production method. The <code class="docutils literal notranslate"><span class="pre">consumption</span></code> reflects the demand for the
commodities produced by the current sector.</p></li>
<li><p><strong>technologies</strong> – quantities describing the technologies.</p></li>
</ul>
</dd>
</dl>
<p>Pseudo-code:</p>
<ol class="arabic">
<li><p>the capacity is reduced over agents and  expanded over timeslices (extensive
quantity) and aggregated over agents. Generally:</p>
<div class="math notranslate nohighlight">
\[A_{a, s}^r = w_s\sum_i A_a^{r, i}\]</div>
<p>with <span class="math notranslate nohighlight">\(w_s\)</span> a weight associated with each timeslice and determined via
<a class="reference internal" href="#muse.timeslices.convert_timeslice" title="muse.timeslices.convert_timeslice"><code class="xref py py-func docutils literal notranslate"><span class="pre">muse.timeslices.convert_timeslice()</span></code></a>.</p>
</li>
<li><p>An intermediate quantity, the <a class="reference internal" href="#muse.demand_share.unmet_demand" title="muse.demand_share.unmet_demand"><code class="xref py py-func docutils literal notranslate"><span class="pre">unmet</span> <span class="pre">demand</span></code></a> <span class="math notranslate nohighlight">\(U\)</span> is defined from
<span class="math notranslate nohighlight">\(P[\mathcal{M}, \mathcal{A}]\)</span>, a function giving the production for a given
market <span class="math notranslate nohighlight">\(\mathcal{M}\)</span>, the associated consumption <span class="math notranslate nohighlight">\(\mathcal{C}\)</span>, and
aggregate assets <span class="math notranslate nohighlight">\(\mathcal{A}\)</span>:</p>
<div class="math notranslate nohighlight">
\[U[\mathcal{M}, \mathcal{A}] =
  \max(\mathcal{C} - P[\mathcal{M}, \mathcal{A}], 0)\]</div>
<p>where <span class="math notranslate nohighlight">\(\max\)</span> operates element-wise, and indices have been dropped for
simplicity. The resulting expression has the same indices as the consumption
<span class="math notranslate nohighlight">\(\mathcal{C}_{c, s}^r\)</span>.</p>
<p><span class="math notranslate nohighlight">\(P\)</span> is any function registered with
<a class="reference internal" href="#muse.production.register_production" title="muse.production.register_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;register_production</span></code></a>.</p>
</li>
<li><p>the <em>new</em> demand <span class="math notranslate nohighlight">\(N\)</span> is defined as:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[N = \min\left(
    \mathcal{C}_{c, s}^r(y + \Delta y) - \mathcal{C}_{c, s}^r(y),
    U[\mathcal{M}^r(y + \Delta y), \mathcal{A}_{a, s}^r(y)]
\right)\]</div>
</div></blockquote>
</li>
<li><p>the <em>retrofit</em> demand <span class="math notranslate nohighlight">\(R\)</span> is defined from the identity</p>
<div class="math notranslate nohighlight">
\[C_{c, s}^r(y + \Delta y) =
 P[\mathcal{M}^r(y+\Delta y), \mathcal{A}_{a, s}^r(y + \Delta y)]
 + N_{c, s}^r
 + R_{c, s}^r\]</div>
<p>In other words, it is the share of the forecasted consumption that is serviced
neither by the current assets still present in the forecast year, nor by the
<em>new</em> agent.</p>
</li>
<li><dl>
<dt>then each <em>new</em> agent gets a share of <span class="math notranslate nohighlight">\(N\)</span> proportional to it’s</dt><dd><p>share of the <a class="reference internal" href="#muse.quantities.maximum_production" title="muse.quantities.maximum_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">production</span></code></a>,
<span class="math notranslate nohighlight">\(P[\mathcal{A}_{a, s}^{r, i}(y)]\)</span>.  Then the share of the demand for new
agent <span class="math notranslate nohighlight">\(i\)</span> is:</p>
<div class="math notranslate nohighlight">
\[N_{c, s, t}^{i, r}(y) = N_{c, s}^r
    \frac{\sum_\iota P[\mathcal{A}_{s, t, \iota}^{r, i}(y)]}
         {\sum_{i, t, \iota}P[\mathcal{A}_{s, t, \iota}^{r, i}(y)]}\]</div>
</dd>
</dl>
</li>
<li><dl>
<dt>similarly, each <em>retrofit</em> agent gets a share of <span class="math notranslate nohighlight">\(N\)</span> proportional to it’s</dt><dd><p>share of the <a class="reference internal" href="#muse.quantities.decommissioning_demand" title="muse.quantities.decommissioning_demand"><code class="xref py py-func docutils literal notranslate"><span class="pre">decommissioning</span> <span class="pre">demand</span></code></a>, <span class="math notranslate nohighlight">\(D^{r, i}_{t, c}\)</span>.
Then the share of the demand for retrofit agent <span class="math notranslate nohighlight">\(i\)</span> is:</p>
<div class="math notranslate nohighlight">
\[R_{c, s, t}^{i, r}(y) = R_{c, s}^r
    \frac{\sum_\iota\mathcal{D}_{t, c, \iota}^{i, r}(y)}
        {\sum_{i, t, \iota}\mathcal{D}_{t, c, \iota}^{i, r}(y)}\]</div>
</dd>
</dl>
</li>
</ol>
<p>Note that tin the last two steps, the assets owned by the agent are aggregated over
the installation year. The effect is that the demand serviced by agents is
disaggregated over each technology, rather than not over each <em>model</em> of each
technology.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-ref">indices</span>, <a class="reference internal" href="../api.html#module-muse.quantities"><span class="std std-ref">Quantities</span></a>,
<span class="xref std std-ref">Agent investments</span>,
<a class="reference internal" href="#muse.quantities.decommissioning_demand" title="muse.quantities.decommissioning_demand"><code class="xref py py-func docutils literal notranslate"><span class="pre">decommissioning_demand()</span></code></a>,
<a class="reference internal" href="#muse.quantities.maximum_production" title="muse.quantities.maximum_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">maximum_production()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.demand_share.register_demand_share">
<code class="sig-prename descclassname">muse.demand_share.</code><code class="sig-name descname">register_demand_share</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.AbstractAgent" title="muse.agents.agent.AbstractAgent">muse.agents.agent.AbstractAgent</a><span class="p">]</span><span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>Any<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/demand_share.html#register_demand_share"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.demand_share.register_demand_share" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as a demand share calculation.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.demand_share.unmet_demand">
<code class="sig-prename descclassname">muse.demand_share.</code><code class="sig-name descname">unmet_demand</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">production</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">, </span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'maximum_production'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/demand_share.html#unmet_demand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.demand_share.unmet_demand" title="Permalink to this definition">¶</a></dt>
<dd><p>Share of the demand that cannot be serviced by the existing assets.</p>
<div class="math notranslate nohighlight">
\[U[\mathcal{M}, \mathcal{A}] =
  \max(\mathcal{C} - P[\mathcal{M}, \mathcal{A}], 0)\]</div>
<p><span class="math notranslate nohighlight">\(\max\)</span> operates element-wise, and indices have been dropped for simplicity.
The resulting expression has the same indices as the consumption
<span class="math notranslate nohighlight">\(\mathcal{C}_{c, s}^r\)</span>.</p>
<p><span class="math notranslate nohighlight">\(P\)</span> is any function registered with
<a class="reference internal" href="#muse.production.register_production" title="muse.production.register_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;register_production</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.demand_share.unmet_forecasted_demand">
<code class="sig-prename descclassname">muse.demand_share.</code><code class="sig-name descname">unmet_forecasted_demand</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agents</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.AbstractAgent" title="muse.agents.agent.AbstractAgent">muse.agents.agent.AbstractAgent</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">current_year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">production</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">, </span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'maximum_production'</span></em>, <em class="sig-param"><span class="n">forecast</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">5</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/demand_share.html#unmet_forecasted_demand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.demand_share.unmet_forecasted_demand" title="Permalink to this definition">¶</a></dt>
<dd><p>Forecast demand that cannot be serviced by non-decommissioned current assets.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.examples">
<span id="muse-examples-module"></span><h2>muse.examples module<a class="headerlink" href="#module-muse.examples" title="Permalink to this headline">¶</a></h2>
<p>Example models and datasets.</p>
<p>Helps create and run small standard models from the command-line or directly from
python.</p>
<p>To run from the command-line:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>python -m muse --model default
</pre></div>
</div>
<p>Other models may be available. Check the command-line help:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>python -m muse --help
</pre></div>
</div>
<p>The same models can be instanciated in a python script as follows:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">muse</span> <span class="kn">import</span> <span class="n">example</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<dl class="py function">
<dt id="muse.examples.model">
<code class="sig-prename descclassname">muse.examples.</code><code class="sig-name descname">model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'default'</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#muse.mca.MCA" title="muse.mca.MCA">muse.mca.MCA</a><a class="reference internal" href="../_modules/muse/examples.html#model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.examples.model" title="Permalink to this definition">¶</a></dt>
<dd><p>Fully constructs a given example model.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.examples.technodata">
<code class="sig-prename descclassname">muse.examples.</code><code class="sig-name descname">technodata</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sector</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">model</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'default'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/examples.html#technodata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.examples.technodata" title="Permalink to this definition">¶</a></dt>
<dd><p>Technology for a sector of a given example model.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.filters">
<span id="muse-filters-module"></span><h2>muse.filters module<a class="headerlink" href="#module-muse.filters" title="Permalink to this headline">¶</a></h2>
<p>Various search-space filters.</p>
<p>Search-space filters return a modified matrix of booleans, with dimension
<cite>(asset, replacement)</cite>, where <cite>asset</cite> refer to technologies currently managed by
the agent, and <cite>replacement</cite> to all technologies the agent could consider, prior
to filtering.</p>
<p>Filters should be registered using the decorator <a class="reference internal" href="#muse.filters.register_filter" title="muse.filters.register_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_filter()</span></code></a>. The
registration makes it possible to call then from the agent by specifying the
<cite>search_rule</cite> attribute. The <cite>search_rule</cite> attribute is string or list of
strings specifying the filters to apply one after the other when considering the
search space.</p>
<p>Filters are not expected to modify any of their arguments. They should all
follow the same signature:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_filter</span>
<span class="k">def</span> <span class="nf">search_space_filter</span><span class="p">(</span>
    <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">technologies</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">market</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">param agent</dt>
<dd class="field-odd"><p>the agent relevant to the search space. The filters may need to query
the agent for parameters, e.g. the current year, the interpolation
method, the tolerance, etc.</p>
</dd>
<dt class="field-even">param search_space</dt>
<dd class="field-even"><p>the current search space.</p>
</dd>
<dt class="field-odd">param technologies</dt>
<dd class="field-odd"><p>A data set characterising the technologies from which the
agent can draw assets.</p>
</dd>
<dt class="field-even">param market</dt>
<dd class="field-even"><p>Market variables, such as prices or current capacity and retirement
profile.</p>
</dd>
<dt class="field-odd">returns</dt>
<dd class="field-odd"><p>A new search space with the same data-type as the input search-space, but
with potentially different values.</p>
</dd>
</dl>
<p>In practice, an initial search space is created by calling a function with the signature
given below, and registered with <a class="reference internal" href="#muse.filters.register_initializer" title="muse.filters.register_initializer"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_initializer()</span></code></a>. The initializer
function returns a search space which is passed on to a chain of filters, as done in the
<a class="reference internal" href="#muse.filters.factory" title="muse.filters.factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">factory()</span></code></a> function.</p>
<p>Functions creating initial search spaces should have the following signature:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_initializer</span>
<span class="k">def</span> <span class="nf">search_space_initializer</span><span class="p">(</span>
    <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">technologies</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">market</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">param agent</dt>
<dd class="field-odd"><p>the agent relevant to the search space. The filters may need to query
the agent for parameters, e.g. the current year, the interpolation
method, the tolerance, etc.</p>
</dd>
<dt class="field-even">param demand</dt>
<dd class="field-even"><p>share of the demand per existing reference technology (e.g.
assets).</p>
</dd>
<dt class="field-odd">param technologies</dt>
<dd class="field-odd"><p>A data set characterising the technologies from which the
agent can draw assets.</p>
</dd>
<dt class="field-even">param market</dt>
<dd class="field-even"><p>Market variables, such as prices or current capacity and retirement
profile.</p>
</dd>
<dt class="field-odd">returns</dt>
<dd class="field-odd"><p>An initial search space</p>
</dd>
</dl>
<dl class="py function">
<dt id="muse.filters.compress">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">compress</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#compress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.compress" title="Permalink to this definition">¶</a></dt>
<dd><p>Compress search space to include only potential technologies.</p>
<p>This operation reduces the <em>size</em> of the search space along the
<cite>replacement</cite> dimension, such that are left only technologies that
will be considered as replacement for at least by one asset. Unlike
most filters, it does not change the data, but rather changes how
the data is represented. In other words, this is mostly an
<em>optimization</em> for later steps, to avoid unnecessary computations.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.currently_existing_tech">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">currently_existing_tech</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#currently_existing_tech"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.currently_existing_tech" title="Permalink to this definition">¶</a></dt>
<dd><p>Only consider technologies that currently exist in the market.</p>
<p>This filter only allows technologies that exists in the market and have non- zero
capacity in the current year. See <cite>currently_referenced_tech</cite> for a similar filter
that does not check the capacity.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.currently_referenced_tech">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">currently_referenced_tech</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#currently_referenced_tech"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.currently_referenced_tech" title="Permalink to this definition">¶</a></dt>
<dd><p>Only consider technologies that are currently referenced in the market.</p>
<p>This filter will allow any technology that exists in the market, even if it
currently sits at zero capacity (unlike <cite>currently_existing_tech</cite> which requires
non-zero capacity in the current year).</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.factory">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">, </span>Sequence<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">separator</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'-&gt;'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/filters.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates filters from input TOML data.</p>
<p>The input data is standardized to a list of dictionaries where each dictionary
contains at least one member, “name”.</p>
<p>The first dictionary specifies the initial function which creates the search space
from the demand share, the market, and the dataset describing technologies in the
sectors.</p>
<p>The next entries are applied in turn and transform the search space in some way.
In other words the process is more or less:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">search_space</span> <span class="o">=</span> <span class="n">initial_filter</span><span class="p">(</span>
    <span class="n">agent</span><span class="p">,</span> <span class="n">demand</span><span class="p">,</span> <span class="n">technologies</span><span class="o">=</span><span class="n">technologies</span><span class="p">,</span> <span class="n">market</span><span class="o">=</span><span class="n">market</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">afilter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
    <span class="n">search_space</span> <span class="o">=</span> <span class="n">afilter</span><span class="p">(</span>
        <span class="n">agent</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">technologies</span><span class="o">=</span><span class="n">technologies</span><span class="p">,</span> <span class="n">market</span><span class="o">=</span><span class="n">market</span>
    <span class="p">)</span>
<span class="k">return</span> <span class="n">search_space</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">initial_filter</span></code> is simply first filter given on input, if that filter is
registered with <a class="reference internal" href="#muse.filters.register_initializer" title="muse.filters.register_initializer"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_initializer()</span></code></a>. Otherwise,
<a class="reference internal" href="#muse.filters.initialize_from_technologies" title="muse.filters.initialize_from_technologies"><code class="xref py py-func docutils literal notranslate"><span class="pre">initialize_from_technologies()</span></code></a> is automatically inserted.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.identity">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">identity</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#identity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.identity" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns search space as given.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.initialize_from_technologies">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">initialize_from_technologies</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/filters.html#initialize_from_technologies"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.initialize_from_technologies" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a search space from existing technologies.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.maturity">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">maturity</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">enduse_label</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'service'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#maturity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.maturity" title="Permalink to this definition">¶</a></dt>
<dd><p>Only allows technologies that have achieve a given market share.</p>
<p>Specifically, the market share refers to the capacity for each end- use.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.reduce_asset">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">reduce_asset</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#reduce_asset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.reduce_asset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reduce over assets.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.register_filter">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">register_filter</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/filters.html#register_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.register_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as a filter.</p>
<p>Registers a function as a filter so that it can be applied easily
when constraining the technology search-space.</p>
<p>The name that the function is registered with defaults to the function name.
However, it can also be specified explicitly as a <em>keyword</em> argument. In any
case, it must be unique amongst all search-space filters.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.register_initializer">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">register_initializer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/filters.html#register_initializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.register_initializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as a search-space initializer.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.same_enduse">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">same_enduse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="n">enduse_label</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'service'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#same_enduse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.same_enduse" title="Permalink to this definition">¶</a></dt>
<dd><p>Only allow for technologies with at least the same end-use.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.same_fuels">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">same_fuels</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/filters.html#same_fuels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.same_fuels" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters technologies with the same fuel type.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.similar_technology">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">similar_technology</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/filters.html#similar_technology"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.similar_technology" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters technologies with the same type.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.filters.with_asset_technology">
<code class="sig-prename descclassname">muse.filters.</code><code class="sig-name descname">with_asset_technology</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/filters.html#with_asset_technology"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.filters.with_asset_technology" title="Permalink to this definition">¶</a></dt>
<dd><p>Search space <em>also</em> contains its asset technology for each asset.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.hooks">
<span id="muse-hooks-module"></span><h2>muse.hooks module<a class="headerlink" href="#module-muse.hooks" title="Permalink to this headline">¶</a></h2>
<p>Pre and post hooks on agents.</p>
<dl class="py function">
<dt id="muse.hooks.asset_merge_factory">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">asset_merge_factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'new'</span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/hooks.html#asset_merge_factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.asset_merge_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a function for merging new investments into assets.</p>
<p>Available merging functions should be registered with
<a class="reference internal" href="#muse.hooks.register_final_asset_transform" title="muse.hooks.register_final_asset_transform"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;register_final_asset_transform</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.clean">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">clean</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/hooks.html#clean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes empty assets.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.housekeeping_factory">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">housekeeping_factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'noop'</span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/hooks.html#housekeeping_factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.housekeeping_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a function for performing initial housekeeping.</p>
<p>For instance, remove technologies with no capacity now or in the future.
Available housekeeping functions should be registered with
<a class="reference internal" href="#muse.hooks.register_initial_asset_transform" title="muse.hooks.register_initial_asset_transform"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;register_initial_asset_transform</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.merge_assets">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">merge_assets</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">old_assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">new_assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/hooks.html#merge_assets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.merge_assets" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds new assets to old along asset dimension.</p>
<p>New assets are assumed to be unequivalent to any old_assets. Indeed,
it is expected that the asset dimension does not have coordinates (i.e.
it is a combination of coordinates, such as technology and installation
year).</p>
<p>After merging the new assets, quantities are back-filled along the year
dimension. Further missing values (i.e. future years the old_assets
did not take into account) are set to zero.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.new_assets_only">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">new_assets_only</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">old_assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">new_assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/hooks.html#new_assets_only"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.new_assets_only" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns newly invested assets and ignores old assets.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.noop">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">noop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/hooks.html#noop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.noop" title="Permalink to this definition">¶</a></dt>
<dd><p>Return assets as they are.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.old_assets_only">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">old_assets_only</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">old_assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">new_assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/hooks.html#old_assets_only"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.old_assets_only" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns old assets and ignores newly invested assets.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.register_final_asset_transform">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">register_final_asset_transform</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/hooks.html#register_final_asset_transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.register_final_asset_transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function to merge new investments into current assets.</p>
<p>The transform is applied a the very end of the agent iteration. It can be any
function which takes as input the current set of assets, the new assets, and any
number of keyword arguments. The function must return a “merge” of the two assets.</p>
<p>For instance, the new assets could completely replace the old assets
(<a class="reference internal" href="#muse.hooks.new_assets_only" title="muse.hooks.new_assets_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">new_assets_only()</span></code></a>), or they could be summed to the old assets
(<a class="reference internal" href="#muse.hooks.merge_assets" title="muse.hooks.merge_assets"><code class="xref py py-func docutils literal notranslate"><span class="pre">merge_assets()</span></code></a>).</p>
</dd></dl>

<dl class="py function">
<dt id="muse.hooks.register_initial_asset_transform">
<code class="sig-prename descclassname">muse.hooks.</code><code class="sig-name descname">register_initial_asset_transform</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/hooks.html#register_initial_asset_transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.hooks.register_initial_asset_transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function for cleaning or transforming assets.</p>
<p>The transformation is applied at the start of each iteration. It any function which
take an agent and assets as input and any number of keyword arguments, and returns
the transformed assets. The agent should not be modified. It is only there to query
the current year, the region, etc.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.interactions">
<span id="muse-interactions-module"></span><h2>muse.interactions module<a class="headerlink" href="#module-muse.interactions" title="Permalink to this headline">¶</a></h2>
<p>Modes of interactions between agents.</p>
<p>Interactions between agents are modelled via two orthogonal concepts:</p>
<ul class="simple">
<li><p>a <em>net</em> is a set of agents which interact in some way</p></li>
<li><p>an <em>interaction</em> proper is a function that takes a net and actually performs the
interaction.</p></li>
</ul>
<p>Hence, there are two registrators in this this module,
<a class="reference internal" href="#muse.interactions.register_interaction_net" title="muse.interactions.register_interaction_net"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_interaction_net()</span></code></a>, and <a class="reference internal" href="#muse.interactions.register_agent_interaction" title="muse.interactions.register_agent_interaction"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_agent_interaction()</span></code></a>. The
first registers functions that take the full set of agents as input and returns a
sequence of nets. It is expected each net of the sequence will be applied the same
interaction. The second registrator registers the interaction proper: it takes agents as
arguments and returns nothing. It is expected to modify the agents in-place.</p>
<dl class="py function">
<dt id="muse.interactions.factory">
<code class="sig-prename descclassname">muse.interactions.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">[</span>Union<span class="p">[</span>Mapping<span class="p">, </span>Tuple<span class="p">[</span>str<span class="p">, </span>str<span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable[[Sequence[muse.agents.agent.AbstractAgent]], None]<a class="reference internal" href="../_modules/muse/interactions.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.interactions.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an interaction functor.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.interactions.new_to_retro_net">
<code class="sig-prename descclassname">muse.interactions.</code><code class="sig-name descname">new_to_retro_net</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agents</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">first_category</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'newcapa'</span></em><span class="sig-paren">)</span> &#x2192; Sequence<span class="p">[</span>Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">]</span><span class="p">]</span><a class="reference internal" href="../_modules/muse/interactions.html#new_to_retro_net"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.interactions.new_to_retro_net" title="Permalink to this definition">¶</a></dt>
<dd><p>Interactions between new and retrofit agents.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.interactions.register_agent_interaction">
<code class="sig-prename descclassname">muse.interactions.</code><code class="sig-name descname">register_agent_interaction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable[[muse.agents.agent.Agent, muse.agents.agent.Agent], None]</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/interactions.html#register_agent_interaction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.interactions.register_agent_interaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register an agent to agent(s) interaction function.</p>
<p>An agent interaction function takes at least two agents and makes them
interact in some way.</p>
<p>An agent interaction function also takes as argument a sector object.
This object should not be modified in any way. But it can be queried for
parameters, if the specific agent interaction function requires it. This is
most likely the same configuration object passed on to the interaction net
function.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.interactions.register_interaction_net">
<code class="sig-prename descclassname">muse.interactions.</code><code class="sig-name descname">register_interaction_net</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>Sequence<span class="p">[</span>Sequence<span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/interactions.html#register_interaction_net"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.interactions.register_interaction_net" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function computing interaction nets.</p>
<p>An interaction net function takes as input the list of all agents and
returns the list of all interactions, where an interaction is a list of at
least two interacting agents.</p>
<p>An interactiont-net function also takes as argument a sector object.
This object should not be modified in any way. But it can be queried for
parameters, if the specific interaction-net function requires it.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.interactions.transfer_assets">
<code class="sig-prename descclassname">muse.interactions.</code><code class="sig-name descname">transfer_assets</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">from_</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">to_</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/muse/interactions.html#transfer_assets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.interactions.transfer_assets" title="Permalink to this definition">¶</a></dt>
<dd><p>Transfer assets from first agent to second agent.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.investments">
<span id="muse-investments-module"></span><h2>muse.investments module<a class="headerlink" href="#module-muse.investments" title="Permalink to this headline">¶</a></h2>
<p>Investment decision.</p>
<p>An investment determines which technologies to invest given a metric to
determine preferred technologies, a corresponding search space of technologies,
and the demand to fulfill.</p>
<p>Investments should be registered via the decorator <cite>register_investment</cite>. The
registration makes it possible to call investments dynamically through
<cite>compute_investment</cite>, by specifying the name of the investment. It is part of
MUSE’s plugin platform.</p>
<p>Investments are not expected to modify any of their arguments. They should all
have the following signature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_investment</span>
<span class="k">def</span> <span class="nf">investment</span><span class="p">(</span>
    <span class="n">costs</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">technologies</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Constraint</span><span class="p">],</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">param costs</dt>
<dd class="field-odd"><p>specifies for each <cite>asset</cite> which <cite>replacement</cite> technology should be invested
in preferentially. This should be an integer or floating point array with
dimensions <cite>asset</cite> and <cite>replacement</cite>.</p>
</dd>
<dt class="field-even">param search_space</dt>
<dd class="field-even"><p>an <cite>asset</cite> by <cite>replacement</cite> matrix defining allowed and disallowed
replacement technologies for each asset</p>
</dd>
<dt class="field-odd">param technologies</dt>
<dd class="field-odd"><p>a dataset containing all constant data characterizing the
technologies.</p>
</dd>
<dt class="field-even">param constraints</dt>
<dd class="field-even"><p>a list of constraints as defined in <a class="reference internal" href="#module-muse.constraints" title="muse.constraints"><code class="xref py py-mod docutils literal notranslate"><span class="pre">constraints</span></code></a>.</p>
</dd>
<dt class="field-odd">param year</dt>
<dd class="field-odd"><p>the current year.</p>
</dd>
<dt class="field-even">returns</dt>
<dd class="field-even"><p>A data array with dimensions <cite>asset</cite> and <cite>technology</cite> specifying the amount
of newly invested capacity.</p>
</dd>
</dl>
<dl class="py data">
<dt id="muse.investments.INVESTMENT_SIGNATURE">
<code class="sig-prename descclassname">muse.investments.</code><code class="sig-name descname">INVESTMENT_SIGNATURE</code><a class="headerlink" href="#muse.investments.INVESTMENT_SIGNATURE" title="Permalink to this definition">¶</a></dt>
<dd><p>Investment signature.</p>
<p>alias of Callable[[xarray.core.dataarray.DataArray, xarray.core.dataarray.DataArray, xarray.core.dataset.Dataset, List[xarray.core.dataset.Dataset], Any], xarray.core.dataarray.DataArray]</p>
</dd></dl>

<dl class="py function">
<dt id="muse.investments.adhoc_match_demand">
<code class="sig-prename descclassname">muse.investments.</code><code class="sig-name descname">adhoc_match_demand</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">costs</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">constraints</span><span class="p">:</span> <span class="n">List<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">timeslice_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/investments.html#adhoc_match_demand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.investments.adhoc_match_demand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="muse.investments.cliff_retirement_profile">
<code class="sig-prename descclassname">muse.investments.</code><code class="sig-name descname">cliff_retirement_profile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technical_life</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">current_year</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">0</span></em>, <em class="sig-param"><span class="n">protected</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">0</span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/investments.html#cliff_retirement_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.investments.cliff_retirement_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Cliff-like retirement profile from current year.</p>
<p>Computes the retirement profile of all technologies in <code class="docutils literal notranslate"><span class="pre">technical_life</span></code>.
Assets with a technical life smaller than the input time-period should automatically
be renewed.</p>
<p>Hence, if <code class="docutils literal notranslate"><span class="pre">technical_life</span> <span class="pre">&lt;=</span> <span class="pre">protected</span></code>, then effectively, the technical life is
rewritten as <code class="docutils literal notranslate"><span class="pre">technical_life</span> <span class="pre">*</span> <span class="pre">n</span></code> with <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">int(protected</span> <span class="pre">//</span> <span class="pre">technical_life)</span> <span class="pre">+</span>
<span class="pre">1</span></code>.</p>
<p>We could just return an array where each year is repesented. Instead, to save
memory, we return a compact view of the same where years where no change happens are
removed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>technical_life</strong> – lifetimes for each technology</p></li>
<li><p><strong>current_year</strong> – current year</p></li>
<li><p><strong>protected</strong> – The technologies are assumed to be renewed between years
<cite>current_year</cite> and <cite>current_year + protected</cite></p></li>
<li><p><strong>**kwargs</strong> – arguments by which to filter technical_life, if any.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A boolean DataArray where each each element along the year dimension is
true if the technology is still not retired for the given year.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.investments.register_investment">
<code class="sig-prename descclassname">muse.investments.</code><code class="sig-name descname">register_investment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>List<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>Any<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>List<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>Any<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><a class="reference internal" href="../_modules/muse/investments.html#register_investment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.investments.register_investment" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as an investment.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.mca">
<span id="muse-mca-module"></span><h2>muse.mca module<a class="headerlink" href="#module-muse.mca" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="muse.mca.FindEquilibriumResults">
<em class="property">class </em><code class="sig-prename descclassname">muse.mca.</code><code class="sig-name descname">FindEquilibriumResults</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">converged</span><span class="p">:</span> <span class="n">bool</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">Dataset</span></em>, <em class="sig-param"><span class="n">sectors</span><span class="p">:</span> <span class="n">List<span class="p">[</span>AbstractSector<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/mca.html#FindEquilibriumResults"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.FindEquilibriumResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<p>Result of find equilibrium.</p>
<dl class="py attribute">
<dt id="muse.mca.FindEquilibriumResults.converged">
<code class="sig-name descname">converged</code><em class="property">: bool</em><a class="headerlink" href="#muse.mca.FindEquilibriumResults.converged" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.mca.FindEquilibriumResults.market">
<code class="sig-name descname">market</code><em class="property">: Dataset</em><a class="headerlink" href="#muse.mca.FindEquilibriumResults.market" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.mca.FindEquilibriumResults.sectors">
<code class="sig-name descname">sectors</code><em class="property">: List<span class="p">[</span>AbstractSector<span class="p">]</span></em><a class="headerlink" href="#muse.mca.FindEquilibriumResults.sectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="muse.mca.MCA">
<em class="property">class </em><code class="sig-prename descclassname">muse.mca.</code><code class="sig-name descname">MCA</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sectors</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference internal" href="muse.sectors.html#muse.sectors.abstract.AbstractSector" title="muse.sectors.abstract.AbstractSector">muse.sectors.abstract.AbstractSector</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">outputs</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>List<span class="p">[</span><a class="reference internal" href="muse.sectors.html#muse.sectors.abstract.AbstractSector" title="muse.sectors.abstract.AbstractSector">muse.sectors.abstract.AbstractSector</a><span class="p">]</span><span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>Any<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">time_framework</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">[2010, 2020, 2030, 2040, 2050, 2060, 2070, 2080, 2090]</span></em>, <em class="sig-param"><span class="n">equilibrium</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">expect_equilibrium</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">equilibrium_variable</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'demand'</span></em>, <em class="sig-param"><span class="n">maximum_iterations</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">3</span></em>, <em class="sig-param"><span class="n">tolerance</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">tolerance_unmet_demand</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">- 0.1</span></em>, <em class="sig-param"><span class="n">excluded_commodities</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">[</span>str<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">carbon_budget</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">carbon_price</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">carbon_commodities</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">[</span>str<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">debug</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">control_undershoot</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">control_overshoot</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">carbon_method</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'fitting'</span></em>, <em class="sig-param"><span class="n">method_options</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Mapping<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/mca.html#MCA"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.MCA" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Market Clearing Algorithm.</p>
<p>The market clearing algorithm is the main object implementing the MUSE model. It is
responsible for orchestrating  how the sectors are run, how they interface with one
another, with the general market and the carbon market.</p>
<dl class="py method">
<dt id="muse.mca.MCA.calibrate_legacy_sectors">
<code class="sig-name descname">calibrate_legacy_sectors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/mca.html#MCA.calibrate_legacy_sectors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.MCA.calibrate_legacy_sectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a calibration step in the lagacy sectors.</p>
<p>TODO: Remove when LegacySectors are no longer needed.</p>
</dd></dl>

<dl class="py method">
<dt id="muse.mca.MCA.factory">
<em class="property">classmethod </em><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">, </span>Mapping<span class="p">, </span>Any<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#muse.mca.MCA" title="muse.mca.MCA">muse.mca.MCA</a><a class="reference internal" href="../_modules/muse/mca.html#MCA.factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.MCA.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads MCA from input settings and input files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>settings</strong> – namedtuple with the global MUSE input settings.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The loaded MCA</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="muse.mca.MCA.find_equilibrium">
<code class="sig-name descname">find_equilibrium</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">sectors</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>List<span class="p">[</span><a class="reference internal" href="muse.sectors.html#muse.sectors.abstract.AbstractSector" title="muse.sectors.abstract.AbstractSector">muse.sectors.abstract.AbstractSector</a><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#muse.mca.FindEquilibriumResults" title="muse.mca.FindEquilibriumResults">muse.mca.FindEquilibriumResults</a><a class="reference internal" href="../_modules/muse/mca.html#MCA.find_equilibrium"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.MCA.find_equilibrium" title="Permalink to this definition">¶</a></dt>
<dd><p>Specialised version of the find_equilibrium function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>market</strong> – Commodities market, with the prices, supply, consumption and demand.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple with the updated market (prices, supply, consumption and demand) and
sector.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="muse.mca.MCA.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/muse/mca.html#MCA.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.MCA.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Initiates the calculation, starting with the loop over years.</p>
<p>This method starts the main MUSE loop, going over the years of the simulation.
Internally, it runs the carbon budget loop, which updates the carbon prices, if
needed, and the equilibrium loop, which tries to reach an equilibrium between
prices, demand and supply.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="muse.mca.MCA.update_carbon_budget">
<code class="sig-name descname">update_carbon_budget</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">year_idx</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/muse/mca.html#MCA.update_carbon_budget"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.MCA.update_carbon_budget" title="Permalink to this definition">¶</a></dt>
<dd><p>Specialised version of the update_carbon_budget function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>market</strong> – Commodities market, with the prices, supply, consumption and demand.</p></li>
<li><p><strong>year_idx</strong> – Index of the year of interest.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An updated market with prices, supply, consumption and demand.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="muse.mca.MCA.update_carbon_price">
<code class="sig-name descname">update_carbon_price</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>float<span class="p">]</span><a class="reference internal" href="../_modules/muse/mca.html#MCA.update_carbon_price"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.MCA.update_carbon_price" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the updated carbon price, if required.</p>
<p>If the emission calculated for the next time period is larger than the
limit, then the carbon price needs to be updated to ensure that whatever the
sectors do, the carbon budget limit is not exceeded.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>market</strong> – Market, with the prices, supply, consumption and demand.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The new carbon price or None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="muse.mca.SingleYearIterationResult">
<em class="property">class </em><code class="sig-prename descclassname">muse.mca.</code><code class="sig-name descname">SingleYearIterationResult</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">Dataset</span></em>, <em class="sig-param"><span class="n">sectors</span><span class="p">:</span> <span class="n">List<span class="p">[</span>AbstractSector<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/mca.html#SingleYearIterationResult"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.SingleYearIterationResult" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<p>Result of iterating over sectors for a year.</p>
<p>Convenience tuple naming naming the return values from  of
<a class="reference internal" href="#muse.mca.single_year_iteration" title="muse.mca.single_year_iteration"><code class="xref py py-func docutils literal notranslate"><span class="pre">single_year_iteration()</span></code></a>.</p>
<dl class="py attribute">
<dt id="muse.mca.SingleYearIterationResult.market">
<code class="sig-name descname">market</code><em class="property">: Dataset</em><a class="headerlink" href="#muse.mca.SingleYearIterationResult.market" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt id="muse.mca.SingleYearIterationResult.sectors">
<code class="sig-name descname">sectors</code><em class="property">: List<span class="p">[</span>AbstractSector<span class="p">]</span></em><a class="headerlink" href="#muse.mca.SingleYearIterationResult.sectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="muse.mca.check_demand_fulfillment">
<code class="sig-prename descclassname">muse.mca.</code><code class="sig-name descname">check_demand_fulfillment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">tol</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">excluded_commodities</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="reference internal" href="../_modules/muse/mca.html#check_demand_fulfillment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.check_demand_fulfillment" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if the supply will fulfill all the demand in the future.</p>
<p>If it does not, it logs a warning.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>market</strong> – Commodities market, with the prices, supply, consumption and demand.</p></li>
<li><p><strong>tol</strong> – Tolerance for the unmet demand.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if the supply fulfils the demand; False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.mca.check_equilibrium">
<code class="sig-prename descclassname">muse.mca.</code><code class="sig-name descname">check_equilibrium</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">int_market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">tolerance</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">equilibrium_variable</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="reference internal" href="../_modules/muse/mca.html#check_equilibrium"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.check_equilibrium" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if equilibrium has been reached.</p>
<p>This function checks if the difference in either the demand or the prices between
iterations if smaller than certain tolerance. If is, then it is assumed that
the process has converged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>market</strong> – The market values in this iteration.</p></li>
<li><p><strong>int_market</strong> – The market values in the previous iteration.</p></li>
<li><p><strong>tolerance</strong> – Tolerance for reaching equilibrium.</p></li>
<li><p><strong>equilibrium_variable</strong> – Variable to use to calculate the equilibrium condition.</p></li>
<li><p><strong>year</strong> – year for which to check changes. Default to minimum year in market.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if converged, False otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.mca.find_equilibrium">
<code class="sig-prename descclassname">muse.mca.</code><code class="sig-name descname">find_equilibrium</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">sectors</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference internal" href="muse.sectors.html#muse.sectors.abstract.AbstractSector" title="muse.sectors.abstract.AbstractSector">muse.sectors.abstract.AbstractSector</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">maxiter</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">3</span></em>, <em class="sig-param"><span class="n">tol</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">equilibrium_variable</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'demand'</span></em>, <em class="sig-param"><span class="n">tol_unmet_demand</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">- 0.1</span></em>, <em class="sig-param"><span class="n">excluded_commodities</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">expect_equilibrium</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#muse.mca.FindEquilibriumResults" title="muse.mca.FindEquilibriumResults">muse.mca.FindEquilibriumResults</a><a class="reference internal" href="../_modules/muse/mca.html#find_equilibrium"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.find_equilibrium" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the equilibrium loop.</p>
<p>If convergence is reached, then the function returns the new market. If the maximum
number of iterations are reached, then a warning issued in the log and the function
returns with the current status.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>market</strong> – Commodities market, with the prices, supply, consumption and demand.</p></li>
<li><p><strong>sectors</strong> – A list of the sectors participating in the simulation.</p></li>
<li><p><strong>maxiter</strong> – Maximum number of iterations.</p></li>
<li><p><strong>tol</strong> – Tolerance for reaching equilibrium.</p></li>
<li><p><strong>equilibrium_variable</strong> – Variable to use to calculate the equilibrium condition.</p></li>
<li><p><strong>tol_unmet_demand</strong> – Tolerance for the unmet demand.</p></li>
<li><p><strong>excluded_commodities</strong> – Commodities to be excluded in check_demand_fulfillment</p></li>
<li><p><strong>expect_equilibrium</strong> – if equilibrium should be reached. Useful to testing.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple with the updated market (prices, supply, consumption and demand),
sectors, and convergence status.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.mca.single_year_iteration">
<code class="sig-prename descclassname">muse.mca.</code><code class="sig-name descname">single_year_iteration</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">sectors</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference internal" href="muse.sectors.html#muse.sectors.abstract.AbstractSector" title="muse.sectors.abstract.AbstractSector">muse.sectors.abstract.AbstractSector</a><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#muse.mca.SingleYearIterationResult" title="muse.mca.SingleYearIterationResult">muse.mca.SingleYearIterationResult</a><a class="reference internal" href="../_modules/muse/mca.html#single_year_iteration"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.mca.single_year_iteration" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs one iteration of the sectors (runs each sector once).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>market</strong> – An initial market with prices, supply, consumption.</p></li>
<li><p><strong>sectors</strong> – A list of the sectors participating in the simulation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple with the new market and sectors.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-muse.objectives">
<span id="muse-objectives-module"></span><h2>muse.objectives module<a class="headerlink" href="#module-muse.objectives" title="Permalink to this headline">¶</a></h2>
<p>Valuation functions for replacement technologies.</p>
<p>Objectives are used to compare replacement technologies. They should correspond to
a single well defined economic concept. Multiple objectives can later be combined
via decision functions.</p>
<p>Objectives should be registered via the
<a class="reference internal" href="#muse.objectives.register_objective" title="muse.objectives.register_objective"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;register_objective</span></code></a> decorator. This makes it possible to
refer to them by name in agent input files, and nominally to set extra input parameters.</p>
<p>The <a class="reference internal" href="#muse.objectives.factory" title="muse.objectives.factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">factory()</span></code></a> function creates a function that calls all objectives defined in
its input argument and returns a dataset with each objective as a separate data array.</p>
<p>Objectives are not expected to modify their arguments. Furthermore they should
conform the following signatures:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_objective</span>
<span class="k">def</span> <span class="nf">comfort</span><span class="p">(</span>
    <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
    <span class="n">technologies</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">market</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="field-list">
<dt class="field-odd">param agent</dt>
<dd class="field-odd"><p>the agent relevant to the search space. The filters may need to query
the agent for parameters, e.g. the current year, the interpolation
method, the tolerance, etc.</p>
</dd>
<dt class="field-even">param demand</dt>
<dd class="field-even"><p>Demand to fulfill.</p>
</dd>
<dt class="field-odd">param search_space</dt>
<dd class="field-odd"><p>A boolean matrix represented as a <code class="docutils literal notranslate"><span class="pre">xr.DataArray</span></code>, listing
replacement technologies for each asset.</p>
</dd>
<dt class="field-even">param technologies</dt>
<dd class="field-even"><p>A data set characterising the technologies from which the
agent can draw assets.</p>
</dd>
<dt class="field-odd">param market</dt>
<dd class="field-odd"><p>Market variables, such as prices or current capacity and retirement
profile.</p>
</dd>
<dt class="field-even">param kwargs</dt>
<dd class="field-even"><p>Extra input parameters. These parameters are expected to be set from the
input file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The standard <a class="reference internal" href="../inputs/agents.html#inputs-agents"><span class="std std-ref">agent csv file</span></a> does not allow to set
these parameters.</p>
</div>
</dd>
<dt class="field-odd">returns</dt>
<dd class="field-odd"><p>A dataArray with at least one dimension corresponding to <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.  Only the
technologies in <code class="docutils literal notranslate"><span class="pre">search_space.replacement</span></code> should be present.  Furthermore, if an
<code class="docutils literal notranslate"><span class="pre">asset</span></code> dimension is present, then it should correspond to <code class="docutils literal notranslate"><span class="pre">search_space.asset</span></code>.
Other dimensions can be present, as long as the subsequent decision function nows
how to reduce them.</p>
</dd>
</dl>
<dl class="py function">
<dt id="muse.objectives.capacity_to_service_demand">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">capacity_to_service_demand</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/objectives.html#capacity_to_service_demand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.capacity_to_service_demand" title="Permalink to this definition">¶</a></dt>
<dd><p>Minimum capacity required to fulfill the demand.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.capital_costs">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">capital_costs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/objectives.html#capital_costs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.capital_costs" title="Permalink to this definition">¶</a></dt>
<dd><p>Capital costs for input technologies.</p>
<p>The capital costs are computed as <span class="math notranslate nohighlight">\(a * b^\alpha\)</span>, where <span class="math notranslate nohighlight">\(a\)</span> is
“cap_par” from the <a class="reference internal" href="../inputs/technodata.html#inputs-technodata"><span class="std std-ref">Techno-data</span></a>, <span class="math notranslate nohighlight">\(b\)</span> is the “scaling_size”, and
<span class="math notranslate nohighlight">\(\alpha\)</span> is “cap_exp”. In other words, capital costs are constant across the
simulation for each technology.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.comfort">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">comfort</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/objectives.html#comfort"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.comfort" title="Permalink to this definition">¶</a></dt>
<dd><p>Comfort value provided by technologies.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.efficiency">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">efficiency</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/objectives.html#efficiency"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.efficiency" title="Permalink to this definition">¶</a></dt>
<dd><p>Efficiency of the technologies.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.emission_cost">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">emission_cost</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/objectives.html#emission_cost"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.emission_cost" title="Permalink to this definition">¶</a></dt>
<dd><p>Emission cost for each technology when fultfilling whole demand.</p>
<p>Given the demand share <span class="math notranslate nohighlight">\(D\)</span>, the emissions per amount produced <span class="math notranslate nohighlight">\(E\)</span>, and
the prices per emittant <span class="math notranslate nohighlight">\(P\)</span>, then emissions costs <span class="math notranslate nohighlight">\(C\)</span> are computed
as:</p>
<div class="math notranslate nohighlight">
\[C = \sum_s \left(\sum_cD\right)\left(\sum_cEP\right),\]</div>
<p>with <span class="math notranslate nohighlight">\(s\)</span> the timeslices and <span class="math notranslate nohighlight">\(c\)</span> the commodity.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.equivalent_annual_cost">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">equivalent_annual_cost</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/objectives.html#equivalent_annual_cost"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.equivalent_annual_cost" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent annual costs (or annualized cost) of a technology.</p>
<p>This is the cost that, if it were to occur equally in every year of the
project lifetime, would give the same net present cost as the actual cash
flow sequence associated with that component. The cost is computed using the
<a class="reference external" href="https://www.homerenergy.com/products/pro/docs/3.11/annualized_cost.html">annualized cost</a> expression given by HOMER Energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>agent</strong> – The agent of interest</p></li>
<li><p><strong>search_space</strong> – The search space space for replacement technologies</p></li>
<li><p><strong>technologies</strong> – All the technologies</p></li>
<li><p><strong>market</strong> – The market parameters</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>xr.DataArray with the EAC calculated for the relevant technologies</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.factory">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">, </span>Sequence<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'LCOE'</span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/objectives.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a function computing multiple objectives.</p>
<p>The input can be a single objective defined by its name alone. Or it can be a single
objective defined by a dictionary which must include at least a “name” item, as well
as any extra parameters to pass to the objective. Or it can be a sequence of
objectives defined by name or by dictionary.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.fixed_costs">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">fixed_costs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/objectives.html#fixed_costs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.fixed_costs" title="Permalink to this definition">¶</a></dt>
<dd><p>Fixed costs associated with a technology.</p>
<p>Given a factor <span class="math notranslate nohighlight">\(\alpha\)</span> and an  exponent <span class="math notranslate nohighlight">\(\beta\)</span>, the fixed costs
<span class="math notranslate nohighlight">\(F\)</span> are computed from the <a class="reference internal" href="#muse.objectives.capacity_to_service_demand" title="muse.objectives.capacity_to_service_demand"><code class="xref py py-func docutils literal notranslate"><span class="pre">capacity</span> <span class="pre">fulfilling</span> <span class="pre">the</span> <span class="pre">current</span> <span class="pre">demand</span></code></a> <span class="math notranslate nohighlight">\(C\)</span> as:</p>
<div class="math notranslate nohighlight">
\[F = \alpha * C^\beta\]</div>
<p><span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> are “fix_par” and “fix_exp” in
<a class="reference internal" href="../inputs/technodata.html#inputs-technodata"><span class="std std-ref">Techno-data</span></a>, respectively.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.fuel_consumption_cost">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">fuel_consumption_cost</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/objectives.html#fuel_consumption_cost"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.fuel_consumption_cost" title="Permalink to this definition">¶</a></dt>
<dd><p>Cost of fuels when fulfilling whole demand.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.lifetime_levelized_cost_of_energy">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">lifetime_levelized_cost_of_energy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/objectives.html#lifetime_levelized_cost_of_energy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.lifetime_levelized_cost_of_energy" title="Permalink to this definition">¶</a></dt>
<dd><p>Levelized cost of energy (LCOE) of technologies over their lifetime.</p>
<p>It follows the <cite>simpified LCOE</cite> given by NREL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>agent</strong> – The agent of interest</p></li>
<li><p><strong>search_space</strong> – The search space space for replacement technologies</p></li>
<li><p><strong>technologies</strong> – All the technologies</p></li>
<li><p><strong>market</strong> – The market parameters</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>xr.DataArray with the LCOE calculated for the relevant technologies</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.net_present_value">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">net_present_value</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">agent</span><span class="p">:</span> <span class="n"><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a></span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">search_space</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/objectives.html#net_present_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.net_present_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Net present value (NPV) of the relevant technologies.</p>
<p>The net present value of a Component is the present value  of all the revenues that
a Component earns over its lifetime minus all the costs of installing and operating
it. Follows the definition of the <a class="reference external" href="https://www.homerenergy.com/products/pro/docs/3.11/net_present_cost.html">net present cost</a> given by HOMER Energy.</p>
<ul class="simple">
<li><p>energy commodities INPUTS are related to fuel costs</p></li>
<li><p>environmental commodities OUTPUTS are related to environmental costs</p></li>
<li><p>material and service commodities INPUTS are related to consumable costs</p></li>
<li><p>fixed and variable costs are given as technodata inputs and depend on the
installed capacity and production (non-environmental), respectively</p></li>
<li><p>capacity costs are given as technodata inputs and depend on the installed capacity</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here, the installation year is always agent.year, since objectives compute the
NPV for technologies to be installed in the current year. A more general NPV
computation (which would then live in quantities.py) would have to refer to
installation year of the technology.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>agent</strong> – The agent of interest</p></li>
<li><p><strong>search_space</strong> – The search space space for replacement technologies</p></li>
<li><p><strong>technologies</strong> – All the technologies</p></li>
<li><p><strong>market</strong> – The market parameters</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>xr.DataArray with the NPV calculated for the relevant technologies</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.objectives.register_objective">
<code class="sig-prename descclassname">muse.objectives.</code><code class="sig-name descname">register_objective</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span><a class="reference internal" href="muse.agents.html#muse.agents.agent.Agent" title="muse.agents.agent.Agent">muse.agents.agent.Agent</a><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>Any<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/objectives.html#register_objective"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.objectives.register_objective" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as a objective.</p>
<p>Registers a function as a objective so that it can be applied easily
when sorting technologies one against the other.</p>
<p>The input name is expected to be in lower_snake_case, since it ought to be a
python function. CamelCase, lowerCamelCase, and kebab-case names are also
registered.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.production">
<span id="muse-production-module"></span><h2>muse.production module<a class="headerlink" href="#module-muse.production" title="Permalink to this headline">¶</a></h2>
<p>Various ways and means to compute production.</p>
<p>Production is the amount of commodities produced by an asset. However, depending on the
context, it could be computed several ways. For  instace, it can be obtained straight
from the capacity of the asset. Or it can be obtained by matching for the same
commodities with a set of assets.</p>
<p>Production methods can be registered via the <a class="reference internal" href="#muse.production.register_production" title="muse.production.register_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;register_production</span></code></a> production decorator.  Registering a function makes the function
accessible from MUSE’s input file. Production methods are not expected to modify their
arguments. Furthermore they should conform the
following signatures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_production</span>
<span class="k">def</span> <span class="nf">production</span><span class="p">(</span>
    <span class="n">market</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">capacity</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">technologies</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">param market</dt>
<dd class="field-odd"><p>Market, including demand and prices.</p>
</dd>
<dt class="field-even">param capacity</dt>
<dd class="field-even"><p>The capacity of each asset within a market.</p>
</dd>
<dt class="field-odd">param technologies</dt>
<dd class="field-odd"><p>A dataset characterising the technologies of the same assets.</p>
</dd>
<dt class="field-even">param **kwargs</dt>
<dd class="field-even"><p>Any number of keyword arguments</p>
</dd>
<dt class="field-odd">returns</dt>
<dd class="field-odd"><p>A <cite>xr.DataArray</cite> with the amount produced for each good from each asset.</p>
</dd>
</dl>
<dl class="py data">
<dt id="muse.production.PRODUCTION_SIGNATURE">
<code class="sig-prename descclassname">muse.production.</code><code class="sig-name descname">PRODUCTION_SIGNATURE</code><a class="headerlink" href="#muse.production.PRODUCTION_SIGNATURE" title="Permalink to this definition">¶</a></dt>
<dd><p>Production signature.</p>
<p>alias of Callable[[xarray.core.dataarray.DataArray, xarray.core.dataarray.DataArray, xarray.core.dataset.Dataset], xarray.core.dataarray.DataArray]</p>
</dd></dl>

<dl class="py function">
<dt id="muse.production.demand_matched_production">
<code class="sig-prename descclassname">muse.production.</code><code class="sig-name descname">demand_matched_production</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">costs</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'prices'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/production.html#demand_matched_production"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.production.demand_matched_production" title="Permalink to this definition">¶</a></dt>
<dd><p>Production from matching demand via annual lcoe.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.production.factory">
<code class="sig-prename descclassname">muse.production.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'maximum_production'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><a class="reference internal" href="../_modules/muse/production.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.production.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a production functor.</p>
<p>This function’s raison d’être is to convert the input from a TOML file into an
actual functor usable within the model, i.e. it converts data into logic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – Registered production method to create. The name is resolved when the
function returned by the factory is called. Hence, it could refer to a
function yet to be registered when this factory method is called.</p></li>
<li><p><strong>**kwargs</strong> – any keyword argument the production method accepts.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.production.maximum_production">
<code class="sig-prename descclassname">muse.production.</code><code class="sig-name descname">maximum_production</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/production.html#maximum_production"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.production.maximum_production" title="Permalink to this definition">¶</a></dt>
<dd><p>Production when running at full capacity.</p>
<p><em>Full capacity</em> is limited by the utilitization factor. For more details, see
<a class="reference internal" href="#muse.quantities.maximum_production" title="muse.quantities.maximum_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">muse.quantities.maximum_production()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.production.register_production">
<code class="sig-prename descclassname">muse.production.</code><code class="sig-name descname">register_production</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/production.html#register_production"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.production.register_production" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to register a function as a production method.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#module-muse.production" title="muse.production"><code class="xref py py-mod docutils literal notranslate"><span class="pre">muse.production</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.production.supply">
<code class="sig-prename descclassname">muse.production.</code><code class="sig-name descname">supply</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">market</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/production.html#supply"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.production.supply" title="Permalink to this definition">¶</a></dt>
<dd><p>Service current demand equally from all assets.</p>
<p>“Equally” means that equivalent technologies are used to the same percentage of
their respective capacity.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.quantities">
<span id="muse-quantities-module"></span><h2>muse.quantities module<a class="headerlink" href="#module-muse.quantities" title="Permalink to this headline">¶</a></h2>
<p>Collection of functions to compute model quantities.</p>
<p>This module is meant to collect functions computing quantities of interest to the model,
e.g. lcoe, maximum production for a given capacity, etc, especially where these
functions are used in different areas of the model.</p>
<dl class="py function">
<dt id="muse.quantities.annual_levelized_cost_of_energy">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">annual_levelized_cost_of_energy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em>, <em class="sig-param"><span class="n">fill_value</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>int<span class="p">, </span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'extrapolate'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">filters</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#annual_levelized_cost_of_energy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.annual_levelized_cost_of_energy" title="Permalink to this definition">¶</a></dt>
<dd><p>Levelized cost of energy (LCOE) of technologies on each given year.</p>
<p>It mostly follows the <a class="reference external" href="https://www.nrel.gov/analysis/tech-lcoe-documentation.html">simplified LCOE</a> given by NREL. However, the
units are sometimes different. In the argument description, we use the following:</p>
<ul class="simple">
<li><p>[h]: hour</p></li>
<li><p>[y]: year</p></li>
<li><p>[$]: unit of currency</p></li>
<li><p>[E]: unit of energy</p></li>
<li><p>[1]: dimensionless</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prices</strong> – [$/(Eh)] the price of all commodities, including consumables and fuels.
This dataarray contains at least timeslice and commodity dimensions.</p></li>
<li><p><strong>technologies</strong> – <p>Describe the technologies, with at least the following parameters:</p>
<ul>
<li><p>cap_par: [$/E] overnight capital cost</p></li>
<li><p>interest_rate: [1]</p></li>
<li><p>fix_par: [$/(Eh)] fixed costs of operation and maintenance costs</p></li>
<li><p>var_par: [$/(Eh)] variable costs of operation and maintenance costs</p></li>
<li><dl class="simple">
<dt>fixed_inputs: [1] == [(Eh)/(Eh)] ratio indicating the amount of commodity</dt><dd><p>consumed per units of energy created.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fixed_outputs: [1] == [(Eh)/(Eh)] ration indicating the amount of</dt><dd><p>environmental pollutants produced per units of energy created.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
<li><p><strong>interpolation</strong> – interpolation method.</p></li>
<li><p><strong>fill_value</strong> – Fill value for values outside the extrapolation range.</p></li>
<li><p><strong>**filters</strong> – Anything by which prices can be filtered.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The lifetime LCOE in [$/(Eh)] for each technology at each timeslice.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.capacity_in_use">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">capacity_in_use</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">production</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">max_dim</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Tuple<span class="p">[</span>str<span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'commodity'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">filters</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/quantities.html#capacity_in_use"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.capacity_in_use" title="Permalink to this definition">¶</a></dt>
<dd><p>Capacity-in-use for each asset, given production.</p>
<p>Conceptually, this operation is the inverse of <cite>production</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>production</strong> – Production from each technology of interest.</p></li>
<li><p><strong>technologies</strong> – xr.Dataset describing the features of the technologies of
interests.  It should contain <cite>fixed_outputs</cite> and <cite>utilization_factor</cite>. It’s
shape is matched to <cite>capacity</cite> using <cite>muse.utilities.broadcast_techs</cite>.</p></li>
<li><p><strong>max_dim</strong> – reduces the given dimensions using <cite>max</cite>. Defaults to “commodity”. If
None, then no reduction is performed.</p></li>
<li><p><strong>filters</strong> – keyword arguments are used to filter down the capacity and
technologies. Filters not relevant to the quantities of interest, i.e.
filters that are not a dimension of <cite>capacity</cite> or <cite>techologies</cite>, are
silently ignored.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Capacity-in-use for each technology, whittled down by the filters.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.consumption">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">consumption</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">production</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#consumption"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.consumption" title="Permalink to this definition">¶</a></dt>
<dd><p>Commodity consumption when fulfilling the whole production.</p>
<p>Currently, the consumption is implemented for commodity_max == +infinity. If prices
are not given, then flexible consumption is <em>not</em> considered.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.costed_production">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">costed_production</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">costs</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">with_minimum_service</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#costed_production"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.costed_production" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes production from ranked assets.</p>
<p>The assets are ranked according to their cost. The asset with least cost are allowed
to service the demand first, up to the maximum production. By default, the mininum
service is applied first.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.decommissioning_demand">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">decommissioning_demand</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">[</span>int<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#decommissioning_demand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.decommissioning_demand" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes demand from process decommissioning.</p>
<p>If <cite>year</cite> is not given, it defaults to all years in capacity. If there are more than
two years, then decommissioning is with respect to first (or minimum) year.</p>
<p>Let <span class="math notranslate nohighlight">\(M_t^r(y)\)</span> be the retrofit demand, <span class="math notranslate nohighlight">\(^{(s)}\mathcal{D}_t^r(y)\)</span> be the
decommissioning demand at the level of the sector, and <span class="math notranslate nohighlight">\(A^r_{t, \iota}(y)\)</span> be
the assets owned by the agent. Then, the decommissioning demand for agent <span class="math notranslate nohighlight">\(i\)</span>
is :</p>
<div class="math notranslate nohighlight">
\[\mathcal{D}^{r, i}_{t, c}(y) =
    \sum_\iota \alpha_{t, \iota}^r \beta_{t, \iota, c}^r
        \left(A^{i, r}_{t, \iota}(y) - A^{i, r}_{t, \iota, c}(y + 1) \right)\]</div>
<p>given the utilization factor <span class="math notranslate nohighlight">\(\alpha_{t, \iota}\)</span> and the fixed output factor
<span class="math notranslate nohighlight">\(\beta_{t, \iota, c}\)</span>.</p>
<p>Furthermore, decommissioning demand is non-zero only for end-use commodities.</p>
<dl class="simple">
<dt>ncsearch-nohlsearch).. SeeAlso:</dt><dd><p><span class="xref std std-ref">indices</span>, <a class="reference internal" href="../api.html#module-muse.quantities"><span class="std std-ref">Quantities</span></a>,
<a class="reference internal" href="#muse.quantities.maximum_production" title="muse.quantities.maximum_production"><code class="xref py py-func docutils literal notranslate"><span class="pre">maximum_production()</span></code></a>
<a class="reference internal" href="#muse.commodities.is_enduse" title="muse.commodities.is_enduse"><code class="xref py py-func docutils literal notranslate"><span class="pre">is_enduse()</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.demand_matched_production">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">demand_matched_production</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">filters</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#demand_matched_production"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.demand_matched_production" title="Permalink to this definition">¶</a></dt>
<dd><p>Production matching the input demand.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>demand</strong> – demand to match.</p></li>
<li><p><strong>prices</strong> – price from which to compute the annual levelized cost of energy.</p></li>
<li><p><strong>capacity</strong> – capacity from which to obtain the maximum production constraints.</p></li>
<li><p><strong>**filters</strong> – keyword arguments with which to filter the input datasets and
data arrays., e.g. region, or year.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.emission">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">emission</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">production</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">fixed_outputs</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/quantities.html#emission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.emission" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes emission from current products.</p>
<p>Emissions are computed as <cite>sum(product) * fixed_outputs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>production</strong> – Produced goods. Only those with non-environmental products are used
when computing emissions.</p></li>
<li><p><strong>fixed_outputs</strong> – factor relating total production to emissions. For convenience,
this can also be a <cite>technologies</cite> dataset containing <cite>fixed_output</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A data array containing emissions (and only emissions).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.gross_margin">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">gross_margin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#gross_margin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.gross_margin" title="Permalink to this definition">¶</a></dt>
<dd><p>profit of increasing the production by one unit.</p>
<ul class="simple">
<li><p>energy commodities INPUTS are related to fuel costs</p></li>
<li><p>environmental commodities OUTPUTS are related to environmental costs</p></li>
<li><p>variable costs is given as technodata inputs</p></li>
<li><p>non-environmental commodities OUTPUTS are related to revenues</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.lifetime_levelized_cost_of_energy">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">lifetime_levelized_cost_of_energy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prices</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">installation_year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>int<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">filters</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/quantities.html#lifetime_levelized_cost_of_energy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.lifetime_levelized_cost_of_energy" title="Permalink to this definition">¶</a></dt>
<dd><p>Levelized cost of energy (LCOE) of technologies over their lifetime.</p>
<p>It mostly follows the <cite>simplified LCOE</cite> given by NREL. However, the units are
sometimes different. In the argument description, we use the following:</p>
<ul class="simple">
<li><p>[h]: hour</p></li>
<li><p>[y]: year</p></li>
<li><p>[$]: unit of currency</p></li>
<li><p>[E]: unit of energy</p></li>
<li><p>[1]: dimensionless</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prices</strong> – [$/(Eh)] the price of all commodities, including consumables and fuels.
This dataarray contains at least timeslice and commodity dimensions.</p></li>
<li><p><strong>technologies</strong> – <p>Describe the technologies, with at least the following parameters:</p>
<ul>
<li><p>technical life: [a] lifetime of each technology</p></li>
<li><p>cap_par: [$/E] overnight capital cost</p></li>
<li><p>interest_rate: [1]</p></li>
<li><p>fix_par: [$/(Eh)] fixed costs of operation and maintenance costs</p></li>
<li><p>var_par: [$/(Eh)] variable costs of operation and maintenance costs</p></li>
<li><dl class="simple">
<dt>fixed_inputs: [1] == [(Eh)/(Eh)] ratio indicating the amount of commodity</dt><dd><p>consumed per units of energy created.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fixed_outputs: [1] == [(Eh)/(Eh)] ration indicating the amount of</dt><dd><p>environmental pollutants produced per units of energy created.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
<li><p><strong>installation_year</strong> – year when the technologies are installed. If not given, it
defaults to the first year in <cite>prices</cite>. This should be a single value, there
is currently no provision for computing LCOE over different installation
years.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The lifetime LCOE in [$/(Eh)] for each technology at each timeslice.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.maximum_production">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">maximum_production</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">filters</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/quantities.html#maximum_production"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.maximum_production" title="Permalink to this definition">¶</a></dt>
<dd><p>Production for a given capacity.</p>
<p>Given a capacity <span class="math notranslate nohighlight">\(\mathcal{A}_{t, \iota}^r\)</span>, the utilization factor
<span class="math notranslate nohighlight">\(\alpha^r_{t, \iota}\)</span> and the the fixed outputs of each technology
<span class="math notranslate nohighlight">\(\beta^r_{t, \iota, c}\)</span>, then the result production is:</p>
<div class="math notranslate nohighlight">
\[P_{t, \iota}^r =
    \alpha^r_{t, \iota}\beta^r_{t, \iota, c}\mathcal{A}_{t, \iota}^r\]</div>
<p>The dimensions above are only indicative. The function should work with many
different input values, e.g. with capacities expanded over time-slices <span class="math notranslate nohighlight">\(t\)</span> or
agents <span class="math notranslate nohighlight">\(i\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>capacity</strong> – Capacity of each technology of interest. In practice, the capacity can
refer to asset capacity, the max capacity, or the capacity-in-use.</p></li>
<li><p><strong>technologies</strong> – xr.Dataset describing the features of the technologies of
interests.  It should contain <cite>fixed_outputs</cite> and <cite>utilization_factor</cite>. It’s
shape is matched to <cite>capacity</cite> using <cite>muse.utilities.broadcast_techs</cite>.</p></li>
<li><p><strong>filters</strong> – keyword arguments are used to filter down the capacity and
technologies. Filters not relevant to the quantities of interest, i.e.
filters that are not a dimension of <cite>capacity</cite> or <cite>techologies</cite>, are
silently ignored.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>capacity * fixed_outputs * utilization_factor</cite>, whittled down according to the
filters and the set of technologies in <cite>capacity</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.supply">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">supply</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">capacity</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">demand</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em>, <em class="sig-param"><span class="n">production_method</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#supply"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.supply" title="Permalink to this definition">¶</a></dt>
<dd><p>Production and emission for a given capacity servicing a given demand.</p>
<p>Supply includes two components, end-uses outputs and environmental pollutants. The
former consists of the demand that the current capacity is capable of servicing.
Where there is excess capacity, then service is assigned to each asset a share of
the maximum production (e.g. utilization across similar assets is the same in
percentage). Then, environmental pollutants are computing as a function of
commodity outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>capacity</strong> – number/quantity of assets that can service the demand</p></li>
<li><p><strong>demand</strong> – amount of each end-use required. The supply of each process will not
exceed it’s share of the demand.</p></li>
<li><p><strong>technologies</strong> – factors bindings the capacity of an asset with its production of
commodities and environmental pollutants.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A data array where the commodity dimension only contains actual outputs (i.e. no
input commodities).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.quantities.supply_cost">
<code class="sig-prename descclassname">muse.quantities.</code><code class="sig-name descname">supply_cost</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">production</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">lcoe</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">asset_dim</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'asset'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/quantities.html#supply_cost"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.quantities.supply_cost" title="Permalink to this definition">¶</a></dt>
<dd><p>Supply cost given production and the levelized cost of energy.</p>
<p>In practice, the supply cost is the weighted average LCOE over assets (<cite>asset_dim</cite>),
where the weights are the production.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>production</strong> – Amount of goods produced. In practice, production can be obtained
from the capacity for each asset via the method
<cite>muse.quantities.production</cite>.</p></li>
<li><p><strong>lcoe</strong> – Levelized cost of energy for each good produced. In practice, it can be
obtained from market prices via
<cite>muse.quantities.annual_levelized_cost_of_energy</cite> or
<cite>muse.quantities.lifetime_levelized_cost_of_energy</cite>.</p></li>
<li><p><strong>asset_dim</strong> – Name of the dimension(s) holding assets, processes or technologies.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-muse.registration">
<span id="muse-registration-module"></span><h2>muse.registration module<a class="headerlink" href="#module-muse.registration" title="Permalink to this headline">¶</a></h2>
<p>Registrators that allow pluggable data to logic transforms.</p>
<dl class="py function">
<dt id="muse.registration.registrator">
<code class="sig-prename descclassname">muse.registration.</code><code class="sig-name descname">registrator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">decorator</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">registry</span><span class="p">:</span> <span class="n">MutableMapping</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">logname</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">loglevel</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'Debug'</span></em><span class="sig-paren">)</span> &#x2192; Callable<a class="reference internal" href="../_modules/muse/registration.html#registrator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.registration.registrator" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator to create a decorator that registers functions with MUSE.</p>
<p>This is a decorator that takes another decorator as an argument. Hence it
returns a decorator. It simplifies and standardizes creating decorators to
register functions with muse.</p>
<p>The registrator expects as non-optional keyword argument a registry where
the resulting decorator will register functions.</p>
<p>Furthermore, the final function (the one passed to the decorator passed to
this function) will emit a standardized log-call.</p>
<p class="rubric">Example</p>
<p>At it’s simplest, creating a registrator and registrating happens by
first declaring a registry.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">REGISTRY</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>In general, it will be a variable owned directly by a module, hence the
all-caps. Creating the registrator then follows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.registration</span> <span class="kn">import</span> <span class="n">registrator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@registrator</span><span class="p">(</span><span class="n">registry</span><span class="o">=</span><span class="n">REGISTRY</span><span class="p">,</span> <span class="n">logname</span><span class="o">=</span><span class="s1">&#39;my stuff&#39;</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">loglevel</span><span class="o">=</span><span class="s1">&#39;Info&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">register_mystuff</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">function</span>
</pre></div>
</div>
<p>This registrator does nothing more than register the function. A more
interesting example is given below. Then a function can be registered:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@register_mystuff</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;yoyo&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">my_registered_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>The argument ‘yoyo’ is optional. It adds aliases for the function in the
registry. In any case, functions are registered with default aliases
corresponding to standard name variations, e.g. CamelCase, camelCase,
and kebab-case, as illustrated below:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">REGISTRY</span><span class="p">[</span><span class="s1">&#39;my_registered_function&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">my_registered_function</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">REGISTRY</span><span class="p">[</span><span class="s1">&#39;my-registered-function&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">my_registered_function</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">REGISTRY</span><span class="p">[</span><span class="s1">&#39;yoyo&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">my_registered_function</span>
<span class="go">True</span>
</pre></div>
</div>
<p>A more interesting case would involve the registrator automatically
adding functionality to the input function. For instance, the inputs
could be manipulated and the result of the function could be
automatically transformed to a string:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.registration</span> <span class="kn">import</span> <span class="n">registrator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@registrator</span><span class="p">(</span><span class="n">registry</span><span class="o">=</span><span class="n">REGISTRY</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">register_mystuff</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">decorated</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@register_mystuff</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">other</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">REGISTRY</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">](</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">REGISTRY</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">](</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-muse.regressions">
<span id="muse-regressions-module"></span><h2>muse.regressions module<a class="headerlink" href="#module-muse.regressions" title="Permalink to this headline">¶</a></h2>
<p>Functions and functors to compute macro-drivers.</p>
<dl class="py class">
<dt id="muse.regressions.Exponential">
<em class="property">class </em><code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">Exponential</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/regressions.html#Exponential"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.Exponential" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">muse.regressions.Regression</span></code></p>
<p>Regression function: exponential</p>
<p>This functor is a regression function registered with MUSE as ‘exponential’.</p>
</dd></dl>

<dl class="py class">
<dt id="muse.regressions.ExponentialAdj">
<em class="property">class </em><code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">ExponentialAdj</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/regressions.html#ExponentialAdj"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.ExponentialAdj" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">muse.regressions.Regression</span></code></p>
<p>Regression function: exponentialadj</p>
<p>This functor is a regression function registered with MUSE as ‘exponentialadj’.</p>
</dd></dl>

<dl class="py class">
<dt id="muse.regressions.Linear">
<em class="property">class </em><code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">Linear</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/regressions.html#Linear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.Linear" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">muse.regressions.Regression</span></code></p>
<p>a * population + b * (gdp - gdp[2010]/population[2010] * population)</p>
</dd></dl>

<dl class="py class">
<dt id="muse.regressions.Logistic">
<em class="property">class </em><code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">Logistic</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/regressions.html#Logistic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.Logistic" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">muse.regressions.Regression</span></code></p>
<p>Regression function: logistic</p>
<p>This functor is a regression function registered with MUSE as ‘logistic’.</p>
</dd></dl>

<dl class="py class">
<dt id="muse.regressions.LogisticSigmoid">
<em class="property">class </em><code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">LogisticSigmoid</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/regressions.html#LogisticSigmoid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.LogisticSigmoid" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">muse.regressions.Regression</span></code></p>
<p>Regression function: logisticsigmoid</p>
<p>This functor is a regression function registered with MUSE as ‘logisticsigmoid’.</p>
</dd></dl>

<dl class="py class">
<dt id="muse.regressions.Loglog">
<em class="property">class </em><code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">Loglog</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/regressions.html#Loglog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.Loglog" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">muse.regressions.Regression</span></code></p>
<p>Regression function: loglog</p>
<p>This functor is a regression function registered with MUSE as ‘loglog’.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.regressions.endogenous_demand">
<code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">endogenous_demand</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">regression_parameters</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">drivers</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">sector</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Sequence<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataset.Dataset<a class="reference internal" href="../_modules/muse/regressions.html#endogenous_demand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.endogenous_demand" title="Permalink to this definition">¶</a></dt>
<dd><p>Endogenous demand based on macro drivers and regression parameters.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.regressions.factory">
<code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">regression_parameters</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">sector</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Sequence<span class="p">[</span>str<span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; muse.regressions.Regression<a class="reference internal" href="../_modules/muse/regressions.html#factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates regression functor from standard MUSE data for given sector.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.regressions.register_regression">
<code class="sig-prename descclassname">muse.regressions.</code><code class="sig-name descname">register_regression</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Functor</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>muse.regressions.Regression<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; muse.regressions.Regression<a class="reference internal" href="../_modules/muse/regressions.html#register_regression"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.regressions.register_regression" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a functor with MUSE regressions.</p>
<p>Regression functors are registered with MUSE so that the functors can be
called easily on created.</p>
<p>functor name that the functor is registered with defaults to the snake_case
version of the functor name.  However, it can also be specified explicitly
as a <em>keyword</em> argument. In any case, it must be unique amongst all
registered regression functor.</p>
</dd></dl>

</div>
<div class="section" id="module-muse.timeslices">
<span id="muse-timeslices-module"></span><h2>muse.timeslices module<a class="headerlink" href="#module-muse.timeslices" title="Permalink to this headline">¶</a></h2>
<p>Timeslice utility functions.</p>
<dl class="py function">
<dt id="muse.timeslices.aggregate_transforms">
<code class="sig-prename descclassname">muse.timeslices.</code><code class="sig-name descname">aggregate_transforms</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>Mapping<span class="p">, </span>str<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeslice</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span>Tuple<span class="p">, </span>numpy.ndarray<span class="p">]</span><a class="reference internal" href="../_modules/muse/timeslices.html#aggregate_transforms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.timeslices.aggregate_transforms" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates dictionay of transforms for aggregate levels.</p>
<p>The transforms are used to create the projectors towards the finest timeslice.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timeslice</strong> – a <code class="docutils literal notranslate"><span class="pre">DataArray</span></code> with the timeslice dimension.</p></li>
<li><p><strong>settings</strong> – A dictionary mapping the name of an aggregate with the values it
aggregates, or a string that toml will parse as such. If not given, only the
unit transforms are returned.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dictionary of transforms for each possible slice to it’s corresponding finest
timeslices.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">toml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    [timeslices]</span>
<span class="gp">... </span><span class="s2">    spring.weekday = 5</span>
<span class="gp">... </span><span class="s2">    spring.weekend = 2</span>
<span class="gp">... </span><span class="s2">    autumn.weekday = 5</span>
<span class="gp">... </span><span class="s2">    autumn.weekend = 2</span>
<span class="gp">... </span><span class="s2">    winter.weekday = 5</span>
<span class="gp">... </span><span class="s2">    winter.weekend = 2</span>
<span class="gp">... </span><span class="s2">    summer.weekday = 5</span>
<span class="gp">... </span><span class="s2">    summer.weekend = 2</span>
<span class="gp">...</span><span class="s2"></span>
<span class="gp">... </span><span class="s2">    [timeslices.aggregates]</span>
<span class="gp">... </span><span class="s2">    spautumn = [&quot;spring&quot;, &quot;autumn&quot;]</span>
<span class="gp">... </span><span class="s2">    week = [&quot;weekday&quot;, &quot;weekend&quot;]</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.timeslices</span> <span class="kn">import</span> <span class="n">reference_timeslice</span><span class="p">,</span> <span class="n">aggregate_transforms</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref</span> <span class="o">=</span> <span class="n">reference_timeslice</span><span class="p">(</span><span class="n">toml</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transforms</span> <span class="o">=</span> <span class="n">aggregate_transforms</span><span class="p">(</span><span class="n">toml</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transforms</span><span class="p">[(</span><span class="s2">&quot;spring&quot;</span><span class="p">,</span> <span class="s2">&quot;weekend&quot;</span><span class="p">)]</span>
<span class="go">array([0, 1, 0, 0, 0, 0, 0, 0])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transforms</span><span class="p">[(</span><span class="s2">&quot;spautumn&quot;</span><span class="p">,</span> <span class="s2">&quot;weekday&quot;</span><span class="p">)]</span>
<span class="go">array([1, 0, 1, 0, 0, 0, 0, 0])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transforms</span><span class="p">[(</span><span class="s2">&quot;autumn&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">T</span>
<span class="go">array([0, 0, 1, 1, 0, 0, 0, 0])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transforms</span><span class="p">[(</span><span class="s2">&quot;spautumn&quot;</span><span class="p">,</span> <span class="s2">&quot;week&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">T</span>
<span class="go">array([1, 1, 1, 1, 0, 0, 0, 0])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.timeslices.convert_timeslice">
<code class="sig-prename descclassname">muse.timeslices.</code><code class="sig-name descname">convert_timeslice</code><span class="sig-paren">(</span><em class="sig-param">x: Union[xarray.core.dataarray.DataArray, xarray.core.dataset.Dataset], ts: Union[xarray.core.dataarray.DataArray, xarray.core.dataset.Dataset, pandas.core.indexes.multi.MultiIndex], quantity: Union[muse.timeslices.QuantityType, str] = &lt;QuantityType.EXTENSIVE: 'extensive'&gt;, finest: Optional[xarray.core.dataarray.DataArray] = None, transforms: Optional[Dict[Tuple, numpy.ndarray]] = None</em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><a class="reference internal" href="../_modules/muse/timeslices.html#convert_timeslice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.timeslices.convert_timeslice" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjusts the timeslice of x to match that of ts.</p>
<p>The conversion can be done in on of two ways, depending on whether the
quantity is extensive or intensive. See <cite>QuantityType</cite>.</p>
<p class="rubric">Example</p>
<p>Lets define three timeslices from finest, to fine, to rough:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">toml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    [&quot;timeslices&quot;]</span>
<span class="gp">... </span><span class="s2">    winter.weekday.day = 5</span>
<span class="gp">... </span><span class="s2">    winter.weekday.night = 5</span>
<span class="gp">... </span><span class="s2">    winter.weekend.day = 2</span>
<span class="gp">... </span><span class="s2">    winter.weekend.night = 2</span>
<span class="gp">... </span><span class="s2">    summer.weekday.day = 5</span>
<span class="gp">... </span><span class="s2">    summer.weekday.night = 5</span>
<span class="gp">... </span><span class="s2">    summer.weekend.day = 2</span>
<span class="gp">... </span><span class="s2">    summer.weekend.night = 2</span>
<span class="gp">... </span><span class="s2">    level_names = [&quot;semester&quot;, &quot;week&quot;, &quot;day&quot;]</span>
<span class="gp">... </span><span class="s2">    aggregates.allday = [&quot;day&quot;, &quot;night&quot;]</span>
<span class="gp">... </span><span class="s2">    aggregates.allweek = [&quot;weekend&quot;, &quot;weekday&quot;]</span>
<span class="gp">... </span><span class="s2">    aggregates.allyear = [&quot;winter&quot;, &quot;summer&quot;]</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.timeslices</span> <span class="kn">import</span> <span class="n">setup_module</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.readers</span> <span class="kn">import</span> <span class="n">read_timeslices</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setup_module</span><span class="p">(</span><span class="n">toml</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">finest_ts</span> <span class="o">=</span> <span class="n">read_timeslices</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fine_ts</span> <span class="o">=</span> <span class="n">read_timeslices</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">week</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;allweek&quot;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rough_ts</span> <span class="o">=</span> <span class="n">read_timeslices</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">semester</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;allyear&quot;</span><span class="p">],</span> <span class="n">day</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;allday&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Lets also define to other data-arrays to demonstrate how we can play with
dimensions:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int64&quot;</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="n">dims</span><span class="o">=</span><span class="s1">&#39;a&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">]},</span> <span class="n">dims</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now easily convert arrays with different dimensions. First, lets check
conversion from an array with no timeslices:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">xarray</span> <span class="kn">import</span> <span class="n">ones_like</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.timeslices</span> <span class="kn">import</span> <span class="n">convert_timeslice</span><span class="p">,</span> <span class="n">QuantityType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">convert_timeslice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">finest_ts</span><span class="p">,</span> <span class="n">QuantityType</span><span class="o">.</span><span class="n">EXTENSIVE</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray (timeslice: 8, a: 3)&gt;</span>
<span class="go">array([[0.892857, 0.357143, 0.535714],</span>
<span class="go">       [0.892857, 0.357143, 0.535714],</span>
<span class="go">       [0.357143, 0.142857, 0.214286],</span>
<span class="go">       [0.357143, 0.142857, 0.214286],</span>
<span class="go">       [0.892857, 0.357143, 0.535714],</span>
<span class="go">       [0.892857, 0.357143, 0.535714],</span>
<span class="go">       [0.357143, 0.142857, 0.214286],</span>
<span class="go">       [0.357143, 0.142857, 0.214286]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * timeslice  (timeslice) MultiIndex</span>
<span class="go">  - semester   (timeslice) object &#39;winter&#39; &#39;winter&#39; ... &#39;summer&#39; &#39;summer&#39;</span>
<span class="go">  - week       (timeslice) object &#39;weekday&#39; &#39;weekday&#39; ... &#39;weekend&#39; &#39;weekend&#39;</span>
<span class="go">  - day        (timeslice) object &#39;day&#39; &#39;night&#39; &#39;day&#39; ... &#39;night&#39; &#39;day&#39; &#39;night&#39;</span>
<span class="go">  * a          (a) int64 1 2 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;timeslice&quot;</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray (a: 3)&gt;</span>
<span class="go">array([5., 2., 3.])</span>
<span class="go">Coordinates:</span>
<span class="go">  * a        (a) int64 1 2 3</span>
</pre></div>
</div>
<p>As expected, the sum over timeslices recovers the original array.</p>
<p>In the case of an intensive quantity without a timeslice dimension, the
operation does not do anything:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convert_timeslice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">rough_ts</span><span class="p">,</span> <span class="n">QuantityType</span><span class="o">.</span><span class="n">INTENSIVE</span><span class="p">)</span>
<span class="go">[1, 2]</span>
</pre></div>
</div>
<p>More interesting is the conversion between different timeslices:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">xarray</span> <span class="kn">import</span> <span class="n">zeros_like</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">zfine</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">fine_ts</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">zrough</span> <span class="o">=</span> <span class="n">convert_timeslice</span><span class="p">(</span><span class="n">zfine</span><span class="p">,</span> <span class="n">rough_ts</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">zrough</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray (timeslice: 2, a: 3, b: 3)&gt;</span>
<span class="go">array([[[17.142857, 17.142857, 20.      ],</span>
<span class="go">        [ 8.571429,  8.571429, 11.428571],</span>
<span class="go">        [11.428571, 11.428571, 14.285714]],</span>

<span class="go">       [[ 6.857143,  6.857143,  8.      ],</span>
<span class="go">        [ 3.428571,  3.428571,  4.571429],</span>
<span class="go">        [ 4.571429,  4.571429,  5.714286]]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * timeslice  (timeslice) MultiIndex</span>
<span class="go">  - semester   (timeslice) object &#39;allyear&#39; &#39;allyear&#39;</span>
<span class="go">  - week       (timeslice) object &#39;weekday&#39; &#39;weekend&#39;</span>
<span class="go">  - day        (timeslice) object &#39;allday&#39; &#39;allday&#39;</span>
<span class="go">  * a          (a) int64 1 2 3</span>
<span class="go">  * b          (b) &lt;U1 &#39;d&#39; &#39;e&#39; &#39;f&#39;</span>
</pre></div>
</div>
<p>We can check that nothing has been added to z (the quantity is <code class="docutils literal notranslate"><span class="pre">EXTENSIVE</span></code> by
default):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">all</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">all</span><span class="p">(</span><span class="n">zfine</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;timeslice&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="n">zrough</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;timeslice&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="go">&lt;xarray.DataArray ()&gt;</span>
<span class="go">array(True)</span>
</pre></div>
</div>
<p>Or that the ratio of weekdays to weekends makes sense:
&gt;&gt;&gt; weekdays = (
…    zrough
…    .unstack(“timeslice”)
…    .sel(week=”weekday”)
…    .stack(timeslice=[“semester”, “day”])
…    .squeeze()
… )
&gt;&gt;&gt; weekend = (
…    zrough
…    .unstack(“timeslice”)
…    .sel(week=”weekend”)
…    .stack(timeslice=[“semester”, “day”])
…    .squeeze()
… )
&gt;&gt;&gt; bool(all((weekend * 5).round(6) == (weekdays * 2).round(6)))
True</p>
</dd></dl>

<dl class="py function">
<dt id="muse.timeslices.reference_timeslice">
<code class="sig-prename descclassname">muse.timeslices.</code><code class="sig-name descname">reference_timeslice</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Mapping<span class="p">, </span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">level_names</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'month', 'day', 'hour'</span></em>, <em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'timeslice'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/timeslices.html#reference_timeslice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.timeslices.reference_timeslice" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads reference timeslice from toml like input.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>settings</strong> – A dictionary of nested dictionaries or a string that toml will
interpret as such. The nesting specifies different levels of the timeslice.
If a dictionary and it contains “timeslices” key, then the associated value
is used as the root dictionary. Ultimately, the most nested values should be
relative weights for each slice in the timeslice, e.g. the corresponding
number of hours.</p></li>
<li><p><strong>level_names</strong> – Hints indicating the names of each level. Can also be given a
“level_names” key in <code class="docutils literal notranslate"><span class="pre">settings</span></code>.</p></li>
<li><p><strong>name</strong> – name of the reference array</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="docutils literal notranslate"><span class="pre">DataArray</span></code> with dimension <em>timeslice</em> and values representing the relative
weight of each timeslice.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.timeslices</span> <span class="kn">import</span> <span class="n">reference_timeslice</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reference_timeslice</span><span class="p">(</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    [timeslices]</span>
<span class="gp">... </span><span class="sd">    spring.weekday = 5</span>
<span class="gp">... </span><span class="sd">    spring.weekend = 2</span>
<span class="gp">... </span><span class="sd">    autumn.weekday = 5</span>
<span class="gp">... </span><span class="sd">    autumn.weekend = 2</span>
<span class="gp">... </span><span class="sd">    winter.weekday = 5</span>
<span class="gp">... </span><span class="sd">    winter.weekend = 2</span>
<span class="gp">... </span><span class="sd">    summer.weekday = 5</span>
<span class="gp">... </span><span class="sd">    summer.weekend = 2</span>
<span class="gp">... </span><span class="sd">    level_names = [&quot;season&quot;, &quot;week&quot;]</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray (timeslice: 8)&gt;</span>
<span class="go">array([5, 2, 5, 2, 5, 2, 5, 2])</span>
<span class="go">Coordinates:</span>
<span class="go">  * timeslice  (timeslice) MultiIndex</span>
<span class="go">  - season     (timeslice) object &#39;spring&#39; &#39;spring&#39; ... &#39;summer&#39; &#39;summer&#39;</span>
<span class="go">  - week       (timeslice) object &#39;weekday&#39; &#39;weekend&#39; ... &#39;weekday&#39; &#39;weekend&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.timeslices.represent_hours">
<code class="sig-prename descclassname">muse.timeslices.</code><code class="sig-name descname">represent_hours</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeslices</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">nhours</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>int<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">8765.82</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/timeslices.html#represent_hours"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.timeslices.represent_hours" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of hours per timeslice.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timeslices</strong> – The timeslice for which to compute the number of hours</p></li>
<li><p><strong>nhours</strong> – The total number of hours represented in the timeslice. Defaults to the
average number of hours in year.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.timeslices.setup_module">
<code class="sig-prename descclassname">muse.timeslices.</code><code class="sig-name descname">setup_module</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">settings</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Mapping<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/timeslices.html#setup_module"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.timeslices.setup_module" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets up module singletons.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.timeslices.timeslice_projector">
<code class="sig-prename descclassname">muse.timeslices.</code><code class="sig-name descname">timeslice_projector</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>pandas.core.indexes.multi.MultiIndex<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">finest</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">transforms</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Dict<span class="p">[</span>Tuple<span class="p">, </span>numpy.ndarray<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/timeslices.html#timeslice_projector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.timeslices.timeslice_projector" title="Permalink to this definition">¶</a></dt>
<dd><p>Project time-slice to standardized finest time-slices.</p>
<p>Returns a matrix from the input timeslice <code class="docutils literal notranslate"><span class="pre">x</span></code> to the <code class="docutils literal notranslate"><span class="pre">finest</span></code> timeslice, using
the input <code class="docutils literal notranslate"><span class="pre">transforms</span></code>. The latter are a set of transforms that map indices from
one timeslice to indices in another.</p>
<p class="rubric">Example</p>
<p>Lets define the following timeslices and aggregates:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">toml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">    [&quot;timeslices&quot;]</span>
<span class="gp">... </span><span class="s2">    winter.weekday.day = 5</span>
<span class="gp">... </span><span class="s2">    winter.weekday.night = 5</span>
<span class="gp">... </span><span class="s2">    winter.weekend.day = 2</span>
<span class="gp">... </span><span class="s2">    winter.weekend.night = 2</span>
<span class="gp">... </span><span class="s2">    winter.weekend.dusk = 1</span>
<span class="gp">... </span><span class="s2">    summer.weekday.day = 5</span>
<span class="gp">... </span><span class="s2">    summer.weekday.night = 5</span>
<span class="gp">... </span><span class="s2">    summer.weekend.day = 2</span>
<span class="gp">... </span><span class="s2">    summer.weekend.night = 2</span>
<span class="gp">... </span><span class="s2">    summer.weekend.dusk = 1</span>
<span class="gp">... </span><span class="s2">    level_names = [&quot;semester&quot;, &quot;week&quot;, &quot;day&quot;]</span>
<span class="gp">... </span><span class="s2">    aggregates.allday = [&quot;day&quot;, &quot;night&quot;]</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.timeslices</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">reference_timeslice</span><span class="p">,</span>  <span class="n">aggregate_transforms</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref</span> <span class="o">=</span> <span class="n">reference_timeslice</span><span class="p">(</span><span class="n">toml</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transforms</span> <span class="o">=</span> <span class="n">aggregate_transforms</span><span class="p">(</span><span class="n">toml</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">MultiIndex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_ts</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">coords</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;timeslice&quot;</span><span class="p">:</span> <span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span>
<span class="gp">... </span>                <span class="p">(</span><span class="s2">&quot;winter&quot;</span><span class="p">,</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;allday&quot;</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="s2">&quot;winter&quot;</span><span class="p">,</span> <span class="s2">&quot;weekend&quot;</span><span class="p">,</span> <span class="s2">&quot;dusk&quot;</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="s2">&quot;weekend&quot;</span><span class="p">,</span> <span class="s2">&quot;night&quot;</span><span class="p">),</span>
<span class="gp">... </span>            <span class="p">],</span>
<span class="gp">... </span>            <span class="n">names</span><span class="o">=</span><span class="n">ref</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="s2">&quot;timeslice&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">names</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;timeslice&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_ts</span>
<span class="go">&lt;xarray.DataArray (timeslice: 3)&gt;</span>
<span class="go">array([1, 2, 3])</span>
<span class="go">Coordinates:</span>
<span class="go">  * timeslice  (timeslice) MultiIndex</span>
<span class="go">  - semester   (timeslice) object &#39;winter&#39; &#39;winter&#39; &#39;summer&#39;</span>
<span class="go">  - week       (timeslice) object &#39;weekday&#39; &#39;weekend&#39; &#39;weekend&#39;</span>
<span class="go">  - day        (timeslice) object &#39;allday&#39; &#39;dusk&#39; &#39;night&#39;</span>
</pre></div>
</div>
<p>The input timeslice does not have to be complete. In any case, we can now
compute a transform, i.e. a matrix that will take this timeslice and transform
it to the equivalent times in the finest timeslice:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.timeslices</span> <span class="kn">import</span> <span class="n">timeslice_projector</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timeslice_projector</span><span class="p">(</span><span class="n">input_ts</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">transforms</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray &#39;projector&#39; (finest_timeslice: 10, timeslice: 3)&gt;</span>
<span class="go">array([[1, 0, 0],</span>
<span class="go">       [1, 0, 0],</span>
<span class="go">       [0, 0, 0],</span>
<span class="go">       [0, 0, 0],</span>
<span class="go">       [0, 1, 0],</span>
<span class="go">       [0, 0, 0],</span>
<span class="go">       [0, 0, 0],</span>
<span class="go">       [0, 0, 0],</span>
<span class="go">       [0, 0, 1],</span>
<span class="go">       [0, 0, 0]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * finest_timeslice  (finest_timeslice) MultiIndex</span>
<span class="go">  - finest_semester   (finest_timeslice) object &#39;winter&#39; &#39;winter&#39; ... &#39;summer&#39;</span>
<span class="go">  - finest_week       (finest_timeslice) object &#39;weekday&#39; ... &#39;weekend&#39;</span>
<span class="go">  - finest_day        (finest_timeslice) object &#39;day&#39; &#39;night&#39; ... &#39;night&#39; &#39;dusk&#39;</span>
<span class="go">  * timeslice         (timeslice) MultiIndex</span>
<span class="go">  - semester          (timeslice) object &#39;winter&#39; &#39;winter&#39; &#39;summer&#39;</span>
<span class="go">  - week              (timeslice) object &#39;weekday&#39; &#39;weekend&#39; &#39;weekend&#39;</span>
<span class="go">  - day               (timeslice) object &#39;allday&#39; &#39;dusk&#39; &#39;night&#39;</span>
</pre></div>
</div>
<p>It is possible to give as input an array which does not have a timeslice of its
own:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nots</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">([</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timeslice_projector</span><span class="p">(</span><span class="n">nots</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">transforms</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="go">&lt;xarray.DataArray (timeslice: 1, finest_timeslice: 10)&gt;</span>
<span class="go">array([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * finest_timeslice  (finest_timeslice) MultiIndex</span>
<span class="go">  - finest_semester   (finest_timeslice) object &#39;winter&#39; &#39;winter&#39; ... &#39;summer&#39;</span>
<span class="go">  - finest_week       (finest_timeslice) object &#39;weekday&#39; ... &#39;weekend&#39;</span>
<span class="go">  - finest_day        (finest_timeslice) object &#39;day&#39; &#39;night&#39; ... &#39;night&#39; &#39;dusk&#39;</span>
<span class="go">Dimensions without coordinates: timeslice</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-muse.utilities">
<span id="muse-utilities-module"></span><h2>muse.utilities module<a class="headerlink" href="#module-muse.utilities" title="Permalink to this headline">¶</a></h2>
<p>Collection of functions and stand-alone algorithms.</p>
<dl class="py function">
<dt id="muse.utilities.agent_concatenation">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">agent_concatenation</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Mapping<span class="p">[</span>Hashable<span class="p">, </span>Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dim</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em>, <em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'agent'</span></em>, <em class="sig-param"><span class="n">fill_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="default_value">0</span></em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><a class="reference internal" href="../_modules/muse/utilities.html#agent_concatenation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.agent_concatenation" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenates input map along given dimension.</p>
<p class="rubric">Example</p>
<p>Lets create sets of random assets to work with. We set the seed so that this
test can be reproduced exactly.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.examples</span> <span class="kn">import</span> <span class="n">random_agent_assets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assets</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">random_agent_assets</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)}</span>
</pre></div>
</div>
<p>The concatenation will create a new dataset (or datarray) combining all the
inputs along the dimension “asset”. The origin of each datum is retained in a
new coordinate “agent” with dimension “asset”.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.utilities</span> <span class="kn">import</span> <span class="n">agent_concatenation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aggregate</span> <span class="o">=</span> <span class="n">agent_concatenation</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aggregate</span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:     (asset: 19, year: 12)</span>
<span class="go">Coordinates:</span>
<span class="go">  * year        (year) int64 2033 2035 2036 2037 2039 ... 2046 2047 2048 2049</span>
<span class="go">    technology  (asset) &lt;U9 &#39;oven&#39; &#39;stove&#39; &#39;oven&#39; ... &#39;stove&#39; &#39;oven&#39; &#39;thermomix&#39;</span>
<span class="go">    region      (asset) &lt;U9 &#39;Brexitham&#39; &#39;Brexitham&#39; ... &#39;Brexitham&#39; &#39;Brexitham&#39;</span>
<span class="go">    agent       (asset) ... 0 0 0 0 0 1 1 1 2 2 2 2 3 3 3 4 4 4 4</span>
<span class="go">    installed   (asset) int64 2030 2025 2030 2010 2030 ... 2025 2030 2010 2025</span>
<span class="go">Dimensions without coordinates: asset</span>
<span class="go">Data variables:</span>
<span class="go">    capacity    (asset, year) float64 26.0 26.0 26.0 56.0 ... 62.0 62.0 62.0</span>
</pre></div>
</div>
<p>Note that the <cite>dtype</cite> of the capacity has changed from integers to floating
points. This is due to how <code class="docutils literal notranslate"><span class="pre">xarray</span></code> performs the operation.</p>
<p>We can check that all the data from each agent is indeed present in the
aggregate.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">inventory</span> <span class="ow">in</span> <span class="n">assets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>   <span class="k">assert</span> <span class="p">(</span><span class="n">aggregate</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="n">aggregate</span><span class="o">.</span><span class="n">agent</span> <span class="o">==</span> <span class="n">agent</span><span class="p">)</span> <span class="o">==</span> <span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>However, it should be noted that the data is not always strictly equivalent:
dimensions outside of “assets” (most notably “year”) will include all points
from all agents. Missing values for the “year” dimension are forward filled (and
backfilled with zeros). Others are left with “NaN”.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.aggregate_technology_model">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">aggregate_technology_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dim</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em>, <em class="sig-param"><span class="n">drop</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>Sequence<span class="p">[</span>str<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'installed'</span></em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><a class="reference internal" href="../_modules/muse/utilities.html#aggregate_technology_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.aggregate_technology_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate together assets with the same installation year.</p>
<p>The assets of a given agent, region, and technology but different installation year
are grouped together and summed over.</p>
<p class="rubric">Example</p>
<p>We first create a random set of agent assets and aggregate them.
Some of these agents own assets from the same technology but potentially with
different installation year. This function will aggregate together all assets
of a given agent with same technology.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.examples</span> <span class="kn">import</span> <span class="n">random_agent_assets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.utilities</span> <span class="kn">import</span> <span class="n">agent_concatenation</span><span class="p">,</span> <span class="n">aggregate_technology_model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent_assets</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">random_agent_assets</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">assets</span> <span class="o">=</span> <span class="n">agent_concatenation</span><span class="p">(</span><span class="n">agent_assets</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reduced</span> <span class="o">=</span> <span class="n">aggregate_technology_model</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span>
</pre></div>
</div>
<p>We can check that the tuples (agent, technology) are unique (each agent works in
a single region):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">reduced</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">reduced</span><span class="o">.</span><span class="n">technology</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
</pre></div>
</div>
<p>And we can check they correspond to the right summation:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">technology</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">techsel</span> <span class="o">=</span> <span class="n">assets</span><span class="o">.</span><span class="n">technology</span> <span class="o">==</span> <span class="n">technology</span>
<span class="gp">... </span>    <span class="n">agsel</span> <span class="o">=</span> <span class="n">assets</span><span class="o">.</span><span class="n">agent</span> <span class="o">==</span> <span class="n">agent</span>
<span class="gp">... </span>    <span class="n">expected</span> <span class="o">=</span> <span class="n">assets</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="n">techsel</span> <span class="o">&amp;</span> <span class="n">agsel</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;asset&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">techsel</span> <span class="o">=</span> <span class="n">reduced</span><span class="o">.</span><span class="n">technology</span> <span class="o">==</span> <span class="n">technology</span>
<span class="gp">... </span>    <span class="n">agsel</span> <span class="o">=</span> <span class="n">reduced</span><span class="o">.</span><span class="n">agent</span> <span class="o">==</span> <span class="n">agent</span>
<span class="gp">... </span>    <span class="n">actual</span> <span class="o">=</span> <span class="n">reduced</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="n">techsel</span> <span class="o">&amp;</span> <span class="n">agsel</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual</span><span class="o">.</span><span class="n">asset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="p">(</span><span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.avoid_repetitions">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">avoid_repetitions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">dim</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'year'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/utilities.html#avoid_repetitions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.avoid_repetitions" title="Permalink to this definition">¶</a></dt>
<dd><p>list of years such that there is no repetition in the data.</p>
<p>It removes the central year of any three consecutive years where all data is
the same. This means the original data can be reobtained via a linear
interpolation or a forward fill.</p>
<p>The first and last year are always preserved.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.broadcast_techs">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">broadcast_techs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">technologies</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">template</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dimension</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em>, <em class="sig-param"><span class="n">installed_as_year</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><a class="reference internal" href="../_modules/muse/utilities.html#broadcast_techs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.broadcast_techs" title="Permalink to this definition">¶</a></dt>
<dd><p>Broadcasts technologies to the shape of template in given dimension.</p>
<p>The dimensions of the technologies are fully explicit, in that each concept
‘technology’, ‘region’, ‘year’ (for year of issue) is a separate dimension.
However, the dataset or data arrays representing other quantities, such as
capacity, are often flattened out with coordinates ‘region’, ‘installed’,
and ‘technology’ represented in a single ‘asset’ dimension. This latter
representation is sparse if not all combinations of ‘region’, ‘installed’,
and ‘technology’ are present, whereas the former represention makes it
easier to select a subset of the same.</p>
<p>This function broadcast the first represention to the shape and coordinates
of the second.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>technologies</strong> – The dataset to broadcast</p></li>
<li><p><strong>template</strong> – the dataset or data-array to use as a template</p></li>
<li><p><strong>dimension</strong> – the name of the dimensiom from <cite>template</cite> over which to
broadcast</p></li>
<li><p><strong>interpolation</strong> – interpolation method used across <cite>year</cite></p></li>
<li><p><strong>installed_as_year</strong> – if the coordinate <cite>installed</cite> exists, then it is
applied to the <cite>year</cite> dimension of the technologies dataset</p></li>
<li><p><strong>kwargs</strong> – further arguments are used initial filters over the
<cite>technologies</cite> dataset.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.clean_assets">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">clean_assets</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">years</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>int<span class="p">, </span>Sequence<span class="p">[</span>int<span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/utilities.html#clean_assets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.clean_assets" title="Permalink to this definition">¶</a></dt>
<dd><p>Cleans up and prepares asset for current iteration.</p>
<ul class="simple">
<li><p>adds current and forecast year by backfilling missing entries</p></li>
<li><p>removes assets for which there is no capacity now or in the future</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.coords_to_multiindex">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">coords_to_multiindex</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dimension</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><a class="reference internal" href="../_modules/muse/utilities.html#coords_to_multiindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.coords_to_multiindex" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a multi-index from flattened multiple coords.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.filter_input">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">filter_input</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dataset</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">year</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>int<span class="p">, </span>Iterable<span class="p">[</span>int<span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><a class="reference internal" href="../_modules/muse/utilities.html#filter_input"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.filter_input" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter inputs, taking care to interpolate years.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.filter_with_template">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">filter_with_template</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">template</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">asset_dimension</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/utilities.html#filter_with_template"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.filter_with_template" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters data to match template.</p>
<p>If the <cite>asset_dimension</cite> is present in <cite>template.dims</cite>, then the call is
forwarded to <cite>broadcast_techs</cite>. Otherwise, the set of dimensions and indices
in common between <cite>template</cite> and <cite>data</cite> are determined, and the resulting
call is forwarded to <cite>filter_input</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – Data to transform</p></li>
<li><p><strong>template</strong> – Data from which to figure coordinates and dimensions</p></li>
<li><p><strong>asset_dimension</strong> – Name of the dimension which if present indicates the
format is that of an <em>asset</em> (see <cite>broadcast_techs</cite>)</p></li>
<li><p><strong>kwargs</strong> – passed on to <cite>broadcast_techs</cite> or <cite>filter_input</cite></p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p><cite>data</cite> transformed to match the form of <cite>template</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.future_propagation">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">future_propagation</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">future</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">threshhold</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">1e-12</span></em>, <em class="sig-param"><span class="n">dim</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'year'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/utilities.html#future_propagation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.future_propagation" title="Permalink to this definition">¶</a></dt>
<dd><p>Propagates values into the future.</p>
<p class="rubric">Example</p>
<p><code class="docutils literal notranslate"><span class="pre">Data</span></code> should be an array with at least one dimension, “year”:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">2040</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">fuel</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;coal&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))],</span>
<span class="gp">... </span>    <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">future</span></code> is an array with  exactly one year in its <code class="docutils literal notranslate"><span class="pre">year</span></code> coordinate, or
that coordinate must correspond to a scalar. That one year should also be
present in <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">future</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.95</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fuel</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">],</span> <span class="n">year</span><span class="o">=</span><span class="mi">2025</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>This function propagates into <code class="docutils literal notranslate"><span class="pre">data</span></code> values from <code class="docutils literal notranslate"><span class="pre">future</span></code>, but only if those
values differed for the current year beyond a given threshhold:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">muse.utilities</span> <span class="kn">import</span> <span class="n">future_propagation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">future_propagation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">future</span><span class="p">,</span> <span class="n">threshhold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray (fuel: 2, year: 4)&gt;</span>
<span class="go">array([[ 0. ,  1.2,  1.2,  1.2],</span>
<span class="go">       [-5. , -4. , -3. , -2. ]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * year     (year) ... 2020 2025 2030 2035</span>
<span class="go">  * fuel     (fuel) &lt;U4 &#39;gas&#39; &#39;coal&#39;</span>
</pre></div>
</div>
<p>Above, the data for coal is not sufficiently different given the threshhold.
hence, the future values for coal remain as they where.</p>
<p>The dimensions of <code class="docutils literal notranslate"><span class="pre">future</span></code> do not have to match exactly those of <code class="docutils literal notranslate"><span class="pre">data</span></code>.
Standard broadcasting is used if they do not match:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">future_propagation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">future</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">fuel</span><span class="o">=</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">threshhold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray (fuel: 2, year: 4)&gt;</span>
<span class="go">array([[ 0. ,  1.2,  1.2,  1.2],</span>
<span class="go">       [-5. ,  1.2,  1.2,  1.2]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * year     (year) ... 2020 2025 2030 2035</span>
<span class="go">  * fuel     (fuel) &lt;U4 &#39;gas&#39; &#39;coal&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">future_propagation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">future</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">fuel</span><span class="o">=</span><span class="s2">&quot;coal&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">threshhold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray (fuel: 2, year: 4)&gt;</span>
<span class="go">array([[ 0.  , -3.95, -3.95, -3.95],</span>
<span class="go">       [-5.  , -4.  , -3.  , -2.  ]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * year     (year) ... 2020 2025 2030 2035</span>
<span class="go">  * fuel     (fuel) &lt;U4 &#39;gas&#39; &#39;coal&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.lexical_comparison">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">lexical_comparison</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objectives</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">binsize</span><span class="p">:</span> <span class="n">xarray.core.dataset.Dataset</span></em>, <em class="sig-param"><span class="n">order</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Sequence<span class="p">[</span>Hashable<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">bin_last</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/utilities.html#lexical_comparison"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.lexical_comparison" title="Permalink to this definition">¶</a></dt>
<dd><p>Lexical comparison over the objectives.</p>
<p>Lexical comparison operates by binning the objectives into bins of width
<cite>binsize</cite>. Once binned, dimensions other than <cite>asset</cite> and <cite>technology</cite> are
reduced by taking the max, e.g. the largest constraint. Finally, the
objectives are ranked lexographically, in the order given by the parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>objectives</strong> – xr.Dataset containing the objectives to rank</p></li>
<li><p><strong>binsize</strong> – bin size, minimization direction
(+ -&gt; minimize, - -&gt; maximize), and (optionally) order of
lexicographical comparison. The order is the one given
<cite>binsize.data_vars</cite> if the argument <cite>order</cite> is None.</p></li>
<li><p><strong>order</strong> – Optional array indicating the order in which to rank the tuples.</p></li>
<li><p><strong>bin_last</strong> – Whether the last metric should be binned, or whether it
should be left as a the type it already is (e.g. no flooring and
no turning to integer.)</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Result:</dt><dd><p>An array of tuples which can subsquently be compared lexicographically.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.merge_assets">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">merge_assets</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">capa_a</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">capa_b</span><span class="p">:</span> <span class="n">xarray.core.dataarray.DataArray</span></em>, <em class="sig-param"><span class="n">interpolation</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'linear'</span></em>, <em class="sig-param"><span class="n">dimension</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em><span class="sig-paren">)</span> &#x2192; xarray.core.dataarray.DataArray<a class="reference internal" href="../_modules/muse/utilities.html#merge_assets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.merge_assets" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge two capacity arrays.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.multiindex_to_coords">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">multiindex_to_coords</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dimension</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/utilities.html#multiindex_to_coords"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.multiindex_to_coords" title="Permalink to this definition">¶</a></dt>
<dd><p>Flattens multi-index dimension into multi-coord dimension.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.nametuple_to_dict">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">nametuple_to_dict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nametup</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>Mapping<span class="p">, </span>NamedTuple<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Mapping<a class="reference internal" href="../_modules/muse/utilities.html#nametuple_to_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.nametuple_to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms a nametuple of type GenericDict into an OrderDict.</p>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.reduce_assets">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">reduce_assets</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">assets</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">, </span>Sequence<span class="p">[</span>Union<span class="p">[</span>xarray.core.dataset.Dataset<span class="p">, </span>xarray.core.dataarray.DataArray<span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">coords</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>Sequence<span class="p">[</span>str<span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span>str<span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dim</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'asset'</span></em>, <em class="sig-param"><span class="n">operation</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Union<span class="p">[</span>xarray.core.dataarray.DataArray<span class="p">, </span>xarray.core.dataset.Dataset<span class="p">]</span><a class="reference internal" href="../_modules/muse/utilities.html#reduce_assets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.reduce_assets" title="Permalink to this definition">¶</a></dt>
<dd><p>Combine assets along given asset dimension.</p>
<p>This method simplifies combining assets accross multiple agents, or combining assets
across a given dimension. By default, it will sum together assets from the same
region which have the same technology and the same installation date. In other
words, assets are identified by the technology, installation year and region. The
reduction happens over other possible coordinates, e.g. the owning agent.</p>
<p>More specifically, assets are often indexed using what xarray calls a <strong>dimension
without coordinates</strong>. In practice, there are still coordinates associated with
assets, e.g. <em>technology</em> and <em>installed</em> (installation year or version), but the
value associated with these coordinates are not unique.  There may be more than one
asset with the same technology or installation year.</p>
<p>For instance, with assets per agent defined as <span class="math notranslate nohighlight">\(A^{i, r}_o\)</span>, with <span class="math notranslate nohighlight">\(i\)</span> an
agent index, <span class="math notranslate nohighlight">\(r\)</span> a region, <span class="math notranslate nohighlight">\(o\)</span> is the coordinates identified in
<code class="docutils literal notranslate"><span class="pre">coords</span></code>, and <span class="math notranslate nohighlight">\(T\)</span> the transformation identified by <code class="docutils literal notranslate"><span class="pre">operation</span></code>, then this
function computes:</p>
<div class="math notranslate nohighlight">
\[R_{r, o} = T[\{A^{i, r}_o; \forall i\}]\]</div>
<p>If <span class="math notranslate nohighlight">\(T\)</span> is the sum operation, then:</p>
<div class="math notranslate nohighlight">
\[R_{r, o} = \sum_i  A^{i, r}_o\]</div>
<p class="rubric">Example</p>
<p>Lets construct assets that do have duplicates assets. First we construct the
dimensions, using fake data:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2017</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;installed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">1991</span><span class="p">,</span> <span class="mi">1991</span><span class="p">,</span> <span class="mi">1990</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;technology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_coords</span><span class="p">((</span><span class="s1">&#39;installed&#39;</span><span class="p">,</span> <span class="s1">&#39;technology&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>We can check there are duplicate assets in this coordinate system:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">processes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">installed</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">technology</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">processes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">asset</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Now we can easily create a fake two dimensional quantity per process and
per year:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;asset&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The point of <cite>reduce_assets</cite> is to aggregate assets that refer to the
same process:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reduce_assets</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray &#39;capacity&#39; (year: 3, asset: 3)&gt;</span>
<span class="go">array([[ 0,  3,  3],</span>
<span class="go">       [ 4,  7, 11],</span>
<span class="go">       [ 8, 11, 19]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * year        (year) ... 2010 2015 2017</span>
<span class="go">    installed   (asset) ... 1990 1990 1991</span>
<span class="go">    technology  (asset) &lt;U1 &#39;a&#39; &#39;c&#39; &#39;b&#39;</span>
<span class="go">    region      (asset) &lt;U1 &#39;x&#39; &#39;y&#39; &#39;x&#39;</span>
<span class="go">Dimensions without coordinates: asset</span>
</pre></div>
</div>
<p>We can also specify explicitly which coordinates in the ‘asset’
dimension should be reduced, and how:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reduce_assets</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">coords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;technology&#39;</span><span class="p">,</span> <span class="s1">&#39;installed&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">operation</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;asset&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&lt;xarray.DataArray &#39;capacity&#39; (year: 3, asset: 3)&gt;</span>
<span class="go">array([[ 0. ,  1.5,  3. ],</span>
<span class="go">       [ 4. ,  5.5,  7. ],</span>
<span class="go">       [ 8. ,  9.5, 11. ]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * year        (year) ... 2010 2015 2017</span>
<span class="go">    technology  (asset) &lt;U1 &#39;a&#39; &#39;b&#39; &#39;c&#39;</span>
<span class="go">    installed   (asset) ... 1990 1991 1990</span>
<span class="go">Dimensions without coordinates: asset</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="muse.utilities.tupled_dimension">
<code class="sig-prename descclassname">muse.utilities.</code><code class="sig-name descname">tupled_dimension</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">array</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">axis</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/muse/utilities.html#tupled_dimension"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#muse.utilities.tupled_dimension" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms one axis into a tuples.</p>
</dd></dl>

</div>
<div class="section" id="module-muse">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-muse" title="Permalink to this headline">¶</a></h2>
<p>MUSE model.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">muse package</a><ul>
<li><a class="reference internal" href="#subpackages">Subpackages</a></li>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-muse.carbon_budget">muse.carbon_budget module</a></li>
<li><a class="reference internal" href="#module-muse.commodities">muse.commodities module</a></li>
<li><a class="reference internal" href="#module-muse.conftest">muse.conftest module</a></li>
<li><a class="reference internal" href="#module-muse.constraints">muse.constraints module</a></li>
<li><a class="reference internal" href="#module-muse.decisions">muse.decisions module</a></li>
<li><a class="reference internal" href="#module-muse.decorators">muse.decorators module</a></li>
<li><a class="reference internal" href="#module-muse.defaults">muse.defaults module</a></li>
<li><a class="reference internal" href="#module-muse.demand_matching">muse.demand_matching module</a></li>
<li><a class="reference internal" href="#module-muse.demand_share">muse.demand_share module</a></li>
<li><a class="reference internal" href="#module-muse.examples">muse.examples module</a></li>
<li><a class="reference internal" href="#module-muse.filters">muse.filters module</a></li>
<li><a class="reference internal" href="#module-muse.hooks">muse.hooks module</a></li>
<li><a class="reference internal" href="#module-muse.interactions">muse.interactions module</a></li>
<li><a class="reference internal" href="#module-muse.investments">muse.investments module</a></li>
<li><a class="reference internal" href="#module-muse.mca">muse.mca module</a></li>
<li><a class="reference internal" href="#module-muse.objectives">muse.objectives module</a></li>
<li><a class="reference internal" href="#module-muse.production">muse.production module</a></li>
<li><a class="reference internal" href="#module-muse.quantities">muse.quantities module</a></li>
<li><a class="reference internal" href="#module-muse.registration">muse.registration module</a></li>
<li><a class="reference internal" href="#module-muse.regressions">muse.regressions module</a></li>
<li><a class="reference internal" href="#module-muse.timeslices">muse.timeslices module</a></li>
<li><a class="reference internal" href="#module-muse.utilities">muse.utilities module</a></li>
<li><a class="reference internal" href="#module-muse">Module contents</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/source/muse.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MUSE Documentation 0.8 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">muse package</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Sustainable Gas Institute.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
  </body>
</html>